!function(r){r.su.moduleManager.define("tpCloud",{deps:["login","main","tpLogin"],services:["ajax","device","moduleLoader","moduleManager"],models:["deviceInfoModelLogin"],stores:[],views:["tpCloudView"],listeners:{ev_on_launch:function(o,e,i,n,t,d,g){r("#cloud-login").hide(),i.tpCloudView.cloudErrorLoader.hide(),r(window).off("ev_watingTimeout"),r(window).on("ev_watingTimeout",function(){d.main.clearWaitingEvent(),("qs"===e.getMode()?g.moduleManager.get("qsCloudAndTether"):d.tpLogin).hideLoading(),g.moduleLoader.load({module:"tpCloud"},{module:"cloudError"},i.tpCloudView.cloudErrorLoader),i.tpCloudView.cloudErrorLoader.show()}),r(window).off("message"),r(window).on("message",e.onReceive)}}},function(n,o,e,i,t,d){return{setMode:function(o){_mode=o},getMode:function(){return _mode},setIframeSrc:function(o){var e;o&&(e=new Date,o=n.cloudOrigin+"/cloud_ui_v2/pages/device/index.html?module="+o+"&t="+e.getTime(),r("#cloud-login").attr("src",o),t.main.setWaitingEvent("ev_watingTimeout"))},getCloudOrigin:function(e){n.cloudOrigin?n.setIframeSrc(e):d.ajax.request({proxy:"tokenProxyLogin",ajax:{async:!1},method:"read",success:function(o){o.origin_url?(n.cloudOrigin=o.origin_url,n.setIframeSrc(e)):(r(window).trigger("ev_watingTimeout"),("qs"===n.getMode()?d.moduleManager.get("qsCloudAndTether"):t.tpLogin).hideLoading())}})},getDeviceInfo:function(){d.ajax.request({proxy:"deviceInfoProxy",method:"read",success:function(o){var e={},o=((e=o).gamingUI=d.device.getConfig().supportGamingUIGX90,e.updateLoginStatus=!0,e.eType="ev_deviceInfo",JSON.stringify(e));window.frames["cloud-login"].postMessage(o,n.cloudOrigin)}})},goTo:function(o){o&&(("qs"===n.getMode()?d.moduleManager.get("qsCloudAndTether"):t.tpLogin).showLoading(),n.getCloudOrigin(o))},postLoginStatus:function(){var o={eType:"ev_login_status"},o=JSON.stringify(o);window.frames["cloud-login"]&&window.frames["cloud-login"].postMessage(o,n.cloudOrigin)},postRgSec:function(){var o={},o={RG_SEC:r.su.IS_RG_SEC,eType:"ev_rg_sec"},o=JSON.stringify(o);window.frames["cloud-login"]&&window.frames["cloud-login"].postMessage(o,n.cloudOrigin)},onReceive:function(o){o=o.originalEvent||o;if(n.cloudOrigin||d.ajax.request({proxy:"tokenProxyLogin",ajax:{async:!1},method:"read",success:function(o){o.origin_url&&(n.cloudOrigin=o.origin_url)}}),o.origin===n.cloudOrigin||"_self"===o.origin||null==o.origin){var e=o.data;if(e="string"==typeof o.data?r.parseJSON(e):e)switch(e.eType){case"ev_goto":if("login"==e.url||"login"==e.index)return void("qs"===n.getMode()?d.moduleManager.get("qsCloudAndTether").goToTpLogin():(d.moduleManager.get("login").unLoad(),t.login.goToChildModule("tpLogin")));"register"!=e.url&&"register"!=e.index||t.login.goToChildModule("tpCloud",function(){n.setMode("login"),n.goTo("register")}),"forgotPassword"!=e.url&&"forgotPassword"!=e.index||((i=d.moduleManager.get("login"))?i.goToChildModule("tpCloud",function(){n.setMode("login"),n.goTo("findBackPassword")}):t.main.loadBasicModule("login",function(){d.moduleManager.get("login").goToChildModule("tpCloud",function(){n.goTo("findBackPassword")})})),e.url&&n.getCloudOrigin(e.url);break;case"load":var i={},i=(i.locale=d.device.getLocale(),i.force=d.device.getForce(),i.model=d.device.getProductName(),i.eType="ev_init",JSON.stringify(i));window.frames["cloud-login"]&&window.frames["cloud-login"].postMessage(i,n.cloudOrigin),t.main.clearWaitingEvent(),("qs"===n.getMode()?d.moduleManager.get("qsCloudAndTether"):t.tpLogin).hideLoading(),n.postRgSec(),n.getDeviceInfo(),r("#cloud-login").show();case"ev_reset":r("#cloud-login").css("height",e.height);break;case"ev_activation_login":d.moduleManager.get("login").unLoad(),t.login.goToChildModule("tpLogin");break;case"ev_login":"qs"===n.getMode()?d.moduleManager.get("qsCloudAndTether").goToTpLogin():e.validate&&(r.su.userInfo.username=e.email,r.su.userInfo.token=e.token,d.ajax.request({proxy:"cloudBindStatusLoginProxy",method:"read",success:function(o){o.isbind?t.tpLogin.doCloudLogin("login"):(n.postLoginStatus(),t.tpLogin.checkAdmin())},fail:n.postLoginStatus,error:n.postLoginStatus}))}}}}})}(jQuery);
!function(l){l.su.moduleManager.define("timeMachine",{models:["timeMachine"],stores:["timeMachineStorageList"],views:["timeMachineView"],listeners:{ev_on_launch:function(e,t,a,n,i,s,c){n.timeMachine.load({data:{},success:function(e){var i=parseFloat(parseInt(n.timeMachine.free.getValue())/1073741824).toFixed(1);a.timeMachineView.storageTips.setText(l.su.CHAR.TIME_MACHINE.AVAILABLE_STORAGE.replace("%size%",i)),t.availableSize=i,t.initLocation(e.disk_status)}})}},init:function(n,s,c,t,e,i){n.totalSize=0,n.availableSize=0,this.configViews({id:"timeMachineView",items:[{id:"time-machine-storage-list",configs:[{type:"logo",dataIndex:"logo"},{type:"deviceName",dataIndex:"label"},{type:"availableSpace",label:l.su.CHAR.TIME_MACHINE.AVAILABLE_SPACE,dataIndex:"free",renderer:function(e){return e+" "+l.su.CHAR.UNIT.GB}},{type:"totalSpace",label:l.su.CHAR.TIME_MACHINE.TOTAL_SPACE,dataIndex:"capacity",renderer:function(e){return e+" "+l.su.CHAR.UNIT.GB}}]},{id:"time-machine-note",items:[{text:l.su.CHAR.TIME_MACHINE.NOTE_GET_HIGHER_SPEED},{text:l.su.CHAR.TIME_MACHINE.NOTE_REMOVE_HDD},{text:l.su.CHAR.TIME_MACHINE.NOTE_COMPLETE_BACKUP_OVERNIGHT}]}]}),this.control({"#select-folder":{ev_button_click:function(){t.timeMachineStorageList.load({data:{operation:"read"},success:function(){(0!=t.timeMachineStorageList.getSize()?s.timeMachineView.selectFolderMsg:s.timeMachineView.folderEmptyMsg).show()}})}},"#time-machine-storage-list":{ev_item_click:function(e,i){i&&(c.timeMachine.diskStatus.setValue(0),c.timeMachine.uuid.setValue(i.uuid),c.timeMachine.mntdir.setValue(i.mntdir),c.timeMachine.label.setValue(i.label),s.timeMachineView.storageTips.setText(l.su.CHAR.TIME_MACHINE.AVAILABLE_STORAGE.replace("%size%",i.free)),s.timeMachineView.selectFolderMsg.close(),n.totalSize=Number(i.capacity),n.availableSize=Number(i.free))}},".index-common-save-btn":{ev_will_auto_save:function(e,i){var a;if(i.preventDefault(),"off"!=c.timeMachine.enable.getValue())return 1!=c.timeMachine.diskStatus.getValue()&&2!=c.timeMachine.diskStatus.getValue()&&("---"==c.timeMachine.label.getValue()?(c.timeMachine.label.setError(l.su.CHAR.TIME_MACHINE.SELECT_HINT),!1):0!=c.timeMachine.validate()&&(a=!1,void t.timeMachineStorageList.load({data:{operation:"read"},success:function(e){for(var i=0;i<e.length;i++)c.timeMachine.uuid.getValue()==e[i].uuid&&(a=!0);if(0==a)return c.timeMachine.label.setError(l.su.CHAR.TIME_MACHINE.NOT_AVAILABLE),!1;if(0==c.timeMachine.diskStatus.getValue()){var t=Number(c.timeMachine.limitsize.getValue());if(n.availableSize<t)return s.timeMachineView.storageTips.show(),!1;s.timeMachineView.storageTips.hide()}n.submitTimeMachineModel()}})));n.submitTimeMachineModel()}}}),this.listen({"models.timeMachine.enable":{ev_value_change:function(e,i,t){"on"==i?(s.timeMachineView.enableBlock.show(),setTimeout(function(){null!=t&&n.initLocation(c.timeMachine.diskStatus.getValue())},50)):s.timeMachineView.enableBlock.hide()}}})}},function(e,i,t,a,n,s){return{initLocation:function(e){switch(e){case"0":t.timeMachine.label.setNormal();break;case"1":t.timeMachine.label.setError(l.su.CHAR.TIME_MACHINE.SELECT_HINT);break;case"2":t.timeMachine.label.setError(l.su.CHAR.TIME_MACHINE.NOT_AVAILABLE)}},submitTimeMachineModel:function(){t.timeMachine.submit({success:function(e){t.timeMachine.loadData(e),i.timeMachineView.storageTips.hide()}})}}})}(jQuery);
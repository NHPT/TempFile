!function(m){m.su.moduleManager.define("volumeControl",{models:["volumeControlModel","timeSettings"],services:["time","moduleManager","ajax"],stores:["timezoneStore","setTimeModeAutoStore"],views:["volumeControlView"],listeners:{ev_on_launch:function(e,o,t,n,l,i,m){o.unRegisterAutoSaveData([n.timeSettings]),n.volumeControlModel.load(),n.timeSettings.load(),m.time.on("on_time_change",o.onTimeChange),m.time.on("on_hour24_change",o.onHour24Change)},ev_before_destroy:function(e,o,t,n,l,i,m){m.time.off("on_time_change",o.onTimeChange),m.time.off("on_hour24_change",o.onHour24Change)}},init:function(l,n,i,e,o,t){this.control({"#go-to-time-settings":{click:function(){t.moduleManager.get("navigatorController").goTo("timeSettings")}},"#time-set-msg":{ev_msg_ok:function(e,o){i.timeSettings.submit({success:function(){i.timeSettings.load()}})},ev_msg_close:function(e,o){i.volumeControlModel.load(),i.timeSettings.reset()},ev_msg_no:function(e,o){i.volumeControlModel.load(),i.timeSettings.reset()}},"#volume-enable":{ev_view_change:function(e,o){t.ajax.request({proxy:"volumeControlProxy",method:"write",data:{speaker_enable:o.value},success:function(){i.volumeControlModel.load()}})}}}),this.listen({"models.volumeControlModel.speakerEnable":{ev_value_change:function(e,o,t){o?i.volumeControlModel.volume.show():i.volumeControlModel.volume.hide()}},"models.volumeControlModel.doNotDisturbEnable":{ev_value_change:function(e,o,t){o?(n.volumeControlView.timeSetFieldSet.show(),null!=t&&"auto"!==i.timeSettings.type.getValue()&&(i.timeSettings.type.setValue("auto"),n.volumeControlView.timeSetMsg.show())):n.volumeControlView.timeSetFieldSet.hide()}},"models.volumeControlModel.startTime":{ev_value_change:function(e,o,t){var o=o||"00:00",n=i.volumeControlModel.stopTime.getValue()||"00:00";l.setNextDayTip(o,n)}},"models.volumeControlModel.stopTime":{ev_value_change:function(e,o,t){var n=i.volumeControlModel.startTime.getValue()||"00:00";l.setNextDayTip(n,o||"00:00")}}})}},function(t,n,l,e,o,i){return{ONE_DAY_TIME:1440,HOUR_TO_MINUTE:60,onTimeChange:function(e,o){var t=i.time.getHour24(),o=i.time.format(o,"yyyy-MM-dd HH:mm:ss",t);n.volumeControlView.currentTime.setValue(o)},onHour24Change:function(e,o){l.volumeControlModel.startTime.setHourSystem(o?"24":"12"),l.volumeControlModel.stopTime.setHourSystem(o?"24":"12")},transformMinToTime:function(e){e>t.ONE_DAY_TIME&&(e-=t.ONE_DAY_TIME);var o=e%t.HOUR_TO_MINUTE;return parseInt(e/t.HOUR_TO_MINUTE)+":"+(9<o?o:o+"0")},setNextDayTip:function(e,o){"string"==typeof e&&"string"==typeof o&&(e=parseInt(e.replace(":",""),10),parseInt(o.replace(":",""),10)<=e?l.volumeControlModel.stopTime.setShortTips(m.su.CHAR.LED.NEXT_DAY_TIP):l.volumeControlModel.stopTime.setShortTips("&nbsp;"))}}})}(jQuery);
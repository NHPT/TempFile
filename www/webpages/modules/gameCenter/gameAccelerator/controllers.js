!function(u){u.su.moduleManager.define("gameAccelerator",{services:["ajax","moduleLoader","moduleManager","device"],deps:["main"],models:["gameAcceleratorM","qosInfo","priorityEnable"],stores:["gameAcceleratorStore"],views:["gameAcceleratorView"],listeners:{ev_on_launch:function(e,a,n,t,o,s,c){this.unRegisterAutoSaveData([o.gameAcceleratorStore,t.gameAcceleratorM]),t.gameAcceleratorM.load({data:{operation:"getMode"},success:function(e){"on"==e.game_mode?n.gameAcceleratorView.networkMapClientPanel.show():n.gameAcceleratorView.networkMapClientPanel.hide()}}),a.getClients(),c.moduleLoader.load({module:"gameAccelerator"},{module:"bandwidth"},n.gameAcceleratorView.qosBandwidthLoader,function(){var e=c.moduleManager.get("bandwidth");e.on("ev_qos_saved",function(e){t.gameAcceleratorM.gameMode.setValue("on"),t.priorityEnable.enable.setValue("on"),t.qosInfo.qosMode.setValue("gaming"),t.qosInfo.qosMode.record(),t.priorityEnable.enable.record(),t.gameAcceleratorM.gameMode.hideLoading(),t.priorityEnable.setOnOff({preventSuccessEvent:!0}),t.qosInfo.submit({preventSuccessEvent:!0,success:function(){a.getQosInfo()}}),t.gameAcceleratorM.submit({data:{operation:"setMode"},success:function(e){"on"==e.gameMode?n.gameAcceleratorView.networkMapClientPanel.show():n.gameAcceleratorView.networkMapClientPanel.hide()}})}),e.on("ev_qos_save_close",function(e){t.gameAcceleratorM.gameMode.hideLoading()}),e.on("ev_qos_save_cancel",function(e){t.gameAcceleratorM.gameMode.hideLoading()})}),a.getQosInfo()},ev_before_destroy:function(e,a){a.beforeDestroy()}},init:function(c,r,i,t,l,d){this.configViews({id:"gameAcceleratorView",items:[{id:"game-connected-clients-grid",configs:{columns:[{dataIndex:"deviceName",cls:"m-hide l-hide xl-hide label-empty"},{dataIndex:"deviceType",cls:"m-hide l-hide xl-hide label-empty",renderer:function(e,a){var n="",t="",o="";switch(e=e.toLowerCase()){case"pc":n="icon-pc";break;case"phone":n="icon-phone";break;case"pad":n="icon-pad";break;case"other":n="icon-pc";break;default:n="icon-"+e}return t=t+'<div class="device-type-container widget-container">'+('<span class="icon '+n+' ">'+(o=a.isGaming?'<span class="gaming-tag"></span>':o)+"</span>"),null!=a.enableInternet&&(t+='<span class="text">'+(a.enableInternet?"":u.su.CHAR.NETWORK_MAP.INTERNET_PAUSED)+"</span>"),t=(t=(t+="</div>")+'<div class="device-info-container widget-container">'+('<div class="mac">'+a.mac+"</div>"))+('<div class="ip">'+("0.0.0.0"==a.ip?"":a.ip)+"</div>")+"</div>"}},{text:u.su.CHAR.NETWORK_MAP.TYPE,width:"15%",dataIndex:"deviceType",cls:"s-hide",renderer:function(e,a){var n="",t="",o="";switch(e=e.toLowerCase()){case"pc":n="icon-pc";break;case"phone":n="icon-phone";break;case"pad":n="icon-pad";break;case"other":n="icon-pc";break;default:n="icon-"+e}return t=t+'<div class="device-type-container widget-container">'+('<span class="icon '+n+' ">'+(o=a.isGaming?'<span class="gaming-tag"></span>':o)+"</span>"),null!=a.enableInternet&&(t+='<span class="text">'+(a.enableInternet?"":u.su.CHAR.NETWORK_MAP.INTERNET_PAUSED)+"</span>"),t+="</div>"}},{text:u.su.CHAR.NETWORK_MAP.INFORMATION,dataIndex:"deviceName",width:"22%",cls:"s-hide",renderer:function(e,a){var n,t="";return t="object"===u.type(a)?(t=(t+='<div class="device-info-container widget-container">')+'<div class="name" title="'+(n=a.deviceName)+'">'+n+'</div><div class="mac">'+a.mac+"</div>")+'<div class="ip">'+("0.0.0.0"==a.ip?"":a.ip)+"</div></div>":t}},{text:u.su.CHAR.GAME_ACCELERATOR.REAL_TIME_RATE,dataIndex:"downloadSpeed",renderer:function(e,a){function n(e){var a=(e=parseInt(e,10))/1024<1?(0!==e&&(e=(e/1024).toFixed(2)),u.su.CHAR.NETWORK_MAP.KBPS):e/1024/1024<1?(e/1024<1e3?e=(e/1024).toFixed(1):e/=1024,u.su.CHAR.NETWORK_MAP.KBPS):(e=(e/1024/1024).toFixed(1),u.su.CHAR.NETWORK_MAP.MBPS);return{speed:e,unit:a}}var t,o,s="";return"object"===u.type(a)&&(t=n(a.downloadSpeed),o=n(a.uploadSpeed),a.latency,s=(s=(s=(s=(s+='<div class="speed-upload-container widget-container">')+'<span class="icon"></span><span class="text">'+o.speed+"</span>")+'<span class="unit">'+o.unit+'</span></div><div class="speed-download-container widget-container">')+'<span class="icon"></span><span class="text">'+t.speed+"</span>")+'<span class="unit">'+t.unit+"</span></div>"),s}},{text:u.su.CHAR.GAME_ACCELERATOR.LATENCY,dataIndex:"latency",width:"16%",cls:"s-2-col custom-action-column",tipText:u.su.CHAR.GAME_ACCELERATOR.LATENCY_HELP,renderer:function(e,a){var n="";return n+='<div class="latency-container widget-container">',n=(n=(n=0<=e?n+'<span class="text">'+e+'</span><span class="unit">'+u.su.CHAR.GAME_ACCELERATOR.LATENCY_UNIT+"</span>":n+'<span class="text">--- </span><span class="unit">'+u.su.CHAR.GAME_ACCELERATOR.LATENCY_UNIT+"</span>")+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-latency btn-latency">'+'<span class="icon"></span>')+"</a>"+"</div>"}},{text:u.su.CHAR.GAME_ACCELERATOR.GAMEING_DURATION,dataIndex:"totalGameTime",cls:"s-2-col",renderer:function(e,a){var n,t="",o=(t+='<div class="duration-container widget-container">',o=parseInt(e/1440,10),n=parseInt(e%86400/60,10),e=parseInt(e%60,10),1===o?t=t+o+" "+u.su.CHAR.NETWORK_MAP.DAY+" ":1<o&&(t=t+o+" "+u.su.CHAR.NETWORK_MAP.DAYS+" "),t=(t=0<n?t+n+" "+u.su.CHAR.NETWORK_MAP.H+" ":t)+e+" "+u.su.CHAR.NETWORK_MAP.MIN,t+=" ("+u.su.CHAR.GAME_ACCELERATOR.TOTAL+")</div>",a.currentGameTime);return t+='<div class="duration-container widget-container">',dayCurrent=parseInt(o/1440,10),n=parseInt(o%86400/60,10),e=parseInt(o%60,10),1===dayCurrent?t=t+dayCurrent+" "+u.su.CHAR.NETWORK_MAP.DAY+" ":1<dayCurrent&&(t=t+dayCurrent+" "+u.su.CHAR.NETWORK_MAP.DAYS+" "),t=(t=0<n?t+n+" "+u.su.CHAR.NETWORK_MAP.H+" ":t)+e+" "+u.su.CHAR.NETWORK_MAP.MIN,t+=" ("+u.su.CHAR.GAME_ACCELERATOR.CURRENT+")</div>"}}]}}]}),this.control({"#game-connected-clients-grid => .btn-latency":{ev_grid_action_click:function(e,a){var n=t.gameAcceleratorStore.getModelByKey(a),a=n.ip.getValue();d.ajax.request({proxy:"gameAccGridProxy",method:"read",data:{ip:a,operation:"getLatency"},success:function(e){n.latency.setValue(e.latency)},error:function(e){},fail:function(e){}})}},"#game-accelerator-enable":{ev_view_will_change:function(e,n){n.preventDefault();function a(){t()&&(changeData="on"==i.gameAcceleratorM.gameMode.getValue()?"off":"on",i.gameAcceleratorM.gameMode.setValue(changeData),i.gameAcceleratorM.submit({data:{operation:"setMode"},success:function(e){"on"==e.gameMode?r.gameAcceleratorView.networkMapClientPanel.show():r.gameAcceleratorView.networkMapClientPanel.hide()}}))}var t=function(){var e=i.gameAcceleratorM.gameMode.getValue(),a=d.moduleManager.get("bandwidth");return!!("off"!=e&&e||a.hasConfigured())||(n.preventDefault(),i.gameAcceleratorM.gameMode.showLoading("on"),a.showBandwithMsg(),!1)},o="off"==i.priorityEnable.enable.getValue()&&"off"==i.gameAcceleratorM.gameMode.getValue()||"gaming"!=i.qosInfo.qosMode.getValue()&&"off"==i.gameAcceleratorM.gameMode.getValue(),s="on"==i.priorityEnable.enable.getValue()&&"on"==i.gameAcceleratorM.gameMode.getValue()&&"gaming"==i.qosInfo.qosMode.getValue();o?l.main.confirm(u.su.CHAR.QOS.GAMING_ACCELERATOR_NOTICE,function(){t()&&(a(),i.priorityEnable.enable.setValue("on"),i.priorityEnable.setOnOff({preventSuccessEvent:!0,success:function(){}}),i.qosInfo.qosMode.setValue("gaming"),i.qosInfo.submit({preventSuccessEvent:!0,success:function(){c.getQosInfo()}}))},null,u.su.CHAR.OPERATION.CONTINUE):s?l.main.confirm(u.su.CHAR.QOS.GAMING_GAMEMPDE_SWITCH_NOTICE,function(){t()&&(a(),i.qosInfo.qosMode.setValue("fair"),i.qosInfo.submit({preventSuccessEvent:!0,success:function(){c.getQosInfo()}}))},null,u.su.CHAR.OPERATION.CONTINUE):a()}}}),this.listen({"stores.gameAcceleratorStore":{ev_data_change:function(e,a,n){n=n.getName();a.value!==a.oldValue&&"enablePriority"===n&&t.gameAcceleratorStore.sync()}}})}},function(e,a,n,t,o,s){var c=null;return{getClients:function(){t.gameAcceleratorStore.load({data:{operation:"loadDevice"},success:function(e){t.gameAcceleratorStore.load({data:{operation:"loadSpeed"}})}}),clearInterval(c),c=setInterval(function(){t.gameAcceleratorStore.load({data:{operation:"loadSpeed"}})},1e4)},getQosInfo:function(){n.priorityEnable.getOnOff(),n.qosInfo.load({success:function(){var e=n.qosInfo.getData();!0===s.device.getConfig().supportGFN&&("fair"==e.qosMode?(n.priorityEnable.enable.setValue("off"),n.qosInfo.qosMode.setDisabled()):(n.priorityEnable.enable.setValue("on"),n.qosInfo.qosMode.setAbled())),n.qosInfo.qosMode.setSelected(e.qosMode)}})},getAccessControlMode:function(e){var a;e&&(a=e.success),n.accessControl.load({success:function(e){a&&a(n.accessControl.getData())}})},beforeDestroy:function(){clearInterval(c)},getIPaddr:function(e){return""},getConnectType:function(e){return""}}})}(jQuery);
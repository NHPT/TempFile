!function(c){c.su.moduleManager.define("bandwidth",{deps:["main"],services:["ajax","device"],models:["totalBandwidth","bandwidthSpeedTestControl"],stores:["bandwidthSetTypeStore","bandwidthUnitStore"],views:["bandwidthView"],listeners:{ev_on_launch:function(e,a,i,r,t,s,o){this.unRegisterAutoSaveData([r.totalBandwidth,r.bandwidthSpeedTestControl]),0==o.device.getConfig().supportAutoSpeedTest&&r.totalBandwidth.bandwidthMode.hide();var l=!1;o.ajax.request({proxy:"speedRecordProxy",ajax:{async:!1},success:function(e){c.isArray(e)&&0!==e.length||(l=!0)}}),this.control({".total-bandwidth .edit-icon":{click:function(){a.showBandwithMsg()}},"#set-bandwidth-msg":{ev_msg_ok:function(e,t){var n;t.preventDefault(),!0===r.totalBandwidth.validate()&&("manual"===r.totalBandwidth.bandwidthMode.getValue()?(t={},(n={}).value=Number(r.totalBandwidth.upstreamSpeedTrans.getValue()),t.value=Number(r.totalBandwidth.downstreamSpeedTrans.getValue()),n.unit=r.totalBandwidth.upstreamUnitTrans.getValue(),t.unit=r.totalBandwidth.downstreamUnitTrans.getValue(),n=a.joinSpeed(n),t=a.joinSpeed(t),r.totalBandwidth.upstreamBandwidth.setValue(n),r.totalBandwidth.downstreamBandwidth.setValue(t),r.totalBandwidth.submit({success:function(e){r.totalBandwidth.loadData(e),i.bandwidthView.setBandwidthMsg.close()}})):o.ajax.request({proxy:"bandwidthCheckInternetProxy",success:function(){r.totalBandwidth.submit({success:function(e){l?o.ajax.request({proxy:"checkPrivicyProxy",method:"read",success:function(e){i.bandwidthView.setBandwidthMsg.close(),e.enable?(a.initSpeedtest(),i.bandwidthView.speedtestMsg.show(),a.startSpeedTest()):i.bandwidthView.speedtestPrivacyMsg.show()}}):(r.totalBandwidth.loadData(e),i.bandwidthView.setBandwidthMsg.close())}})},fail:function(){s.main.showError(c.su.CHAR.BANDWIDTH.NO_INTERNET_NOTE)},error:function(){s.main.showError(c.su.CHAR.BANDWIDTH.NO_INTERNET_NOTE)}}))},ev_msg_cancel:function(e,t){this.trigger("ev_qos_save_cancel")},ev_msg_close:function(e,t){this.trigger("ev_qos_save_close")}},"#speedtest-privacy-msg":{ev_msg_ok:function(e,t){t.preventDefault(),o.ajax.request({proxy:"checkPrivicyProxy",method:"write",data:{enable:!0},success:function(){i.bandwidthView.speedtestPrivacyMsg.close(),a.initSpeedtest(),i.bandwidthView.speedtestMsg.show(),a.startSpeedTest()}})},ev_msg_cancel:function(e,t){i.bandwidthView.setBandwidthMsg.show()}},"#speedtest-msg":{ev_msg_close:function(e){i.bandwidthView.setBandwidthMsg.show(),a.stopSpeedTest()}},"#speedtest-msg-cancel-btn":{ev_button_click:function(e){i.bandwidthView.speedtestMsg.hide(),i.bandwidthView.setBandwidthMsg.show(),a.stopSpeedTest()}},".bandwidth-speedtest-btn":{ev_button_click:function(){a.startSpeedTest()}}}),this.listen({"models.totalBandwidth.bandwidthMode":{ev_value_change:function(e,t){"manual"===t?i.bandwidthView.bandwidthSetManual.show():(i.bandwidthView.bandwidthSetManual.hide(),l?r.totalBandwidth.bandwidthMode.showItemContent(["auto"]):r.totalBandwidth.bandwidthMode.hideItemContent(["auto"]))}},"models.totalBandwidth":{ev_model_submit:function(){this.trigger("ev_qos_saved")}},"models.totalBandwidth.upstreamUnitTrans":{ev_value_change:function(e,t,n){"kbps"===t?r.totalBandwidth.upstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:r.totalBandwidth.maxUpload.getValue()}):r.totalBandwidth.upstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:Math.floor(r.totalBandwidth.maxUpload.getValue()/1024)})}},"models.totalBandwidth.downstreamUnitTrans":{ev_value_change:function(e,t,n){"kbps"===t?r.totalBandwidth.downstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:r.totalBandwidth.maxDownload.getValue()}):r.totalBandwidth.downstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:Math.floor(r.totalBandwidth.maxDownload.getValue()/1024)})}}}),r.totalBandwidth.load()}},init:function(e,t,n,a,i,r){}},function(i,e,r,t,n,s){var a=null;return{hasConfigured:function(){return-1!==parseInt(r.totalBandwidth.downstreamBandwidth.getValue(),10)},showBandwithMsg:function(){e.bandwidthView.setBandwidthMsg.show()},isSpeedTesting:!1,joinSpeed:function(e){var t=e.value;return"mbps"===e.unit&&(t*=1024),t},initSpeedtest:function(){i.initDownloadChart(),i.initUploadChart()},initDownloadChart:function(){i.setDownloadChartSpeed(0)},initUploadChart:function(){i.setUploadChartSpeed(0)},setDownloadChartSpeed:function(e){r.bandwidthSpeedTestControl.speedTestDownload.setOption({value:i.normalizeSpeed(e),loading:!1,name:c.su.CHAR.NETWORK_MAP.DOWNLOAD_SPEED_UPPER,convert:[0,5,10,25,50,100,300,1e3,2500]})},setUploadChartSpeed:function(e){r.bandwidthSpeedTestControl.speedTestUpload.setOption({value:i.normalizeSpeed(e),loading:!1,name:c.su.CHAR.NETWORK_MAP.UPLOAD_SPEED_UPPER,convert:[0,5,10,25,50,100,300,1e3,2500]})},startSpeedTest:function(){r.bandwidthSpeedTestControl.speedTestBtn.hide(),r.bandwidthSpeedTestControl.speedTestInfo.setText("&nbsp;"),i.setDownloadChartSpeed(i.transformSpeedUnit(0)),i.setUploadChartSpeed(i.transformSpeedUnit(0)),i.isSpeedTesting=!0,clearInterval(a),i.testStatusMap={ping:{preIsTesting:!1,nowIsTesting:!1},download:{preIsTesting:!1,nowIsTesting:!1},upload:{preIsTesting:!1,nowIsTesting:!1}},i.getSpeedTestResult({proxy:"startSpeedTestProxy",success:function(e){a=setInterval(function(){i.continueSpeedTest()},2e3)}})},continueSpeedTest:function(){i.getSpeedTestResult({proxy:"readSpeedTestProxy",success:function(a){"idle"===a.status?(i.handleTestEnd(a),r.totalBandwidth.load(),e.bandwidthView.speedtestMsg.close()):"down_test"===a.status?(r.bandwidthSpeedTestControl.speedTestInfo.setText(c.su.CHAR.NETWORK_MAP.DOWNLOAD_SPEED_TEST),i.testStatusMap.download.nowIsTesting=!0):"up_test"===a.status?(r.bandwidthSpeedTestControl.speedTestInfo.setText(c.su.CHAR.NETWORK_MAP.UPLOAD_SPEED_TEST),i.testStatusMap.upload.nowIsTesting=!0):"latency"===a.status?i.testStatusMap.ping.nowIsTesting=!0:"fail"===a.status?(r.bandwidthSpeedTestControl.speedTestInfo.setText(c.su.CHAR.BANDWIDTH.SPEED_TEST_FAILED),i.handleTestEnd(a),r.bandwidthSpeedTestControl.speedTestBtn.show()):(r.bandwidthSpeedTestControl.speedTestInfo.setText("&nbsp;"),i.setDownloadChartSpeed(0),i.setUploadChartSpeed(0)),-1!==a.ping&&(i.testStatusMap.ping.nowIsTesting=!1),-1!==a.downSpeed&&(i.testStatusMap.download.nowIsTesting=!1),-1!==a.upSpeed&&(i.testStatusMap.upload.nowIsTesting=!1),c.each(i.testStatusMap,function(e,t){var n=!1===t.preIsTesting&&!0===t.nowIsTesting,t=!0===t.preIsTesting&&!1===t.nowIsTesting;n?i.startFieldLoading(e):t&&i.stopFieldLoading(e,a)}),c.each(i.testStatusMap,function(e,t){!1===t.preIsTesting&&!0===t.nowIsTesting?t.preIsTesting=!0:!0===t.preIsTesting&&!1===t.nowIsTesting&&(t.preIsTesting=!1)})},fail:function(e){i.handleTestEnd({downSpeed:0,upSpeed:0})}})},handleTestEnd:function(e){i.isSpeedTesting=!1,clearInterval(a),a=null,i.setSpeedTestResult(e)},startFieldLoading:function(e){"upload"===e?r.bandwidthSpeedTestControl.speedTestUpload.setOption({loading:!0,name:c.su.CHAR.NETWORK_MAP.UPLOAD_SPEED_UPPER}):"download"===e&&r.bandwidthSpeedTestControl.speedTestDownload.setOption({loading:!0,name:c.su.CHAR.NETWORK_MAP.DOWNLOAD_SPEED_UPPER})},stopFieldLoading:function(e,t){var n;"upload"===e?(n=i.transformSpeedUnit(t.upSpeed),r.bandwidthSpeedTestControl.speedTestUpload.setOption({loading:!1,value:n,name:c.su.CHAR.NETWORK_MAP.UPLOAD_SPEED_UPPER})):"download"===e&&(n=i.transformSpeedUnit(t.downSpeed),r.bandwidthSpeedTestControl.speedTestDownload.setOption({loading:!1,value:n,name:c.su.CHAR.NETWORK_MAP.DOWNLOAD_SPEED_UPPER}))},getSpeedTestResult:function(e){var t,n,a="readSpeedTestProxy";e&&(t=e.success,n=e.fail,a=e.proxy||a),s.ajax.request({proxy:a,preventSuccessEvent:e.preventSuccessEvent,success:function(e){i.isRunning()&&t&&t(e)},fail:function(e){i.isRunning()&&n&&n(e)}})},setSpeedTestResult:function(e){var t=i.transformSpeedUnit(e.upSpeed),e=i.transformSpeedUnit(e.downSpeed);i.setDownloadChartSpeed(e),i.setUploadChartSpeed(t)},stopSpeedTest:function(){i.getSpeedTestResult({proxy:"stopSpeedTestProxy",success:function(e){i.handleTestEnd(e)}})},normalizeSpeed:function(e){return isNaN(e)||e<0?0:e},transformSpeedUnit:function(e){return(!e||e<0)&&(e=0),1e3<=(e/=1024)?parseInt(e,10):parseFloat(e.toFixed(2))}}})}(jQuery),function(r){r.su.modelManager.define("totalBandwidth",{type:"model",fields:[{name:"bandwidthMode",mapping:"bandwidth_mode"},{name:"upstreamBandwidth",mapping:"upstream_bandwidth"},{name:"downstreamBandwidth",mapping:"downstream_bandwidth"},{name:"maxUpload",mapping:"max_upload",disabled:!0},{name:"maxDownload",mapping:"max_download",disabled:!0},{name:"upstreamBandwidthTrans",mapping:"upstream_bandwidth_trans",disabled:!0},{name:"downstreamBandwidthTrans",mapping:"downstream_bandwidth_trans",disabled:!0},{name:"upstreamSpeedTrans",mapping:"upstream_speed_trans",allowBlank:!1,disabled:!0},{name:"upstreamUnitTrans",mapping:"upstream_unit_trans",disabled:!0},{name:"downstreamSpeedTrans",mapping:"downstream_speed_trans",allowBlank:!1,disabled:!0},{name:"downstreamUnitTrans",mapping:"downstream_unit_trans",disabled:!0},{name:"gameMode",mapping:"game_mode"}],convert:function(e){var t={mbps:r.su.CHAR.BANDWIDTH.SPEED_M,kbps:r.su.CHAR.BANDWIDTH.SPEED_K};function n(e){var t={value:0,unit:"kbps"};return e/1024<1?(t.value=e<1e3?e.toFixed(1):e.toFixed(0),t.unit="kbps"):(t.value=(e/1024).toFixed(1),t.unit="mbps"),t}var a=n(e.upstream_bandwidth),i=n(e.downstream_bandwidth);return a.value&&"NaN"!=a.value&&-1!=e.upstream_bandwidth?(e.upstream_bandwidth_trans=a.value+" "+t[a.unit],e.upstream_speed_trans=a.value,e.upstream_unit_trans=a.unit):(e.upstream_bandwidth_trans="---",e.upstream_speed_trans="",e.upstream_unit_trans="mbps"),i.value&&"NaN"!=i.value&&-1!=e.downstream_bandwidth?(e.downstream_bandwidth_trans=i.value+" "+t[i.unit],e.downstream_speed_trans=i.value,e.downstream_unit_trans=i.unit):(e.downstream_bandwidth_trans="---",e.downstream_speed_trans="",e.downstream_unit_trans="mbps"),e},proxy:{url:r.su.url("/admin/smart_network?form=tm_qos")}}),r.su.storeManager.define("bandwidthSetTypeStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"},{name:"content"}],data:[{name:r.su.CHAR.BANDWIDTH.BAND_TYPE_AUTO,value:"auto",boxlabel:r.su.CHAR.BANDWIDTH.BAND_TYPE_AUTO,content:"<span>"+r.su.CHAR.BANDWIDTH.BAND_TYPE_AUTO_NOTE+"</span>"},{name:r.su.CHAR.BANDWIDTH.BAND_TYPE_MANUAL,value:"manual",boxlabel:r.su.CHAR.BANDWIDTH.BAND_TYPE_MANUAL,content:""}]}),r.su.storeManager.define("bandwidthUnitStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:r.su.CHAR.BANDWIDTH.SPEED_M,value:"mbps",boxlabel:r.su.CHAR.BANDWIDTH.SPEED_M},{name:r.su.CHAR.BANDWIDTH.SPEED_K,value:"kbps",boxlabel:r.su.CHAR.BANDWIDTH.SPEED_K}]}),r.su.define("speedRecordProxy",{extend:"IPFProxy",preventSuccessEvent:!0,preventFailEvent:!0,preventErrorEvent:!0,url:r.su.url("/admin/status?form=speedtest"),writeFilter:function(e){return{operation:"get"}}}),r.su.define("bandwidthCheckInternetProxy",{extend:"IPFProxy",url:r.su.url("/admin/quick_setup?form=check_internet"),writeFilter:function(e){return{operation:"read"}}}),r.su.define("checkPrivicyProxy",{extend:"IPFProxy",url:r.su.url("/admin/qos?form=check_privicy")}),r.su.modelManager.define("bandwidthSpeedTestControl",{type:"model",fields:[{name:"speedTestInfo"},{name:"speedTestChartContainer"},{name:"speedTestDownload"},{name:"speedTestUpload"},{name:"speedTestBtn"}],proxy:null})}(jQuery),function(u){u.su.moduleManager.define("networkCheck",{services:["ajax","device"],models:["securityInfo","qualityInfo","dmz","guestNetwork","autoUpgradeModel","scanSummaryModel","wirelessSmartConn","wireless24g","wireless5g1","wireless5g2","wireless6g","wirelessSettingsControl","wireless24gControl","wireless5g1Control","wireless5g2Control","wireless6gControl"],stores:["securityGridInfoStore","qualityGridInfoStore","autoUpdateTimeStore","encryptionStore","encryption6GStore"],deps:["navigatorController","main"],views:["networkCheckView"],listeners:{ev_on_launch:function(e,t,n,a,i,r,s){t.unRegisterAutoSaveData([a.securityInfo,a.qualityInfo,a.dmz,a.guestNetwork,a.autoUpgradeModel,a.wirelessSmartConn,a.wireless24g,a.wireless5g1,a.wireless5g2,a.wireless6g,i.securityGridInfoStore,i.qualityGridInfoStore,i.autoUpdateTimeStore]),t.loadWirelessData(),a.autoUpgradeModel.load(),t.setStatus("init");i="<div class='p-t-16'>"+u.su.CHAR.HOME_SHIELD.AUTO_UPDATE_NOTE_ONE+"</div>";i+="<div class='p-t-16'>"+u.su.CHAR.HOME_SHIELD.AUTO_UPDATE_NOTE_TWO+"</div>",a.autoUpgradeModel.time.setTips(i)},ev_before_destroy:function(){this.beforeDestroy()}},init:function(r,a,s,e,n,i){this.configViews({id:"networkCheckView",items:[{id:"security-grid",configs:{questionTip:r.generateToolTip()}}]}),this.control({".security-grid,.quality-grid":{ev_operation_click:function(e,t,n){switch(t){case"DMZ":a.networkCheckView.dmzMsg.show();break;case"portForwarding":a.networkCheckView.portForwardingMsg.show();break;case"portTrigger":a.networkCheckView.portTriggeringMsg.show();break;case"guestNetwork":a.networkCheckView.guestNetworkMsg.show();break;case"firmwareVer":a.networkCheckView.normalUpdateMsg.show();break;case"wifiPwdStrength":a.networkCheckView.wifiPasswordMsg.show();break;case"channelQuality":a.networkCheckView.wifiInterferenceMsg.show()}}},"#network-scan-button":{ev_button_click:function(e){"scanning"===r.scanStatus?r.stopScan():r.startScan()}},"#dmz-msg":{ev_msg_ok:function(e,t){i.ajax.request({url:u.su.url("/admin/nat?form=dmz"),data:{operation:"write",enable:"off"},success:function(){r.updateSecurityStore("DMZ","safe"),r.showSuccessNotice()},error:r.showFailureNotice,fail:r.showFailureNotice})}},"#port-triggering-msg":{ev_msg_ok:function(e,t){i.ajax.request({url:u.su.url("/admin/nat?form=pt"),data:{operation:"disable"},success:function(){r.updateSecurityStore("portTrigger","safe")},error:r.showFailureNotice,fail:r.showFailureNotice})}},"#port-forwarding-msg":{ev_msg_ok:function(e,t){i.ajax.request({url:u.su.url("/admin/nat?form=vs"),data:{operation:"disable"},success:function(){r.updateSecurityStore("portForwarding","safe")},error:r.showFailureNotice,fail:r.showFailureNotice})}},"#guest-network-msg":{ev_msg_ok:function(e,t){i.ajax.request({url:u.su.url("/admin/wireless?form=guest_2g&form=guest_5g&form=guest_5g_2&form=guest_6g&form=guest_2g5g"),data:{operation:"write",guest_2g_enable:"off",guest_5g_2_enable:"off",guest_5g_enable:"off",guest_6g_enable:"off"},success:function(){r.updateSecurityStore("guestNetwork","safe"),r.showSuccessNotice()},error:r.showFailureNotice,fail:r.showFailureNotice})}},"#normal-update-firmware-msg":{ev_msg_ok:function(e,t){s.autoUpgradeModel.time.enable(),a.networkCheckView.autoUpdateMsg.show()},ev_msg_cancel:function(e,t){n.navigatorController.goTo("firmware")}},"#auto-update-firmware-msg":{ev_msg_ok:function(e,t){s.autoUpgradeModel.submit({success:function(){"on"===s.autoUpgradeModel.enable.getValue()&&r.updateSecurityStore("firmwareVer","safe")},error:r.showFailureNotice,fail:r.showFailureNotice})}},"#wifi-interference-msg":{ev_msg_ok:function(e,t){r.optimizeQuality().then(function(e){e=e.wl_reboot_time||r.defaultRebootTime;return r.showWiFiOptimizeProgress(e+10),r.checkOptimizeResult(e)}).then(r.optimizeSuccessHandler,r.optimizeFailHandler)}},"#wifi-password-msg":{ev_msg_close:function(e,t){r.resetWirelessModels()},ev_msg_cancel:function(e,t){r.resetWirelessModels()},ev_msg_ok:function(e,t){var n=s.wireless24g.validate()&&s.wireless5g1.validate(),a=!r.isTriband||s.wireless5g2.validate(),i=!r.supportWifi6E||s.wireless6g.validate();n&&a&&i?r.submitWirelessData():t.preventDefault()}}}),this.listen({"models.wirelessSmartConn.smartEnable":{ev_value_change:function(e,t,n){"on"===t?(r.setEnableLabel(!0),s.wireless24gControl.editField.show(),s.wirelessSettingsControl.detailFreqConfigField.hide()):(r.setEnableLabel(),s.wirelessSettingsControl.detailFreqConfigField.show())}},"models.wireless24g.enable":{ev_value_change:function(e,t,n){var a=s.wirelessSmartConn.smartEnable.getValue();"on"===t?(s.wireless24g.disabled_all.setValue("off"),s.wireless24gControl.editField.show()):(s.wireless24g.disabled_all.setValue("on"),"on"!==a&&s.wireless24gControl.editField.hide())}},"models.wireless5g1.enable":{ev_value_change:function(e,t,n){var a=s.wirelessSmartConn.smartEnable.getValue();"on"===t?(s.wireless5g1.disabled_all.setValue("off"),s.wireless5g1Control.editField.show()):(s.wireless5g1.disabled_all.setValue("on"),"on"!==a&&s.wireless5g1Control.editField.hide())}},"models.wireless5g2.enable":{ev_value_change:function(e,t,n){var a=s.wirelessSmartConn.smartEnable.getValue();"on"===t?(s.wireless5g2.disabled_all.setValue("off"),s.wireless5g2Control.editField.show()):(s.wireless5g2.disabled_all.setValue("on"),"on"!==a&&s.wireless5g2Control.editField.hide())}},"models.wireless6g.enable":{ev_value_change:function(e,t,n){"on"===t?(s.wireless6g.disabled_all.setValue("off"),s.wireless6gControl.editField.show()):(s.wireless6g.disabled_all.setValue("on"),s.wireless6gControl.editField.hide())}},"models.wireless24g.encryption":{ev_value_change:r.generateEncryption("wireless24g")},"models.wireless5g1.encryption":{ev_value_change:r.generateEncryption("wireless5g1")},"models.wireless5g2.encryption":{ev_value_change:r.generateEncryption("wireless5g2")},"models.wireless6g.encryption":{ev_value_change:function(e,t,n){switch(s.wireless6gControl.wpa3Personal6g.hide(),s.wireless6gControl.wpaEnterprise6g.hide(),s.wireless6gControl.wep6g.hide(),t){case"psk_sae":s.wireless6gControl.wpa3Personal6g.show(),s.wireless6g.pskCipher.hide(),s.wireless6g.pskVersion.setValue("sae_only"),s.wireless6g.pskVersion.record(),s.wireless6g.pskKey.setVtype("wpa3_password");break;case"owe":s.wireless6g.pskVersion.setValue("owe_only")}}}})}},function(c,i,l,a,e,d){return{securityScanFlag:!1,defaultRebootTime:20,isTriband:d.device.getIsTriband(),supportWifi6E:d.device.getConfig().supportWifi6E,stopScan:function(){var e;clearInterval(c.scanTimer),c.setStatus("incomplete"),"scanning"!==c.securityStatus&&"waiting"!==c.securityStatus||(c.setSecurityStatus("incomplete"),e=c.generateSecurityStore({},"incomplete"),a.securityGridInfoStore.loadData(e)),"scanning"!==c.qualityStatus&&"waiting"!==c.qualityStatus||(c.setQualityStatus("incomplete"),e=c.generateQualityStore({},"incomplete"),a.qualityGridInfoStore.loadData(e))},startScan:function(){var e=u(".display.security .paragraph-wrap-outer"),t=u(".display.quality .paragraph-wrap-outer");c.initStore(),c.setSummaryStatus(e),c.setSummaryStatus(t),c.setStatus("scanning"),c.scanUpdateSecurity().then(c.scanUpdateQuality).then(function(){c.getRiskNumber("qualityGridInfoStore")+c.getRiskNumber("securityGridInfoStore")?c.setStatus("error"):"incomplete"===c.scanStatus?c.setStatus("incomplete"):c.setStatus("complete")})},scanUpdateSecurity:function(){var t=u.Deferred();return c.securityScanFlag?t.reject():(c.securityScanFlag=!0,c.scanSecurity(function(){if("scanning"!==c.securityStatus)return c.securityScanFlag=!1,t.reject();var e=c.generateSecurityStore(l.securityInfo.getData()),e=(a.securityGridInfoStore.loadData(e),c.getRiskNumber("securityGridInfoStore"));c.setSecurityStatus(e||"complete"),c.securityScanFlag=!1,t.resolve()}),t.promise())},scanUpdateQuality:function(){var t=u.Deferred();return c.setQualityStatus("scanning"),c.scanQuality(function(){if("scanning"!==c.qualityStatus)return t.reject();var e=l.qualityInfo.getData(),e=(a.qualityGridInfoStore.loadData(c.generateQualityStore(e)),c.getRiskNumber("qualityGridInfoStore"));c.setQualityStatus(e||"complete"),t.resolve()}),t.promise()},setStatus:function(e){c.scanStatus=e,u("#network-check .scan-icon").attr("class","scan-icon "+e);var t=l.scanSummaryModel.summaryTitle,n=i.networkCheckView.scanButton,a={init:{title:"TAP_TO_CHECK_NETWORK",buttonTxt:"SCAN"},scanning:{title:"CHECKING_STATUS",buttonTxt:"STOP"},incomplete:{title:"INCOMPLETE",buttonTxt:"RESCAN"},complete:{title:"CONGRATULATION",buttonTxt:"RESCAN"},error:{title:"FOLLOWING_NEED_OPTIMIZED",buttonTxt:"RESCAN"}};"complete"===e?t.setText("<div class='cheers'></div>"+u.su.CHAR.HOME_SHIELD[a[e].title]):t.setText(u.su.CHAR.HOME_SHIELD[a[e].title]),n.setText(u.su.CHAR.HOME_SHIELD[a[e].buttonTxt]),"init"===e?(c.setSecurityStatus("init"),c.setQualityStatus("init")):"scanning"===e&&(c.setSecurityStatus("scanning"),c.setQualityStatus("waiting"))},setSecurityStatus:function(e){var t,n=u(".display.security .paragraph-wrap-outer");switch(c.securityStatus=e,a.securityGridInfoStore.setListStatus(""),e){case"init":t="";break;case"scanning":t=u.su.CHAR.HOME_SHIELD.SCAN_STATUS,a.securityGridInfoStore.setListStatus("<div class='scanning'></div>");break;case"complete":t=u.su.CHAR.HOME_SHIELD.PERFECT,c.setSummaryStatus(n,"perfect");break;case"incomplete":t=u.su.CHAR.HOME_SHIELD.INCOMPLETE,c.setSummaryStatus(n,"incomplete");break;default:u.isNumeric(e)&&(t=1===e?e+" "+u.su.CHAR.HOME_SHIELD.RISK:e+" "+u.su.CHAR.HOME_SHIELD.RISKS,c.setSummaryStatus(n,"error"),c.securityStatus="error")}return l.scanSummaryModel.securityStatus.setText(t),t},setQualityStatus:function(e){var t,n=u(".display.quality .paragraph-wrap-outer");switch(c.qualityStatus=e,a.qualityGridInfoStore.setListStatus(""),e){case"init":t="";break;case"scanning":t=u.su.CHAR.HOME_SHIELD.SCAN_STATUS,c.setSummaryStatus(n,"scanning"),a.qualityGridInfoStore.setListStatus("<div class='scanning'></div>");break;case"complete":t=u.su.CHAR.HOME_SHIELD.PERFECT,c.setSummaryStatus(n,"perfect");break;case"incomplete":t=u.su.CHAR.HOME_SHIELD.INCOMPLETE,c.setSummaryStatus(n,"incomplete");break;case"waiting":t=u.su.CHAR.HOME_SHIELD.WAITING_STATUS,c.setSummaryStatus(n,"waiting"),a.qualityGridInfoStore.setListStatus("<div class='waiting'>"+t+"</div>");break;default:u.isNumeric(e)&&(t=u.su.CHAR.HOME_SHIELD.TO_BE_OPTIMIZE,c.setSummaryStatus(n,"error"),c.qualityStatus="error")}return l.scanSummaryModel.qualityStatus.setText(t),t},scanSecurity:function(e){d.ajax.request({proxy:"networkScanProxy",preventSuccessEvent:!0,data:{operation:"networkScanStart",scanType:"networkSecurity"},success:function(){c.syncSecurityStore(e)}})},scanQuality:function(e){d.ajax.request({proxy:"networkScanProxy",preventSuccessEvent:!0,data:{operation:"networkScanStart",scanType:"networkQuality"},success:function(){c.syncQualityStore(e)}})},syncSecurityStore:function(e){l.securityInfo.load({data:{operation:"networkScanInfoGet"},success:function(){e&&e()},fail:function(){c.stopScan()},error:function(){c.stopScan()}})},syncQualityStore:function(t){c.scanTimer&&clearInterval(c.scanTimer);var n=setInterval(function(){l.qualityInfo.load({data:{operation:"networkQualityInfoGet"},preventSuccessEvent:!0,success:function(){var e=l.qualityInfo.getData();"checking"!==e.channelQuality&&"optimize"!==e.channelQuality&&(clearInterval(n),t)&&t()},fail:function(){clearInterval(n),c.stopScan()},error:function(){clearInterval(n),c.stopScan()}})},3200);c.scanTimer=n},getRiskNumber:function(e){return a[e].getData().filter(function(e){return e.warn}).length},checkOptimizeResult:function(e){var n=u.Deferred();return setTimeout(function(){var t=0;c.qualityTimer=setInterval(function(){l.qualityInfo.load({data:{operation:"networkQualityInfoGet"},success:function(){var e=l.qualityInfo.getData().channelQuality;20<t&&(clearInterval(c.qualityTimer),n.reject()),"checking"!==e&&"optimizing"!==e&&(clearInterval(c.qualityTimer),"safe"===e?n.resolve():n.reject())},error:function(){clearInterval(c.qualityTimer),n.reject(),c.stopScan()},fail:function(){clearInterval(c.qualityTimer),n.reject(),c.stopScan()}}),t+=1},3200)},1e3*e),n.promise()},optimizeQuality:function(){return d.ajax.requestPromise({proxy:"networkScanProxy",preventSuccessEvent:!0,data:{operation:"networkQualityStartOptimize",optimizeType:"channel"}})},showWiFiOptimizeProgress:function(e){i.networkCheckView.optimizeProgress.reset(),i.networkCheckView.wifiOptimizeMsg.show(function(){i.networkCheckView.optimizeProgress.animate({duration:1e3*e,percentageStart:0,percentageEnd:99})})},optimizeFailHandler:function(){i.networkCheckView.wifiOptimizeMsg.hide(),c.showFailureNotice()},optimizeSuccessHandler:function(){i.networkCheckView.optimizeProgress.setValue(100),setTimeout(function(){i.networkCheckView.wifiOptimizeMsg.hide(),c.updateQualityStore("safe"),c.showSuccessNotice()},1200)},initStore:function(){var e=c.generateSecurityStore({}),e=(a.securityGridInfoStore.loadData(e),a.securityGridInfoStore.show(),c.generateQualityStore({}));a.qualityGridInfoStore.loadData(e),a.qualityGridInfoStore.show()},generateSecurityStore:function(e,t){return c.generateStore(e,["DMZ","portTrigger","portForwarding","guestNetwork","wifiPwdStrength","firmwareVer"],t)},generateQualityStore:function(e,t){return c.generateStore(e,["channelQuality"],t)},generateStore:function(e,t,n){for(var a=[],i=0;i<t.length;i++){var r,s={},o=t[i],l=c.isSafe(e[o]);s.name=u.su.CHAR.HOME_SHIELD[this.getLanName(o)],u.isNumeric(e[s.key=o])&&(l="high"===(r=c.getPasswordStrengthLevel(e[o])),r=(r=(r="<div class='strength-wrapper "+r+"'>")+"{content}{content}{content}"+"</div>").replace(/{content}/g,"<div class='content'></div>"),l||(s.titleSuffix=r)),"incomplete"===n?(s.operationTxt=u.su.CHAR.HOME_SHIELD.INCOMPLETE,s.noOperation=!0,s.operationCls="incomplete"):!1===l?(s.warn=u.su.CHAR.HOME_SHIELD[this.getLanName(o)+"_WARN"],s.operationTxt=u.su.CHAR.HOME_SHIELD["OPTIMIZE_"+this.getLanName(o)],s.operationEnable=!0):l&&(s.operationCls="perfect",s.operationHover=u.su.CHAR.HOME_SHIELD[this.getLanName(o)+"_HOVER"]),a.push(s)}return a},getPasswordStrengthLevel:function(e){return e<=20?"low":e<=40?"medium":"high"},getLanName:function(e){return"wifiPwdStrength"===e?"WIFI_PASSWORD":"firmwareVer"===e?"FIRMWARE_VERSION":"portTrigger"===e?"PORT_TRIGGERING":"DMZ"===e?"DMZ":"channelQuality"===e?"WIFI_INTERFERENCE":e.replace(/([A-Z])/g,"_$1").toUpperCase()},isSafe:function(e){if(void 0!==e)return"safe"===e},updateSecurityStore:function(e,t){l.securityInfo[e].setValue(t);e=c.generateSecurityStore(l.securityInfo.getData());a.securityGridInfoStore.loadData(e),c.updateSummary()},updateQualityStore:function(e){l.qualityInfo.channelQuality.setValue(e);e=c.generateQualityStore(l.qualityInfo.getData());a.qualityGridInfoStore.loadData(e),c.updateSummary()},updateSummary:function(){var e=a.securityGridInfoStore.getData(),t=a.qualityGridInfoStore.getData(),e=e.filter(function(e){return e.warn}).length,t=(0===e&&"error"===c.securityStatus?c.setSecurityStatus("complete"):"error"===c.securityStatus&&c.setSecurityStatus(e),t.filter(function(e){return e.warn}).length),t=(0===t&&"error"===c.qualityStatus?c.setQualityStatus("complete"):"error"===c.qualityRisk&&c.setQualityStatus(t),t+e);"error"===c.scanStatus&&0===t&&c.setStatus("complete")},generateToolTip:function(){var t="<div class='question-tip'><div class='title'>"+u.su.CHAR.HOME_SHIELD.NETWORK_SECURITY+"</div>";return[{title:"WIFI_PASSWORD",content:"WIFI_TOOLTIP"},{title:"GUEST_NETWORK",content:"GUEST_NETWORK_TOOLTIP"},{title:"FIRMWARE_UPDATE",content:"FIRMWARE_UPDATE_TOOLTIP"},{title:"DMZ_TOOLTIP_TITLE",content:"DMZ_TOOLTIP"}].forEach(function(e){t=(t+="<div class='sub-title'>"+u.su.CHAR.HOME_SHIELD[e.title]+"</div>")+"<div class='content'>"+u.su.CHAR.HOME_SHIELD[e.content]+"</div>"}),t+="</div>"},setSummaryStatus:function(e,t){t=t?t+"-status":"";e.attr("class","widget-wrap-outer paragraph-wrap-outer "+t)},generateEncryption:function(e){var t={wireless24g:{controlName:"wireless24gControl",modelName:"wireless24g",wpaPersonal:"wpaPersonal24g",wpaEnterprise:"wpaEnterprise24g"},wireless5g1:{controlName:"wireless5g1Control",modelName:"wireless5g1",wpaPersonal:"wpaPersonal5g1",wpaEnterprise:"wpaEnterprise5g1"},wireless5g2:{controlName:"wireless5g2Control",modelName:"wireless5g2",wpaPersonal:"wpaPersonal5g2",wpaEnterprise:"wpaEnterprise5g2"}},n=t[e].controlName,a=t[e].modelName,i=t[e].wpaPersonal,t=t[e].wpaEnterprise,r=l[n][i],s=l[n][t];return function(e,t,n){switch(r.hide(),r.hide(),t){case u.su.securityCode.no_security:r.hide(),s.hide();break;case u.su.securityCode.psk_aes:case u.su.securityCode.psk_aes_tkip:l[a].pskKey.setVtype("psk_password"),r.show(),s.hide();case u.su.securityCode.psk_sae_personal:case u.su.securityCode.psk_sae_personal_aes:l[a].pskKey.setVtype("wpa3_password"),r.show(),s.hide();break;case u.su.securityCode.wpa_enterprise:case u.su.securityCode.wpa_enterprise_tkip:s.show(),r.hide()}}},translateModel:function(e,t){var n,a=[],i={};for(n in e)a.push(n);for(var r=0;r<a.length;r++){var s=e[a[r]];i[t+a[r]]=s}return i},setEnableLabel:function(e){var t=u.su.CHAR.WIRELESS_SETTINGS.MODE_2G;e&&(t=c.supportWifi6E&&c.isTriband?u.su.CHAR.WIRELESS_SETTINGS.MODE_2G_5G1_5G2:c.supportWifi6E?u.su.CHAR.WIRELESS_SETTINGS.MODE_2G_5G:u.su.CHAR.WIRELESS_SETTINGS.WIRELESS_RADIO),l.wireless24g.enable.setLabelField(t)},loadWirelessData:function(){l.wirelessSmartConn.load(),l.wireless24g.load(),l.wireless5g1.load(),c.isTriband&&(l.wireless5g2.load(),l.wireless5g1.enable.setLabelField(u.su.CHAR.WIRELESS_SETTINGS.MODE_5G1)),c.supportWifi6E&&(l.wireless6g.load(),l.wirelessSmartConn.smartEnable.setToolTip(u.su.CHAR.WIRELESS_SETTINGS.SMART_CONN_NOTE_6G))},getWirelessUrl:function(){var e="/admin/wireless?form=wireless_2g&form=wireless_5g";return c.isTriband&&!c.supportWifi6E?e="/admin/wireless?form=wireless_2g&form=wireless_5g&form=wireless_5g_2":!c.isTriband&&c.supportWifi6E?e="/admin/wireless?form=wireless_2g&form=wireless_5g&form=wireless_6g":c.isTriband&&c.supportWifi6E&&(e="/admin/wireless?form=wireless_2g&form=wireless_5g&form=wireless_5g_2&form=wireless_6g"),e},submitWirelessData:function(){var e=l.wireless24g.getData("submit",!0),t=l.wireless5g1.getData("submit",!0),n=c.isTriband&&l.wireless5g2.getData("submit",!0),a=c.supportWifi6E&&l.wireless6g.getData("submit",!0),e=c.translateModel(e,"wireless_2g_"),t=c.translateModel(t,"wireless_5g_"),n=c.isTriband&&c.translateModel(n,"wireless_5g_2_"),a=c.supportWifi6E&&c.translateModel(a,"wireless_6g_");if("on"===l.wirelessSmartConn.smartEnable.getValue())for(var i in delete e.wireless_2g_channel,delete e.wireless_2g_htmode,delete e.wireless_2g_hwmode,e){var r=e[i];t[i.replace(/_2g/g,"_5g")]=r,c.isTriband&&(n[i.replace(/_2g/g,"_5g_2")]=r)}var s=[e,t,n,a],o=["wireless_2g_","wireless_5g_","wireless_5g_2_","wireless_6g_"];l.wirelessSmartConn.submit(),d.ajax.request({url:u.su.url(c.getWirelessUrl()),data:u.extend(!0,{operation:"write_spf"},e,t,n,a),success:function(){for(var e,t=1/0,n=0;n<s.length;n++)if(s[n]){if("0"===(e=s[n][o[n]+"encryption"])||"owe"===e){t=0;break}e=s[n][o[n]+"psk_key"],t=(e=c.getStrengthScore(e||""))<t?e:t}c.updateSecurityStore("wifiPwdStrength",t)}})},getStrengthScore:function(e){var t=/[A-Z]/g.test(e)?1:0,n=/[a-z]/g.test(e)?1:0,a=e.replace(/[^a-zA-Z]/g,"").length,i=10*(t+n),r=e.replace(/[^0-9]/g,"").length,a=e.length-r-a,s=0,o=(n||t)+(1<=r)+(1<=a),s=3<=o?3:2<=o?2:0;return 3<=o&&n&&t&&(s+=2),a===e.length?0:s+i+10*((1<=r)+(2<=r))+(10*(1<=a)+15*(2<=a))},resetWirelessModels:function(){l.wireless24g.reset(),l.wireless5g1.reset(),l.wireless5g2.reset(),l.wireless6g.reset(),l.wirelessSmartConn.reset()},showSuccessNotice:function(){e.main.showNotice()},showFailureNotice:function(){e.main.showNotice(u.su.CHAR.COMMON.SAVE_FAILED,1)},beforeDestroy:function(){c.scanTimer&&clearInterval(c.scanTimer),c.qualityTimer&&clearInterval(c.qualityTimer)}}})}(jQuery),function(e){e.su.modelManager.define("securityInfo",{type:"model",fields:[{name:"wifiPwdStrength",mapping:"wifiPwdStrengthList",defaultValue:null,convert:function(e){e=e.map(function(e){return e.pwdStrength});return Math.min.apply(void 0,e)}},{name:"DMZ"},{name:"guestNetwork"},{name:"portTrigger"},{name:"portForwarding"},{name:"firmwareVer"}],proxy:"networkScanProxy"}),e.su.modelManager.define("qualityInfo",{type:"model",fields:[{name:"channelQuality"}],proxy:"networkScanProxy"}),e.su.modelManager.define("scanSummaryModel",{type:"model",fields:[{name:"summaryTitle"},{name:"securityStatus"},{name:"qualityStatus"},{name:"buttonTxt",defaultValue:e.su.CHAR.HOME_SHIELD.SCAN}]}),e.su.storeManager.define("securityGridInfoStore",{type:"store",fields:[{name:"name"},{name:"key"},{name:"warn"},{name:"operationCls"},{name:"titleSuffix"},{name:"operationTxt"},{name:"operationHover"}]}),e.su.storeManager.define("qualityGridInfoStore",{type:"store",fields:[{name:"name"},{name:"key"},{name:"warn"},{name:"operationCls"},{name:"titleSuffix"},{name:"operationTxt"},{name:"noOperation"},{name:"operationHover"}]}),e.su.define("networkScanProxy",{extend:"IPFProxy",url:e.su.url("/admin/avira_network_check?form=avira_network_scan")})}(jQuery),function(f){f.su.moduleManager.define("parentalControlsV2Optimize",{deps:["main","index"],services:["ajax","time","moduleManager","device"],models:["ptcrEditorModel","ptcrEnableV3","ptcrViewModel"],stores:["parentalControlsStoreV3","ptcrDayOptionsV3","ptcrOnlineDevs","ptcrOfflineDevs","ptcrSelectedDevs","dailyTimeLimitSV3","ptcrDayWeeks","websiteStore","ptcrModeOpts"],views:["parentalControlsV2OptimizeView"],listeners:{ev_on_launch:function(e,t,n,a,i,r,s){var t=this,o=n.parentalControlsV2OptimizeView;a.ptcrEnableV3.load({success:function(e){"on"===e.enable?o.ptcrContent.show():o.ptcrContent.hide()}}),i.parentalControlsStoreV3.load({success:function(e){0<e.length?o.emptyGrid.hide():o.emptyGrid.show()}}),s.ajax.request({proxy:"profileLimitProxyV3",method:"read",ajax:{async:!1},success:function(e){t.profileLimit.profileLength=Number(e.profileLength),t.profileLimit.devicesLength=Number(e.devicesLength),t.profileLimit.categoryLength=Number(e.categoryLength)}}),i.parentalControlsStoreV3.setMaxRules(t.profileLimit.profileLength),s.time.on("on_time_change",t.onTimeChange),s.time.on("on_hour24_change",t.onHour24Change),f("#add-name-conflict-hint").find("span.text").html(f.su.CHAR.PTCR_V2_OPTIMIZE.GENERAL_CONFLICT)},ev_before_destroy:function(e,t,n,a,i,r,s){t.destoryChart(),s.time.off("on_time_change",t.onTimeChange),s.time.off("on_hour24_change",t.onHour24Change)}},init:function(l,c,d,u,p,m){var o=c.parentalControlsV2OptimizeView;var t={mon:f.su.CHAR.DATEPICKER.MONDAY,tue:f.su.CHAR.DATEPICKER.TUESDAY,wed:f.su.CHAR.DATEPICKER.WEDNESDAY,thu:f.su.CHAR.DATEPICKER.THURSDAY,fri:f.su.CHAR.DATEPICKER.FRIDAY,sat:f.su.CHAR.DATEPICKER.SATURDAY,sun:f.su.CHAR.DATEPICKER.SUNDAY};this.configViews({id:"parentalControlsV2OptimizeView",items:[{id:"ptcr-grid",configs:{popEditor:{addTitle:f.su.CHAR.PTCR_V2_OPTIMIZE.ADD_PROFILE,editTitle:f.su.CHAR.PTCR_V2_OPTIMIZE.EDIT_PROFILE,content:"#ptcr-grid-editor-v2",customBtns:"#parental-ctrls-add-btns",msg:{}},paging:{items:[{name:"8",value:8,selected:!0}]},columns:[{text:f.su.CHAR.PTCR_V2_OPTIMIZE.PROFILE_NAME,dataIndex:"name",width:100,renderer:function(e,t){return m.device.getConfig().supportPatrolMark&&1===t.rule_mark?e+'<span class="pcgrid-red-dot"></span>':e}},{text:f.su.CHAR.PTCR_V2_OPTIMIZE.ONLINE_LIMIT,width:150,renderer:function(e,t){var n=m.time.getTime().getDay(),n=1<=n&&n<=5?t.enableWorkdayTimeLimit?t.workdayDailyTime:-1:t.enableWeekendTimeLimit?t.weekendDailyTime:-1,t=t.onlineTotal;return(0<t?l.min2TimeText(t):0)+" / "+(0<n?l.min2TimeText(n):"--")}},{dataIndex:"internetBlocked",text:f.su.CHAR.PTCR_V2_OPTIMIZE.INTERNET_ACCESS,width:140,renderer:function(e,t){return!0===e?f.su.CHAR.PTCR_V2_OPTIMIZE.ACCESS_DENY:f.su.CHAR.PTCR_V2_OPTIMIZE.ACCESS_ALLOW}},{xtype:"actioncolumn",text:f.su.CHAR.PTCR_V2_OPTIMIZE.ACTION,dataIndex:"internetBlocked",width:200,renderer:function(e,t){var n="<span class='seperator'>|</span>",a="";return(a+='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-internet-access btn-internet-access '+(!0===e?"off":"on")+'">')+('<span class="icon" data-tip=\''+(!0===e?f.su.CHAR.PTCR_V2_OPTIMIZE.ALLOW:f.su.CHAR.PTCR_V2_OPTIMIZE.BLOCK)+"'></span>")+'<span class="text"></span>'+"</a>"+n+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit">'+('<span class="icon" data-tip="'+f.su.CHAR.PTCR_V2_OPTIMIZE.EDIT+'"></span>')+'<span class="text"></span>'+"</a>"+n+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-insight btn-insight">'+('<span class="icon" data-tip="'+f.su.CHAR.PTCR_V2_OPTIMIZE.VIEW+'"></span>')+'<span class="text"></span>'+"</a>"+n+'<a href="javascript:void(0)" class="grid-content-btn grid-content-custom-btn-delete btn-delete">'+('<span class="icon" data-tip="'+f.su.CHAR.OPERATION.DELETE+'"></span>')+'<span class="text"></span>'+"</a>"}}]}},{id:"parental-ctrls-insight-tabs",fields:[{text:f.su.CHAR.PTCR_V2_OPTIMIZE.TIME_TAB,name:"time-chart",container:"time-chart"},{text:f.su.CHAR.PTCR_V2_OPTIMIZE.WEB_TAB,name:"website-list",container:"website-list"}]},{id:"ptcr-edit-tabs",fields:[{text:f.su.CHAR.PTCR_V2_OPTIMIZE.BASIC_INFO,name:"basic-info",container:"basic-info"},{text:f.su.CHAR.PTCR_V2_OPTIMIZE.FILTER_CONTENT,name:"filter-level",container:"filter-level"},{text:f.su.CHAR.PTCR_V2_OPTIMIZE.TIME_CONTROL,name:"time-controls",container:"time-controls"}]},{id:"ptcr-online-devices",configs:[{type:"deviceType",dataIndex:"clientType",renderer:function(e){return"<span class='device-icon "+f.su.escapeHtml(e.toLowerCase())+"'></span>"}},{type:"deviceName",dataIndex:"name",renderer:function(e,t){t=t.ownerName;return'<span class="single-line">'+f.su.escapeHtml(e)+'</span><span class="single-line'+(0<t.length?" tag":"")+'">'+f.su.escapeHtml(t)+"</span>"}},{type:"mac",dataIndex:"mac"}]},{id:"ptcr-offline-devices",configs:[{type:"deviceType",dataIndex:"clientType",renderer:function(e){return"<span class='device-icon "+f.su.escapeHtml(e.toLowerCase())+"'></span>"}},{type:"deviceName",dataIndex:"name",renderer:function(e,t){t=t.ownerName;return'<span class="single-line">'+f.su.escapeHtml(e)+'</span><span class="single-line'+(0<t.length?" tag":"")+'">'+f.su.escapeHtml(t)+"</span>"}},{type:"mac",dataIndex:"mac"}]},{id:"ptcr-selected-devices",itemRender:function(e,t){return'<div class="device-wrap">\t\t\t\t\t\t\t\t\t\t\t<span class="del-icon" data-mac="%MAC%"></span>\t\t\t\t\t\t\t\t\t\t\t<div class="name-tag-group">\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="name single-line">%NAME%</span>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="%TAG% single-line">%PROFILE%</span>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t<span class="mac">\t\t\t\t\t\t\t\t\t\t\t\t%MAC%</span>\t\t\t\t\t\t\t\t\t\t\t<span class="device-icon %TYPE%">\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t</div>'.replace(/\%MAC\%/g,f.su.escapeHtml(t.mac)).replace(/\%NAME\%/g,f.su.escapeHtml(t.name)).replace(/\%TYPE\%/g,f.su.escapeHtml(t.clientType)).replace(/\%PROFILE\%/g,f.su.escapeHtml(t.ownerName)).replace(/\%TAG\%/g,0<t.ownerName.length?"tag":"")}},{id:"insight-website-list",itemRender:function(e,t){return"<div class='website-item'>\t\t\t\t\t\t\t\t\t\t\t<span class='spent'>%TIME</span>\t\t\t\t\t\t\t\t\t\t\t<span class='url single-line'>%URL</span>\t\t\t\t\t\t\t\t\t\t\t<span class='block-container'>\t\t\t\t\t\t\t\t\t\t\t\t<span class='%EXTRACLASSblock-icon' data-url='%URL' data-tip='%HINT' data-pointer='left'>\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t</div>".replace(/\%URL/g,f.su.escapeHtml(t.website)).replace(/\%TIME/,f.su.escapeHtml(t.duration)).replace(/\%HINT/g,t.block?f.su.CHAR.PTCR_V2_OPTIMIZE.BLOCKED:f.su.CHAR.PTCR_V2_OPTIMIZE.BLOCK).replace(/\%EXTRACLASS/g,t.block?"disabled ":"")}},{id:"ptcr-dev-list",renderer:function(e){var t="";return(t+='<span class="icon device-type '+f.su.escapeHtml(e.clientType)+'"></span>')+('<span class="text single-line">'+f.su.escapeHtml(e.name)+"</span>")}},{id:"black-url-list",renderer:function(e){return'<span class="text single-line">'+f.su.escapeHtml(e)+"</span>"}},{id:"white-url-list",renderer:function(e){return'<span class="text single-line">'+f.su.escapeHtml(e)+"</span>"}},{id:"ptcr-time-list",renderer:function(e){return'<span class="week">'+t[e.whichDay]+'</span><span class="hour">'+l.hourFormatter(e.range[0])+" - "+l.hourFormatter(e.range[1])+"</span>"}},{id:"weekend-slider",configs:{convertValue:function(e){return l.min2TimeText(e)}},anchors:[30]},{id:"weekday-slider",configs:{convertValue:function(e){return l.min2TimeText(e)}},anchors:[30]}]}),this.listen({"models.ptcrEnableV3.enable":{ev_value_change:function(e,t,n){"on"===t?o.ptcrContent.show():o.ptcrContent.hide()}},"stores.parentalControlsStoreV3":{ev_loaded:function(){0<u.parentalControlsStoreV3.getSize()?o.emptyGrid.hide():o.emptyGrid.show()},ev_before_sync:function(e,t){t.preventDefault(),u.parentalControlsStoreV3.sync({success:function(e){u.parentalControlsStoreV3.loadData(e,!0)}})}},"views.parentalControlsV2OptimizeView.ptcrDayOrWeek":{ev_value_change:function(e,t,n){"day"===t?(o.parentalCtrlDaySlt.setValue(0),o.parentalCtrlDaySlt.show(),o.dayReportXLabel.show()):(o.dayReportXLabel.hide(),l.renderWeeklyChart(),(t=l.getInsightsData()).dayIndex=-1,l.renderHistoryCollection(t.weekSummary.websites,t.webType),o.parentalCtrlDaySlt.hide())}},"views.parentalControlsV2OptimizeView.parentalCtrlDaySlt":{ev_value_change:function(e,t,n){var a=l.getInsightsData(),i=a.data[t];a.dayIndex=t,i&&(t=0<i.time_limit?l.min2TimeText(i.time_limit):null,l.renderDailyChart(i.spend_online,i.per_hour,t),l.renderHistoryCollection(i.website_list,a.webType))}},"models.ptcrEditorModel.name":{ev_value_change:function(e,t){l.changeBtnStatus()}},"models.ptcrEditorModel.clientList":{ev_value_change:function(e,t,n){l.changeBtnStatus()}},"models.ptcrEditorModel.websiteType":{ev_value_change:function(e,t,n){var a=d.ptcrEditorModel,i=a.whiteList,a=a.blackList,r=o.webListNote;"black"==t?(i.hide(),a.show(),r.setField("TITLE",f.su.CHAR.PTCR_V2_OPTIMIZE.BLACK_LIST),r.setField("TIP",f.su.CHAR.PTCR_V2_OPTIMIZE.BLACK_TIPS)):(i.show(),a.hide(),r.setField("TITLE",f.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_LIST),r.setField("TIP",f.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_TIPS))}},"models.ptcrEditorModel.enableWeekendTimeLimit":{ev_value_change:function(e,t,n){var a=d.ptcrEditorModel.weekendDailyTime,i=o.disableWeekendNote;t?(a.show(),i.hide()):(a.hide(),i.show())}},"models.ptcrEditorModel.enableWorkdayTimeLimit":{ev_value_change:function(e,t,n){var a=d.ptcrEditorModel.workdayDailyTime,i=o.disableWeekdayNote;t?(a.show(),i.hide()):(a.hide(),i.show())}}}),this.control({"#parental-enable":{ev_view_change:function(){d.ptcrEnableV3.submit()}},"#system-time-settings":{ev_button_click:function(){m.moduleManager.get("navigatorController").goTo("timeSettings")}},"#ptcr-website-type":{ev_view_change:function(e,t){var n,a;"value"===t.type&&(t=t.value,n=(a=d.ptcrEditorModel).whiteList,a=a.blackList,d.ptcrViewModel.url.reset(),("black"==t?n:a).reset())}},"#ptcr-grid => a.btn-insight":{ev_grid_action_click:function(e,t){f.when(l.fetchInsightsData(t),l.initBarChart()).then(function(){o.parentalCtrlsInsightSwitch.itemClick("time-chart"),u.ptcrDayOptionsV3.loadData(l.refreshDAYS().reverse()),o.ptcrDayOrWeek.setValue("day"),o.parentalCtrlsInsightMsg.show()})}},"#insight-website-list => .block-icon":{click:function(e){var t,n,a=f(e.target||e.currentTarget);a.hasClass("disabled")||(e=(t=l.getInsightsData()).storeKey,u.parentalControlsStoreV3.getModelByKey(e).blackList.getValue().length>=l.profileLimit.categoryLength?p.main.showError(f.su.CHAR.PTCR_V2_OPTIMIZE.DEV_CATEGORY_LIMIT.replace("%1$d",l.profileLimit.categoryLength)):(n=a.attr("data-url"),e="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2_OPTIMIZE.ADD_BLACK+"</h3>",e=(e+="<p>"+l.replaceCharStr(f.su.CHAR.PTCR_V2_OPTIMIZE.ADD_BLACK_MSG,"%NAME",t.profileName)+"</p>")+"<p>"+f.su.escapeHtml(n)+"</p>",p.main.confirm(e,function(){l.changWebBlockStatus(t.ownerId,n,!0,function(){l.setInsightBlock(n),a.addClass("disabled").attr("data-tip",f.su.CHAR.PTCR_V2_OPTIMIZE.BLOCKED),u.parentalControlsStoreV3.load()})},null,f.su.CHAR.PTCR_V2_OPTIMIZE.ADD,null)))}},"#show-more":{ev_button_click:function(){var e,t=l.getInsightsData(),n=t.loadedNum,a=null,a=0<=t.dayIndex?t.data[t.dayIndex].website_list:t.weekSummary.websites;t.loadedNum>=a.length||(n=Math.min(n+5,a.length),e=f(".website-list-wrap").get(0).scrollHeight,u.websiteStore.loadData(a.slice(0,n),!0),t.loadedNum=n,t.loadedNum>=a.length&&o.showMoreBtn.hide(),setTimeout(function(){f(".website-list-wrap").animate({scrollTop:e},1e3)},100))}},"#ptcr-online-devices":{ev_item_select:function(e,t){l.respondSelDev(t,!0);var n,t=u.ptcrOnlineDevs.getModelByKey(t);1===t.dev_mark.getValue()&&(n=t.deviceId.getValue(),t=t.name.getValue(),l.examConflictList(t,n,!0),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?c.parentalControlsV2OptimizeView.addDeviceConflictHint.show():c.parentalControlsV2OptimizeView.addDeviceConflictHint.hide())},ev_item_deselect:function(e,t){l.respondDeselDev(t);var n,t=u.ptcrOnlineDevs.getModelByKey(t);1===t.dev_mark.getValue()&&(n=t.deviceId.getValue(),t=t.name.getValue(),l.examConflictList(t,n,!1),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?c.parentalControlsV2OptimizeView.addDeviceConflictHint.show():c.parentalControlsV2OptimizeView.addDeviceConflictHint.hide())}},"#ptcr-offline-devices":{ev_item_select:function(e,t){l.respondSelDev(t,!1);var n,t=u.ptcrOfflineDevs.getModelByKey(t);1===t.dev_mark.getValue()&&(n=t.deviceId.getValue(),t=t.name.getValue(),l.examConflictList(t,n,!0),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?c.parentalControlsV2OptimizeView.addDeviceConflictHint.show():c.parentalControlsV2OptimizeView.addDeviceConflictHint.hide())},ev_item_deselect:function(e,t){l.respondDeselDev(t);var n,t=u.ptcrOfflineDevs.getModelByKey(t);1===t.dev_mark.getValue()&&(n=t.deviceId.getValue(),t=t.name.getValue(),l.examConflictList(t,n,!1),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?c.parentalControlsV2OptimizeView.addDeviceConflictHint.show():c.parentalControlsV2OptimizeView.addDeviceConflictHint.hide())}},"#ptcr-selected-devices => .del-icon":{click:function(e){var e=f(e.target||e.currentTarget).attr("data-mac"),t=u.ptcrSelectedDevs.getModelByKey(e),n=t.online.getValue(),a=t.name.getValue(),t=t.deviceId.getValue();(n?u.ptcrOnlineDevs:u.ptcrOfflineDevs).unselectItems(e),l.respondDeselDev(e),l.examConflictList(a,t,!1),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?c.parentalControlsV2OptimizeView.addDeviceConflictHint.show():c.parentalControlsV2OptimizeView.addDeviceConflictHint.hide()}},"#url-input":{ev_input_enter:function(){f("#url-input-btn a.button-button").click()}},"#url-input-btn":{ev_button_click:function(){var e,t,n,a=d.ptcrViewModel.url,i=a.getValue();i&&a.validate()&&(t=(e="black"==(e=d.ptcrEditorModel).websiteType.getValue()?e.blackList:e.whiteList).getValue(),!0!==(n=l.validateKeyWeb(i,t))?a.setError(n):(e.setValue(t.concat(i)),a.reset()))}},"#ptcr-grid => a.btn-internet-access":{ev_grid_action_click:function(e,t){var t=u.parentalControlsStoreV3.getModelByKey(t),n=t.ownerId.getValue(),a=t.internetBlocked.getValue(),t=t.name.getValue(),i="",r="",r=a?(i=(i+="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2_OPTIMIZE.ALLOW_TITLE+"</h3>")+"<p>"+l.replaceCharStr(f.su.CHAR.PTCR_V2_OPTIMIZE.ALLOW_MSG,"%name",t)+"</p>",f.su.CHAR.PTCR_V2_OPTIMIZE.ALLOW):(i=(i+="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2_OPTIMIZE.BLOCK_TITLE+"</h3>")+"<p>"+l.replaceCharStr(f.su.CHAR.PTCR_V2_OPTIMIZE.BLOCK_MSG,"%name",t)+"</p>",f.su.CHAR.PTCR_V2_OPTIMIZE.BLOCK);p.main.confirm(i,function(){l.toggleProfileStatus(n,!a)},null,r,f.su.CHAR.OPERATION.CANCEL)}},"#ptcr-grid":{ev_grid_edit:function(e,t){"add"===t?(o.parentalCtrlsEditSwitch.setSupportViewSwitch(!1),o.parentalCtrlsAddBtnsLeft.setText(f.su.CHAR.PTCR_V2_OPTIMIZE.CANCEL),o.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PTCR_V2_OPTIMIZE.NEXT),u.parentalControlsStoreV3.getPlugin("editor").hideBtns(),o.parentalCtrlsAddBtns.show(),o.parentalCtrlsAddBtnsRight.disable(),c.parentalControlsV2OptimizeView.basicInfoConflictTip.hide(),l.loadDeviceList()):(o.parentalCtrlsEditSwitch.setSupportViewSwitch(!0),u.parentalControlsStoreV3.getPlugin("editor").showBtns(),o.parentalCtrlsAddBtns.hide(),o.parentalCtrlsEditSwitch.show(),m.device.getConfig().supportPatrolMark&&1===u.parentalControlsStoreV3.getModelByKey(t).rule_mark.getValue()&&(t=u.parentalControlsStoreV3.getModelByKey(t).viewObjs[0].domId,f("#"+t).find(".pcgrid-red-dot").hide()),f("#edit-name-conflict-hint .closable").click(function(){c.parentalControlsV2OptimizeView.basicInfoConflictTip.hide()}),f("#add-name-conflict-hint .closable").click(function(){c.parentalControlsV2OptimizeView.addDeviceConflictHint.hide()}),t=d.ptcrEditorModel.clientList.getValue(),l.loadDeviceList(),l.checkClientList(t)),o.parentalCtrlsEditSwitch.switchField("basic-info")},ev_grid_before_save:function(e,t){return!d.ptcrEditorModel.ownerId.getValue()||l.validateBeforeEditSave(t)},ev_grid_save:function(){l.clearConfirm()},ev_grid_cancel:function(){l.selectedConflictName=[],c.parentalControlsV2OptimizeView.basicInfoConflictTip.hide(),c.parentalControlsV2OptimizeView.addDeviceConflictHint.hide()}},"#ptcr-grid => a.btn-delete":{ev_grid_action_click:function(e,t){var n=u.parentalControlsStoreV3.getModelByKey(t).name.getValue(),n=l.replaceCharStr(f.su.CHAR.PTCR_V2_OPTIMIZE.DEL_CONFIRM,"%name",n);p.main.confirm(n,function(){l.deleteProfile(t)},null,f.su.CHAR.OPERATION.DELETE,f.su.CHAR.OPERATION.CANCEL)}},"#ptcr-dev-list":{ev_add_item:function(e){l.refreshDeviceList(l.deviceData),l.visibleNoSelDevNote(),o.parentalCtrlsAddDevicesMsg.show(),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?c.parentalControlsV2OptimizeView.addDeviceConflictHint.show():c.parentalControlsV2OptimizeView.addDeviceConflictHint.hide()}},"#ptcr-dev-list => .del-icon":{click:function(e){for(var t=f(e.target||e.currentTarget).attr("data-id"),n="",a=0;a<l.deviceData.length;a++)if(t==l.deviceData[a].device_id){n=l.deviceData[a].name;break}for(a=0;a<l.allDeviceNameStack[n].length;a++)if(l.allDeviceNameStack[n][a].device_id==t){l.allDeviceNameStack[n][a].selected=!1;break}e=d.ptcrEditorModel.clientList.getValue();l.checkClientList(e)}},"#ptcr-time-list":{ev_add_item:function(){for(var e,t=d.ptcrEditorModel.timeTable.getValue(),n=0,a=t.length,i={};n<a;n++)i[(e=t[n]).whichDay]||(i[e.whichDay]=[]),i[e.whichDay].push(e.range);var i=JSON.stringify(i),r=d.ptcrViewModel.timeTable;r.setValue(i),r.setSnapshot(i),o.ptcrTimeTableMsg.show()}},"#ptcr-add-dev-msg":{ev_msg_ok:function(e,t){t.preventDefault();var n=u.ptcrSelectedDevs,a=n.getSize();if(a>l.profileLimit.devicesLength)r=f.su.CHAR.PTCR_V2_OPTIMIZE.DEV_CATEGORY_LIMIT.replace("%1$d",l.profileLimit.devicesLength),p.main.showError(r),t.preventDefault();else{for(var i,r,s=0,o="";s<a;s++)""!==(i=n.getModelByIndex(s)).ownerName.getValue()&&(o+="<p>"+f.su.escapeHtml(i.mac.getValue())+" ,"+f.su.escapeHtml(i.name.getValue())+"</p>");0==o.length?l.saveMsgSelDev():(r=d.ptcrEditorModel.name.getValue(),t="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2_OPTIMIZE.MOVE_DEVS+"</h3>",t+="<p>"+(r?l.replaceCharStr(f.su.CHAR.PTCR_V2_OPTIMIZE.MOVE_DEVS_TIP1,"%name",r):f.su.CHAR.PTCR_V2_OPTIMIZE.MOVE_DEVS_TIP2)+"</p>",p.main.confirm(t="<div class='move-msg-content'>"+(t+=o)+"</div>",l.saveMsgSelDev,null,f.su.CHAR.PTCR_V2_OPTIMIZE.CONTINUE)),m.device.getConfig().supportPatrolMark&&0!==l.selectedConflictName.length?(r=f.su.CHAR.PTCR_V2_OPTIMIZE.NAME_CONFLICT.replace("%name%",l.selectedConflictName.join(" ")),f("#edit-name-conflict-hint").find("span.text").html(r),c.parentalControlsV2OptimizeView.basicInfoConflictTip.show()):c.parentalControlsV2OptimizeView.basicInfoConflictTip.hide()}},ev_msg_no:function(e,t){l.selectedConflictName=[];var n=d.ptcrEditorModel.clientList.getValue();if(0==n.length)c.parentalControlsV2OptimizeView.addDeviceConflictHint.hide();else{for(var a=0;a<l.deviceData.length;a++)l.examConflictList(l.deviceData[a].name,l.deviceData[a].device_id,!1);for(var i,a=0;a<n.length;a++)l.examConflictList(n[a].name,n[a].deviceId,!0);m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?(i=f.su.CHAR.PTCR_V2_OPTIMIZE.NAME_CONFLICT.replace("%name%",l.selectedConflictName.join(" ")),f("#edit-name-conflict-hint").find("span.text").html(i),c.parentalControlsV2OptimizeView.basicInfoConflictTip.show()):c.parentalControlsV2OptimizeView.basicInfoConflictTip.hide()}},ev_msg_close:function(e,t){var n=d.ptcrEditorModel.clientList.getValue();if(0==n.length)c.parentalControlsV2OptimizeView.addDeviceConflictHint.hide();else{for(var a=0;a<l.deviceData.length;a++)l.examConflictList(l.deviceData[a].name,l.deviceData[a].device_id,!1);for(var i,a=0;a<n.length;a++)l.examConflictList(n[a].name,n[a].deviceId,!0);m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?(i=f.su.CHAR.PTCR_V2_OPTIMIZE.NAME_CONFLICT.replace("%name%",l.selectedConflictName.join(" ")),f("#edit-name-conflict-hint").find("span.text").html(i),c.parentalControlsV2OptimizeView.basicInfoConflictTip.show()):c.parentalControlsV2OptimizeView.basicInfoConflictTip.hide()}}},"#ptcr-time-table-msg":{ev_msg_ok:function(){var e=d.ptcrViewModel.timeTable.getValue(),e=function(e){var t,n=[];for(t in e)for(var a=0,i=(dayRanges=e[t]).length;a<i;a++)n.push({whichDay:t,range:dayRanges[a]});return n}(JSON.parse(e));d.ptcrEditorModel.timeTable.setValue(e)}},"#parental-ctrls-add-btns-left":{ev_button_click:function(){var e=o.parentalCtrlsEditSwitch,t=e.getCurField(),n=u.parentalControlsStoreV3.getPlugin("editor");"basic-info"==t?(n.getMsgBox().close(),n.cancelEdit()):("filter-level"==t?o.parentalCtrlsAddBtnsLeft.setText(f.su.CHAR.PTCR_V2_OPTIMIZE.CANCEL):o.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PTCR_V2_OPTIMIZE.NEXT),e.switchPrev())}},"#parental-ctrls-add-btns-right":{ev_button_click:function(){var e=o.parentalCtrlsEditSwitch,t=e.getCurField(),n=u.parentalControlsStoreV3.getPlugin("editor"),a=d.ptcrEditorModel;if("basic-info"==t)o.parentalCtrlsAddBtnsLeft.setText(f.su.CHAR.PTCR_V2_OPTIMIZE.BACK),e.switchNext();else if("filter-level"==t){var t=a.websiteType.getValue(),i=a.whiteList.getValue();"white"!=t||i&&0<i.length?(o.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PTCR_V2_OPTIMIZE.SAVE),e.switchNext()):(r="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_EMPTY_TITLE+"</h3>",r+="<p>"+f.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_EMPTY_NOTE+"</p>",p.main.confirm(r,function(){o.parentalCtrlsAddBtnsRight.setText(f.su.CHAR.PTCR_V2_OPTIMIZE.SAVE),e.switchNext()},null,f.su.CHAR.PTCR_V2_OPTIMIZE.CONTINUE,f.su.CHAR.OPERATION.CANCEL))}else{var r,t=a.timeTable.getValue(),s=n.getSaveBtn().dom();if(!(t&&0<t.length))return r="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2_OPTIMIZE.NO_TIME_TABLE+"</h3>",r+="<p>"+f.su.CHAR.PTCR_V2_OPTIMIZE.NO_TIME_TABLE_TIP+"</p>",p.main.confirm(r,function(){l.pushConfirm("timetable"),s.triggerHandler("ev_button_click")},l.clearConfirm,f.su.CHAR.PTCR_V2_OPTIMIZE.CONTINUE,f.su.CHAR.OPERATION.CANCEL),!1;s.triggerHandler("ev_button_click")}}}})}},function(d,a,v,T,o,i){function n(e){var t=e%12;return(0==t?12:t)+(1<=e/12&&e/12<2?" PM":" AM")}function r(e){var t=e.toString();return(1===t.length?"0"+e:t)+":00"}var l,d=this,c=a.parentalControlsV2OptimizeView,s=[],u=[],p={1:"JAN",2:"FEB",3:"MAR",4:"APR",5:"MAY",6:"JUN",7:"JUL",8:"AUG",9:"SEP",10:"OCT",11:"NOV",12:"DEC"},m=[];return{profileLimit:{profileLength:16,devicesLength:16,categoryLength:32},allDeviceNameStack:{},selectedConflictName:[],deviceData:[],onTimeChange:function(e,t){var n=i.time.getHour24(),t=i.time.format(t,"yyyy-MM-dd HH:mm:ss",n);c.currentTime.setValue(t)},onHour24Change:function(e,t){d.hourFormatter=t?r:n,v.ptcrViewModel.timeTable.setIs24(t)},replaceCharStr:function(e,t,n){return e.replace(t,f.su.escapeHtml(n))},hourFormatter:n,clearConfirm:function(){m=[]},pushConfirm:function(e){m.push(e)},validateBeforeEditSave:function(e){var t,n=v.ptcrEditorModel,a=n.websiteType.getValue(),i=n.whiteList.getValue(),n=n.timeTable.getValue(),r=T.parentalControlsStoreV3.getPlugin("editor").getSaveBtn().dom(),a=m.indexOf("white")<0&&"white"==a&&!(i&&0<i.length),i=m.indexOf("timetable")<0&&!(n&&0<n.length),s=a&&i;return a?(t="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_EMPTY_TITLE+"</h3>",t+="<p>"+f.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_EMPTY_NOTE+"</p>",o.main.confirm(t,function(e){d.pushConfirm("white"),s&&e.preventDefault(),setTimeout(function(){r.triggerHandler("ev_button_click")},50)},d.clearConfirm,f.su.CHAR.PTCR_V2_OPTIMIZE.CONTINUE,f.su.CHAR.OPERATION.CANCEL),e.preventDefault(),!1):!i||(t="<h3 class='ptcr-confirm-title'>"+f.su.CHAR.PTCR_V2_OPTIMIZE.NO_TIME_TABLE+"</h3>",t+="<p>"+f.su.CHAR.PTCR_V2_OPTIMIZE.NO_TIME_TABLE_TIP+"</p>",o.main.confirm(t,function(){d.pushConfirm("timetable"),setTimeout(function(){r.triggerHandler("ev_button_click")},50)},d.clearConfirm,f.su.CHAR.PTCR_V2_OPTIMIZE.CONTINUE,f.su.CHAR.OPERATION.CANCEL),e.preventDefault(),!1)},getEcharts:function(){var e=f.Deferred();return void 0===window.echarts?f.su.router.loadFile("js/libs/echarts.min.js",function(){e.resolve(window.echarts)}):window.echarts&&e.resolve(window.echarts),e.promise()},initBarChart:function(){var e=c.dayReportXLabel;return e.setField("FIRST",d.hourFormatter(0)),e.setField("SECOND",d.hourFormatter(6)),e.setField("THIRD",d.hourFormatter(12)),e.setField("FOURTH",d.hourFormatter(18)),d.getEcharts().then(function(e){return l||(l=e.init(f("#ptcr-bar-chart").get(0))).setOption({color:["rgba(80,204,215,0.30)"],grid:{show:!0,borderColor:"#BEBEBE",borderWidth:.5,top:30,left:0,right:5,bottom:0,containLabel:!0},xAxis:[{type:"category",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{color:"#A7A9AC"},splitLine:{show:!0,lineStyle:{type:"dotted"}}}],yAxis:[{type:"value",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{color:"#A7A9AC"}}],series:[{type:"bar",barWidth:"60%",silent:!0}]}),l})},destoryChart:function(){l&&l.clear()},respondSelDev:function(e,t){var n=T.ptcrSelectedDevs,t=(t?T.ptcrOnlineDevs:T.ptcrOfflineDevs).getModelByKey(e).getData(),e=n.getData();n.loadData(e.concat(t)),d.visibleNoSelDevNote()},respondDeselDev:function(e){T.ptcrSelectedDevs.removeDataByKey(e),d.visibleNoSelDevNote()},visibleNoSelDevNote:function(){0<T.ptcrSelectedDevs.getSize()?c.noSelDevNote.hide():c.noSelDevNote.show()},saveMsgSelDev:function(){v.ptcrEditorModel.clientList.setValue(T.ptcrSelectedDevs.getData("submit")),c.parentalCtrlsAddDevicesMsg.close()},validateKeyWeb:function(e,t){var n=d.profileLimit.categoryLength;if(t.length>=n)return f.su.CHAR.PTCR_V2_OPTIMIZE.DEV_CATEGORY_LIMIT.replace("%1$d",n);for(var a=-1,i=0;i<t.length;i++)if(t[i]==e){a=i;break}return!(0<=a)||f.su.CHAR.PTCR_V2_OPTIMIZE.KEYWORD_EXIST},deleteProfile:function(e){T.parentalControlsStoreV3.load({data:{operation:"remove",key:e},success:function(){T.parentalControlsStoreV3.load(),o.main.showNotice(f.su.CHAR.COMMON.SAVED)}})},toggleProfileStatus:function(e,t){i.ajax.request({proxy:"patrolOwnerBlockProxyV3",method:"write",data:{owner_id:e,internet_blocked:t},success:function(){T.parentalControlsStoreV3.load()}})},changWebBlockStatus:function(e,t,n,a){i.ajax.request({url:f.su.url("/admin/smart_network?form=patrol_owner_website_block"),data:{operation:"write",owner_id:e,blocked_status:n,website:t},success:function(e){a&&a(e)}})},setInsightBlock:function(e){for(var t,n,a,i=u.data,r=i.length;r--;)if(a=i[r].website_list,f.isArray(a))for(t=a.length;t--;)(n=a[t]).website===e&&(n.block=!0);for(t=(i=u.weekSummary.websites).length;t--;)(n=i[t]).website===e&&(n.block=!0)},getInsightsData:function(){return u},fetchInsightsData:function(s){var o=f.Deferred(),l=T.parentalControlsStoreV3.getModelByKey(s),c=l.ownerId.getValue();return i.ajax.request({proxy:"ptcrInsightProxyV3",data:{ownerId:c},success:function(e){for(var t=e,n=t.length,a=null;n--;){f.isArray(t[n].website_list)||(t[n].website_list=[]);for(var i,r=(a=t[n].website_list).length;r--;)(i=a[r].website)&&0!=i.length||a.splice(r,1)}u={ownerId:c,profileName:l.name.getValue(),storeKey:s,dayIndex:0,loadedNum:0,webType:l.websiteType.getValue(),data:t,weekSummary:d.calculateSummary(t)},o.resolve(u)},fail:o.reject,error:o.reject}),o},getDAYS:function(){return s},refreshDAYS:function(){s=[];for(var e,t=0,n=i.time.getTime().getTime();t<7;t++)e=new Date(n-864e5*t),s.push({value:t,name:d.convertLocalString(e),day:e.getDay()});return s[0].name=f.su.CHAR.DATE.TODAY,s[1].name=f.su.CHAR.DATE.YESTERDAY,s},convertLocalString:function(e){var t=e.getDate(),e=e.getMonth()+1;return f.su.CHAR.DATEPICKER[p[e]]+" "+t},changeBtnStatus:function(){var e=v.ptcrEditorModel,t=e.ownerId.getValue(),n=e.name.getValue(),e=e.clientList.getValue(),n=n&&n.length||0,n=0<n&&n<=64&&e&&0<e.length,e=T.parentalControlsStoreV3.getPlugin("editor").getSaveBtn();null==t&&(e=c.parentalCtrlsAddBtnsRight),n?e.enable():e.disable()},min2TimeText:function(e){var t;return e<60?e+f.su.CHAR.PTCR_V2_OPTIMIZE.MINS:(t=e%60,parseInt(e/60,10)+f.su.CHAR.PTCR_V2_OPTIMIZE.HOUR+(t?" "+t+f.su.CHAR.PTCR_V2_OPTIMIZE.MINS:""))},calculateSummary:function(e){for(var t,n,a,i=0,r=[],s={},o=[],l=0,c=e.length;l<c;l++)if(t=e[l],i+=n=parseInt(t.spend_online),r.push(n),f.isArray(t.website_list))for(var d,u=t.website_list.length;u--;)(d=t.website_list[u]).spend_online=Number(d.spend_online),s[d.website]?s[d.website].spend_online+=d.spend_online:(d.spend_online=d.spend_online,s[d.website]=f.extend({},d));for(a in s)o.push(s[a]);delete s;for(var p=20;p--;)for(var m,g=o.length;0<--g;)o[g].spend_online>o[g-1].spend_online&&(m=o[g-1],o[g-1]=o[g],o[g]=m);return{total:i,perDay:r.reverse(),websites:o.slice(0,20)}},renderDailyChart:function(e,t,n){c.dayTotal.setField("TIME_ONLINE",d.min2TimeText(e)),n?(c.dayLimit.setField("TIME_LIMIT",n),c.dayLimit.show()):c.dayLimit.hide(),c.dayTotal.show();for(var a=[],i=0;i<24;i++)a.push(i);l.setOption({series:[{data:t}],yAxis:[{max:60,interval:30,axisLabel:{formatter:function(e){return 0===e?"":e+("s"==f.su.widgetSize?f.su.CHAR.PTCR_V2_OPTIMIZE.MINS_SHORT:f.su.CHAR.PTCR_V2_OPTIMIZE.MINS)}},splitLine:{show:!1},splitArea:{show:!0,areaStyle:{color:["rgba(255,255,255,0)","rgba(239,239,239,0.78)"]}}}],xAxis:[{data:a,axisLabel:{show:!1},splitLine:{interval:function(e){return 0!==e&&24!==e&&e%6==0}}}]})},renderHistoryCollection:function(e,t){var n=0,a=[];0===e.length?c.noWebsiteNote.show():(n=(a=e.slice(0,10)).length,u.loadedNum=n,c.noWebsiteNote.hide()),T.websiteStore.loadData(a,!0),T.websiteStore.removeClass("white black").addClass(t),n<e.length?c.showMoreBtn.show():c.showMoreBtn.hide()},renderWeeklyChart:function(){var e=d.getInsightsData().weekSummary.perDay;c.dayLimit.hide(),c.dayTotal.hide();for(var t=e[(s=e.length)-1],n=s-1;n--;)e[n]>t&&(t=e[n]);for(var a=2*Math.ceil(t/60/2)*60,a=Math.max(a,240),i=[],r=d.getDAYS(),s=r.length,o=0;o<s;o++)i.push(r[o].name);l.setOption({series:[{data:e}],yAxis:[{max:a,interval:a/2,axisLabel:{show:!0,formatter:function(e){return 0===e?"":e/60+f.su.CHAR.PTCR_V2_OPTIMIZE.HOUR}}}],xAxis:[{data:i,axisLabel:{show:!0},splitLine:{interval:function(e){return 0!==e&&7!==e}}}]})},examConflictList:function(e,t,n){0<=d.selectedConflictName.indexOf(e)&&d.selectedConflictName.splice(d.selectedConflictName.indexOf(e),1);for(var a=0;a<d.allDeviceNameStack[e].length;a++)t==d.allDeviceNameStack[e][a].device_id?d.allDeviceNameStack[e][a].selected=n:t!==d.allDeviceNameStack[e][a].device_id&&d.allDeviceNameStack[e][a].selected===!n&&d.selectedConflictName.indexOf(e)<0&&d.selectedConflictName.push(e);return!1},checkClientList:function(e){if(!1===i.device.getConfig().supportPatrolMark)a.parentalControlsV2OptimizeView.basicInfoConflictTip.hide();else{d.selectedConflictName=[];for(var t,n=0;n<e.length;n++)d.examConflictList(e[n].name,e[n].deviceId,!0);0<d.selectedConflictName.length?(t=f.su.CHAR.PTCR_V2_OPTIMIZE.NAME_CONFLICT.replace("%name%",d.selectedConflictName.join(" ")),f("#edit-name-conflict-hint").find("span.text").html(t),a.parentalControlsV2OptimizeView.basicInfoConflictTip.show()):a.parentalControlsV2OptimizeView.basicInfoConflictTip.hide()}},loadDeviceList:function(e){d.allDeviceNameStack={},i.ajax.request({proxy:"onlineDevProxyV3",method:"load",ajax:{async:!1},success:function(e){d.deviceData=e;for(var t=0;t<e.length;t++){var n,a=e[t];null==d.allDeviceNameStack[a.name]&&(d.allDeviceNameStack[a.name]=[]),1===a.dev_mark&&(n=f.extend(a,{selected:!1}),d.allDeviceNameStack[a.name].push(n))}}})},refreshDeviceList:function(e){for(var t=T.parentalControlsStoreV3.getData(),n={},a=e.length,i=v.ptcrEditorModel,r=i.ownerId.getValue(),s=0;s<t.length;s++)r!==t[s].ownerId&&(n[t[s].ownerId]=t[s].name);for(var o=0;o<a;o++)n[e[o].owner_id]?e[o]["ownerName"]=n[e[o].owner_id]:e[o]["ownerName"]="";for(var l,c=i.clientList.getValue(),d=[],u=[],p=[],m=0,g=c.length;m<g;m++)l=c[m],d.push(l.mac),n[l.ownerId]?l["ownerName"]=n[l.ownerId]:l["ownerName"]="";for(var f,_=0,w=[],C=[];_<a;_++)"1"==(f=e[_]).online?(w.push(f),0<=d.indexOf(f.mac)&&u.push(f.mac)):(C.push(f),0<=d.indexOf(f.mac)&&p.push(f.mac));T.ptcrOnlineDevs.loadData(w,!0),T.ptcrOfflineDevs.loadData(C,!0),T.ptcrSelectedDevs.loadData(c),T.ptcrOnlineDevs.selectItems(u),T.ptcrOfflineDevs.selectItems(p)}}})}(jQuery),function(o){var l=["sun","mon","tue","wed","thu","fri","sat"];function s(e){for(var t,n,a=0,i=[],r=0,s=(e=o.isArray(e)?e:[]).length;r<s;r++){for(t=e[r][0],n=e[r][1];a<t;)i[a]=0,a++;for(;a<n;)i[a]=1,a++}for(;a<24;)i[a]=0,a++;return i}function c(e){for(var t,n={},a=0,i=l.length;a<i;a++)n[t=l[a]]=function(e){var t,n=[],a=-1;if(e&&24==e.length){for(var i=0,r=!1;i<24;i++)r||1!=e[i]?r&&0==e[i]&&(t=i,n.push([a,t]),r=!1):(r=!0,a=i);r&&n.push([a,24])}return n}(e[t+"_time"]);return n}o.su.define("ptcrStoreProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_owner_list")}),o.su.modelManager.define("ptcrEnableV3",{fields:[{name:"enable"}],proxy:{url:o.su.url("/admin/smart_network?form=patrol_enable")}}),o.su.storeManager.define("parentalControlsStoreV3",{type:"store",fields:[{name:"ownerId",mapping:"owner_id"},{name:"name"},{name:"clientList",mapping:"client_list",defaultValue:[],convert:function(e){return e=o.isArray(e)?e:[]}},{name:"internetBlocked",mapping:"internet_blocked"},{name:"whiteList",mapping:"white_website_list",defaultValue:[],convert:function(e){return e=o.isArray(e)?e:[]}},{name:"blackList",mapping:"black_website_list",defaultValue:[],convert:function(e){return e=o.isArray(e)?e:[]}},{name:"websiteType",mapping:"website_type",defaultValue:"black"},{name:"enableWorkdayTimeLimit",mapping:"enable_workday_time_limit",defaultValue:!1},{name:"workdayDailyTime",mapping:"workday_daily_time",defaultValue:"30"},{name:"enableWeekendTimeLimit",mapping:"enable_weekend_time_limit",defaultValue:!1},{name:"weekendDailyTime",mapping:"weekend_daily_time",defaultValue:"30"},{name:"onlineTotal",mapping:"online_total"},{name:"mon_time"},{name:"tue_time"},{name:"wed_time"},{name:"thu_time"},{name:"fri_time"},{name:"sat_time"},{name:"sun_time"},{name:"rule_mark"}],convert:function(e){return(e=o.isArray(e)?e:[]).reverse()},proxy:"ptcrStoreProxyV3"}),o.su.storeManager.define("websiteStore",{type:"store",keyProperty:"website",fields:[{name:"duration",mapping:"spend_online",convert:function(e){var t;return e<60?e+o.su.CHAR.PTCR_V2_OPTIMIZE.MINS:(t=e%60,parseInt(e/60,10)+o.su.CHAR.PTCR_V2_OPTIMIZE.HOUR+(t?" "+t+o.su.CHAR.PTCR_V2_OPTIMIZE.MINS:""))}},{name:"block"}]}),o.su.modelManager.define("ptcrEditorModel",{type:"model",fields:[{name:"ownerId"},{name:"name",maxLength:64,allowBlank:!1},{name:"clientList",convert:function(e){for(var t=0;t<e.length;t++)e[t].deviceId=e[t].device_id,delete e[t].device_id,e[t].ownerId=e[t].owner_id,delete e[t].owner_id,e[t].clientType=e[t].client_type,delete e[t].client_type;return e},serialize:function(e){for(var t=0;t<e.length;t++)e[t].device_id=e[t].deviceId,delete e[t].deviceId,e[t].owner_id=e[t].ownerId,delete e[t].ownerId,e[t].client_type=e[t].clientType,delete e[t].clientType;return e}},{name:"whiteList"},{name:"blackList"},{name:"websiteType"},{name:"enableWorkdayTimeLimit"},{name:"workdayDailyTime"},{name:"enableWeekendTimeLimit"},{name:"weekendDailyTime"},{name:"timeTable"}],convert:function(e){for(var t=c(e),n=0,a=[];n<7;n++)for(var i,r,s=0,o=(r=t[i=l[n]]).length;s<o;s++)a.push({whichDay:i,range:r[s]});return e.timeTable=a,e},serialize:function(e){for(var t,n=e.timeTable,a={},i=0,r=n.length;i<r;i++)a[(t=n[i]).whichDay]?a[t.whichDay].push(t.range):a[t.whichDay]=[t.range];return e.mon_time=s(a.mon),e.tue_time=s(a.tue),e.wed_time=s(a.wed),e.thu_time=s(a.thu),e.fri_time=s(a.fri),e.sat_time=s(a.sat),e.sun_time=s(a.sun),delete e.timeTable,e}}),o.su.storeManager.define("ptcrModeOpts",{type:"store",fields:[{name:"value"},{name:"boxlabel"}],data:[{value:"black",boxlabel:o.su.CHAR.PTCR_V2_OPTIMIZE.BLACK_LIST},{value:"white",boxlabel:o.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_LIST}]}),o.su.define("ptcrInsightProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_insights"),readFilter:function(e){return e.data.insights},writeFilter:function(e){return{operation:"read",owner_id:e.ownerId}}}),o.su.storeManager.define("ptcrDayOptionsV3",{type:"store",fields:[{name:"name"},{name:"value"}]}),o.su.modelManager.define("ptcrViewModel",{fields:[{name:"url",maxLength:64,allowBlank:!0,vtype:"string_visible_no_comma"},{name:"timeTable"}]}),o.su.storeManager.define("ptcrOnlineDevs",{type:"store",keyProperty:"mac",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"online",convert:function(e){return"1"==e}},{name:"ownerName"},{name:"dev_mark"},{name:"selected",defaultValue:!1}],convert:function(e){return e.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),e}}),o.su.storeManager.define("ptcrOfflineDevs",{type:"store",keyProperty:"mac",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"online",convert:function(e){return"1"==e}},{name:"ownerName"},{name:"dev_mark"}],convert:function(e){return e.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),e}}),o.su.storeManager.define("ptcrSelectedDevs",{type:"store",keyProperty:"mac",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"online",convert:function(e){return"1"==e}},{name:"ownerName"}]}),o.su.storeManager.define("dailyTimeLimitSV3",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}]}),o.su.storeManager.define("ptcrDayWeeks",{type:"store",fields:[{name:"name"},{name:"value"},{name:"selected"},{name:"boxlabel"}],data:[{name:o.su.CHAR.PTCR_V2_OPTIMIZE.PER_DAY,value:"day",selected:!0,boxlabel:o.su.CHAR.PTCR_V2_OPTIMIZE.PER_DAY},{name:o.su.CHAR.PTCR_V2_OPTIMIZE.PER_WEEK,value:"week",selected:!1,boxlabel:o.su.CHAR.PTCR_V2_OPTIMIZE.PER_WEEK}]}),o.su.define("patrolOwnerBlockProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_owner_block")}),o.su.define("onlineDevProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_devices")}),o.su.define("profileLimitProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_limit"),readFilter:function(e){return{profileLength:e.data.profile_len,devicesLength:e.data.devices_len,categoryLength:e.data.category_len}}})}(jQuery),function(u){u.su.moduleManager.define("parentalControlsV4",{deps:["main"],services:["time","device","ajax","moduleManager"],models:["ptcrViewModelV4","ptcrEditorV4Model","timeSettings","allowListModel","parentalControlsStatus"],stores:["parentalControlsStoreV4","ptcrAgeStore","ptcrSelectedDevsV4","ptcrOnlineDevsV4","ptcrOfflineDevsV4","ptcrCategoriesV4","setTimeModeV4Store","timezoneStore","blockHistoryStore"],views:["parentalControlsV4Views"],listeners:{ev_on_launch:function(e,t,n,a,i,r,s){this.unRegisterAutoSaveData([a.ptcrEditorV4Model,a.timeSettings]),t.initPageData(),s.time.on("on_time_change",t.onTimeChange),s.time.on("on_hour24_change",t.onHour24Change)},ev_before_destroy:function(e,t,n,a,i,r,s){s.time.off("on_time_change",t.onTimeChange),s.time.off("on_hour24_change",t.onHour24Change)}},init:function(r,a,i,s,o,e){this.configViews({id:"parentalControlsV4Views",items:[{id:"ptcr-grid",configs:{popEditor:{addTitle:u.su.CHAR.PTCR_V4.ADD_PROFILE,editTitle:u.su.CHAR.PTCR_V4.EDIT_PROFILE,content:"#ptcr-grid-editor-v4",customBtns:"#parental-ctrls-add-btns"},columns:[{text:u.su.CHAR.PTCR_V4.NAME,dataIndex:"name",width:100,renderer:function(e,t){return r.supportPatrolMark&&1===t.ruleMark?e+'<span class="pcgrid-red-dot"></span>':e}},{text:u.su.CHAR.PTCR_V4.TIME_SPENT_ONLINE,dataIndex:"todayOnlineTime",width:100,renderer:function(e,t){return t.available?(t="",0<parseInt(e/60)&&(t+=parseInt(e/60)+" "+u.su.CHAR.PTCR_V4.HOUR+" "),0<e%60&&(t+=e%60+" "+u.su.CHAR.PTCR_V4.MIN),""===t?0:t):"-"}},{text:u.su.CHAR.PTCR_V4.DEVICES,dataIndex:"allDeviceCount",cls:"parent-control-v4-grid-device-td",width:100,renderer:function(e,t){return t.available?0==e?0:"<div class='parental-device-content' data-tip='%STATUS%'>\t\t\t\t\t\t\t\t<div class='parental-device-content-div online'></div>\t\t\t\t\t\t\t\t<span class='text'>%ONLINE%</span>\t\t\t\t\t\t\t\t<div class='parental-device-content-div offline'></div>\t\t\t\t\t\t\t\t<span class='text'>%OFFLINE%</span>\t\t\t\t\t\t\t\t</div>".replace(/\%STATUS\%/g,u.su.CHAR.PTCR_V4.ONLINE+":"+t.onlineDeviceCount+" "+u.su.CHAR.PTCR_V4.OFFLINE+":"+(e-t.onlineDeviceCount)).replace(/\%ONLINE\%/g,t.onlineDeviceCount).replace(/\%OFFLINE\%/g,e-t.onlineDeviceCount):"-"}},{xtype:"actioncolumn",text:u.su.CHAR.PTCR_V4.INSIGHTS,cls:"static-action-column parent-control-internet-access-td",renderer:function(e,t){var n='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-insights %STATUS%">\t\t\t\t\t\t\t\t<span class="icon"></span>\t\t\t\t\t\t\t\t<span class="text"></span>\t\t\t\t\t\t\t\t</a>';return n=t.available?n.replace(/\%STATUS\%/g,"btn-insights"):n.replace(/\%STATUS\%/g,"disabled")}},{xtype:"actioncolumn",dataIndex:"internetBlocked",cls:"static-action-column parent-control-internet-access-td",width:"27%",text:u.su.CHAR.PTCR_V4.INTERNET_ACCESS,renderer:function(e,t){var n='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-internet-access %STATUS%">\t\t\t\t\t\t\t\t<span class="icon"></span>\t\t\t\t\t\t\t\t<span class="text">%PAUSED%</span>\t\t\t\t\t\t\t\t</a>';return n=(n=t.available?n.replace(/\%STATUS\%/g,"btn-internet-access "+(1==e?"off":"on")):n.replace(/\%STATUS\%/g,"disabled")).replace(/\%PAUSED\%/g,u.su.CHAR.PTCR_V4.PAUSED)}},{xtype:"actioncolumn",text:u.su.CHAR.PTCR_V4.MODIFY,dataIndex:"internetBlocked",renderer:function(e,t){var n='<a href="javascript:void(0)" class="grid-content-btn %STATUS%">\t\t\t\t\t\t\t\t<span class="icon" %EDIT_TIP%></span>\t\t\t\t\t\t\t\t<span class="text"></span>\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t<a href="javascript:void(0)" class="grid-content-btn grid-content-custom-btn-delete btn-delete">\t\t\t\t\t\t\t\t<span class="icon" data-tip="%DELETE_TIP%"></span>\t\t\t\t\t\t\t\t<span class="text"></span>\t\t\t\t\t\t\t\t</a>';return n=(n=t.available?n.replace(/\%STATUS\%/g,"grid-content-btn-edit btn-edit").replace(/\%EDIT_TIP\%/g,'data-tip="'+u.su.CHAR.PTCR_V4.EDIT+'"'):n.replace(/\%STATUS\%/g,"grid-content-btn-edit-disabled disabled").replace(/\%EDIT_TIP\%/g,"")).replace(/\%DELETE_TIP\%/g,u.su.CHAR.OPERATION.DELETE)}}]}},{id:"ptcr-edit-tabs",fields:[{text:u.su.CHAR.PTCR_V4.BASIC_INFO,name:"basic-info",container:"basic-info"},{text:u.su.CHAR.PTCR_V4.FILTER_CONTENT,name:"filter-level",container:"filter-level"},{text:u.su.CHAR.PTCR_V4.TIME_CONTROL,name:"time-controls",container:"time-controls"}]},{id:"ptcr-insight-tabs",fields:[{text:u.su.CHAR.PTCR_V4.VISITS_HISTORY,name:"visit-history-visits",container:"visit-history-visits"},{text:u.su.CHAR.PTCR_V4.BLOCKED_HISTORY,name:"website-list-v4",container:"website-list-v4"}]},{id:"ptcr-online-devices",configs:[{type:"deviceType",dataIndex:"clientType",renderer:r.deviceListTypeFilter},{type:"deviceName",dataIndex:"name",renderer:r.deviceListNameFilter},{type:"mac",dataIndex:"mac"}]},{id:"ptcr-offline-devices",configs:[{type:"deviceType",dataIndex:"clientType",renderer:r.deviceListTypeFilter},{type:"deviceName",dataIndex:"name",renderer:r.deviceListNameFilter},{type:"mac",dataIndex:"mac"}]},{id:"ptcr-selected-devices",itemRender:function(e,t){return'<div class="device-wrap">\t\t\t\t\t\t<span class="del-icon" data-mac="%MAC%"></span>\t\t\t\t\t\t<div class="name-tag-group">\t\t\t\t\t\t<span class="name single-line">%NAME%</span>\t\t\t\t\t\t<span class="%TAG% single-line">%PROFILE%</span>\t\t\t\t\t\t</div>\t\t\t\t\t\t<span class="mac">%MAC%</span>\t\t\t\t\t\t<span class="device-icon %TYPE%"></span>\t\t\t\t\t\t</div>'.replace(/\%MAC\%/g,u.su.escapeHtml(t.mac)).replace(/\%NAME\%/g,u.su.escapeHtml(t.name)).replace(/\%TYPE\%/g,u.su.escapeHtml(t.clientType)).replace(/\%PROFILE\%/g,u.su.escapeHtml(t.ownerName)).replace(/\%TAG\%/g,0<t.ownerName.length?"tag":"")}},{id:"ptcr-dev-list",renderer:function(e){return'<span class="icon device-type %TYPE%"></span>\t\t\t\t\t\t<span class="text single-line">%NAME%<span>'.replace(/\%TYPE\%/g,u.su.escapeHtml(e.clientType)).replace(/\%NAME\%/g,u.su.escapeHtml(e.name))}},{id:"insight-website-list",itemRender:function(e,t){return'<div class="data-box">\t\t\t\t\t\t\t<div class="time-wrapper"><span class="time">%TIME%</span></div>\t\t\t\t\t\t\t<div class="point-wrapper"><span class="point"></span></div>\t\t\t\t\t\t\t<span class="conn-line"></span>\t\t\t\t\t\t\t<div class="website-wrapper"><span class="website-list-title">%URL_TITLE%</span><span title="%URL%" class="website">%URL%</span></div>\t\t\t\t\t\t\t<div class="category-wrapper"><span class="website-list-title">%CATEGORY_TITLE%</span><span class="website">%CATEGORY%</span></div>\t\t\t\t\t\t\t<a class="%BLOCK_CLASS%" website="%URL%">%BLOCK_TEXT%</a>\t\t\t\t\t\t\t</div>'.replace(/\%TIME\%/g,u.su.escapeHtml(r.transferTime(t.blockTime))).replace(/\%URL\%/g,u.su.escapeHtml(t.url)).replace(/\%CATEGORY\%/,r.categoryFilter(t.category)).replace(/\%BLOCK_CLASS\%/g,t.blocked?"unblock":"unblocked").replace(/\%BLOCK_TEXT\%/g,t.blocked?u.su.CHAR.PTCR_V4.UNBLOCK:u.su.CHAR.PTCR_V4.UNBLOCKED).replace(/\%URL_TITLE\%/,u.su.CHAR.PTCR_V4.BLOCKED_WEBSITES).replace(/\%CATEGORY_TITLE\%/,u.su.CHAR.PTCR_V4.CATEGORY)}}]}),this.listen({"models.ptcrEditorV4Model.enable":{ev_value_change:function(e,t,n){t?a.parentalControlsV4Views.parentalCtrlsBedtime.show():a.parentalControlsV4Views.parentalCtrlsBedtime.hide()}},"models.ptcrEditorV4Model.bedtimeBegin":{ev_value_change:function(e,t,n){r.setTimeControlsTips()}},"models.ptcrEditorV4Model.bedtimeEnd":{ev_value_change:function(e,t,n){r.setTimeControlsTips()}},"models.ptcrEditorV4Model.age":{ev_value_change:function(e,t,n){"add"===r.popEditorStatus&&(t!=n&&null!=t)&&r.setPresetValueByAge(t)}},"models.parentalControlsStatus":{ev_loaded:function(e,t){r.PROFILE_LIMIT.DEVICES_LENGTH=parseInt(t.clientPerOwnerMax)||16,r.PROFILE_LIMIT.CATEGORY_LENGTH=parseInt(t.filterWebsiteMax)||32,r.PROFILE_LIMIT.PROFILE_MAX=parseInt(t.totalOwnerMax)||32,r.PROFILE_LIMIT.BLOCK_LIST_MAX=parseInt(t.filterWebsiteMax)||32,r.PROFILE_LIMIT.ALLOW_LIST_MAX=parseInt(t.filterFreeWebsiteMax)||32}}}),this.control({"#ptcr-grid":{ev_grid_before_edit:function(e,t,n){void 0===n&&s.parentalControlsStoreV4.getData().length>=r.PROFILE_LIMIT.PROFILE_MAX?(t.preventDefault(),o.main.alert(u.su.CHAR.PTCR_V4.PROFILE_LIMIT_NOTICE.replace("%NUM%",r.PROFILE_LIMIT.PROFILE_MAX))):"auto"!==i.timeSettings.type.getValue()&&(t.preventDefault(),i.timeSettings.type.setValue("auto"),a.parentalControlsV4Views.timeSetMsg.show())},ev_grid_edit:function(e,t){var n;r.popEditorStatus="add"===t?"add":"edit",a.parentalControlsV4Views.parentalCtrlsEditSwitch.switchField("basic-info"),"add"===t?(a.parentalControlsV4Views.parentalCtrlsEditSwitch.setSupportViewSwitch(!1),s.parentalControlsStoreV4.getPlugin("editor").hideBtns(),a.parentalControlsV4Views.parentalCtrlsAddBtns.show(),i.ptcrEditorV4Model.age.setValue(r.AGE_PREFER_NOT_TO_SAY),a.parentalControlsV4Views.openAllowWeb.hide(),a.parentalControlsV4Views.basicInfoConflictTip.hide(),r.setBedTimeDisable({mode:"everyday"}),r.setMsgButtonStatus(),r.loadDeviceList()):(r.editId=s.parentalControlsStoreV4.getModelByKey(t).ownerId.getValue(),a.parentalControlsV4Views.parentalCtrlsEditSwitch.setSupportViewSwitch(!0),s.parentalControlsStoreV4.getPlugin("editor").showBtns(),a.parentalControlsV4Views.parentalCtrlsAddBtns.hide(),a.parentalControlsV4Views.parentalCtrlsEditSwitch.show(),r.getAllowList().then(function(e){0<e.length?a.parentalControlsV4Views.openAllowWeb.show():a.parentalControlsV4Views.openAllowWeb.hide()}),n=s.parentalControlsStoreV4.getModelByKey(t).bedtime.getValue(),r.setBedTimeDisable(n),n=s.parentalControlsStoreV4.getModelByKey(t).viewObjs[0].domId,u("#"+n).find(".pcgrid-red-dot").hide(),r.loadDeviceList(),r.checkClientList(i.ptcrEditorV4Model.allDeviceMac.getValue()),r.judgeIfNeedShowBasicTip(),r.syncFilterCategoriesListView())},ev_before_grid_cancel:function(e,t){i.ptcrEditorV4Model.isDirty()?(t.preventDefault(),r.cancelAddProfile()):((t=s.parentalControlsStoreV4.getPlugin("editor")).getMsgBox().close(),t.cancelEdit())},ev_grid_before_save:function(e,t){var n=s.parentalControlsStoreV4.getPlugin("editor");t.preventDefault(),a.parentalControlsV4Views.parentalCtrlsAddBtnsRight.loading(),i.ptcrEditorV4Model.submit({success:function(){a.parentalControlsV4Views.parentalCtrlsAddBtnsRight.loading(!1),n.getMsgBox().close(),n.cancelEdit(),i.ptcrEditorV4Model.reset(),s.parentalControlsStoreV4.load()}})}},"#edit-name-conflict-hint => .closable":{click:function(e){a.parentalControlsV4Views.basicInfoConflictTip.hide()}},"#add-name-conflict-hint => .closable":{click:function(e){a.parentalControlsV4Views.addDeviceConflictHint.hide()}},"#ptcr-grid_popEditor-msg":{ev_msg_close:function(e,t){i.ptcrEditorV4Model.isDirty()&&t.preventDefault()}},"#ptcr-grid => a.btn-internet-access":{ev_grid_action_click:function(e,t){var n=s.parentalControlsStoreV4.getModelByKey(t),a=n.internetBlocked.getValue(),t="<h3 class='ptcr-confirm-title'>%TITLE%</h3><p>%NAME%</p>",i="",i=a?(t=t.replace(/\%TITLE\%/g,u.su.CHAR.PTCR_V4.ALLOW_TITLE).replace(/\%NAME\%/g,u.su.CHAR.PTCR_V4.ALLOW_MSG.replace(/\%name/g,u.su.escapeHtml(n.name.getValue()))),u.su.CHAR.PTCR_V4.ALLOW):(t=t.replace(/\%TITLE\%/g,u.su.CHAR.PTCR_V4.BLOCK_TITLE).replace(/\%NAME\%/g,u.su.CHAR.PTCR_V4.BLOCK_MSG.replace(/\%name/g,u.su.escapeHtml(n.name.getValue()))),u.su.CHAR.PTCR_V4.BLOCK);o.main.confirm(t,function(){r.toggleProfileStatus(n.ownerId.getValue(),!a)},null,i,u.su.CHAR.OPERATION.CANCEL)}},"#ptcr-grid => a.btn-delete":{ev_grid_action_click:function(e,t){var n=s.parentalControlsStoreV4.getModelByKey(t),t=u.su.CHAR.PTCR_V4.DEL_CONFIRM.replace(/\%name/g,u.su.escapeHtml(n.name.getValue()));o.main.confirm(t,function(){r.deleteProfile(n.ownerId.getValue())},null,u.su.CHAR.OPERATION.DELETE,u.su.CHAR.OPERATION.CANCEL)}},"#ptcr-grid => a.disabled":{ev_grid_action_click:function(e,t){var n="<h3 class='ptcr-confirm-title'>"+u.su.CHAR.PTCR_V4.SUBSCRIPTION_TIMEOUT_TITLE+"</h3>";n+="<p>"+u.su.CHAR.PTCR_V4.SUBSCRIPTION_TIMEOUT+"</p>",o.main.alert(n)}},"#ptcr-grid => a.btn-insights":{ev_grid_action_click:function(e,t){t=s.parentalControlsStoreV4.getModelByKey(t);"paid"==i.parentalControlsStatus.state.getValue()?(a.parentalControlsV4Views.insightWaring.show(),a.parentalControlsV4Views.insightFieldset.hide(),a.parentalControlsV4Views.parentalCtrlsInsightMsg.show(),a.parentalControlsV4Views.parentalInsightSwitch.itemClick("visit-history-visits")):(r.ownerId=t.ownerId.getValue(),r.profileName=t.name.getValue(),r.filterCategoriesList=t.filterCategoriesList.getValue(),o.main.showMask(),a.parentalControlsV4Views.pageLoading.show(),a.parentalControlsV4Views.insightWaring.hide(),a.parentalControlsV4Views.insightFieldset.show(),r.getInsightsData().then(function(){r.renderHistoryCollection(),r.renderVisitHistory(),o.main.hideMask(),a.parentalControlsV4Views.pageLoading.hide(),a.parentalControlsV4Views.parentalCtrlsInsightMsg.show(),a.parentalControlsV4Views.parentalInsightSwitch.itemClick("visit-history-visits")}).fail(function(){o.main.hideMask(),a.parentalControlsV4Views.pageLoading.hide()}))}},"#ptcr-insight-msg":{ev_msg_close:function(e,t){s.parentalControlsStoreV4.load()}},"#ptcr-dev-list":{ev_add_item:function(e){r.refreshDeviceList(r.deviceData),r.visibleNoSelDevNote();var t=u(window).height();"s"!==u.su.widgetSize&&u(".ptcr-add-dev-msg .layout-wrap").css({"max-height":t-320}),a.parentalControlsV4Views.parentalCtrlsAddDevicesMsg.show(),r.judgeIfNeedShowAddTip()}},"#ptcr-dev-list => .del-icon":{click:function(e){for(var t=u(e.target||e.currentTarget).attr("data-id"),n="",a=0;a<r.deviceData.length;a++)if(t==r.deviceData[a].mac){n=r.deviceData[a].name;break}r.examConflictList(n,t,!1),r.judgeIfNeedShowBasicTip()}},"#time-set-msg":{ev_msg_ok:function(e,t){i.timeSettings.submit({success:function(){i.timeSettings.load()}})},ev_msg_close:function(e,t){i.timeSettings.reset()},ev_msg_no:function(e,t){i.timeSettings.reset()}},"#ptcr-add-dev-msg-v4":{ev_msg_ok:function(e,t){t.preventDefault();t=s.ptcrSelectedDevsV4;t.getSize()>r.PROFILE_LIMIT.DEVICES_LENGTH?o.main.showError(u.su.CHAR.PTCR_V4.DEV_CATEGORY_LIMIT.replace("%1$d",r.PROFILE_LIMIT.DEVICES_LENGTH)):(t.getData().some(function(e){return""!==e.ownerName&&e.ownerId!=r.editId})?r.showDeviceOwnerNotice():r.saveMsgSelDev(),r.judgeIfNeedShowBasicTip())},ev_msg_no:function(e,t){r.selectedConflictName=[],r.cancelResetConflictName(),r.judgeIfNeedShowBasicTip()},ev_msg_close:function(e,t){r.cancelResetConflictName(),r.judgeIfNeedShowBasicTip()}},"#ptcr-online-devices":{ev_item_select:function(e,t){r.respondSelDev(t,!0),r.setConflictName(s.ptcrOnlineDevsV4.getModelByKey(t)),r.judgeIfNeedShowAddTip()},ev_item_deselect:function(e,t){r.respondDeselDev(t),r.resetConflictName(s.ptcrOnlineDevsV4.getModelByKey(t)),r.judgeIfNeedShowAddTip()}},"#ptcr-offline-devices":{ev_item_select:function(e,t){r.respondSelDev(t,!1),r.setConflictName(s.ptcrOfflineDevsV4.getModelByKey(t)),r.judgeIfNeedShowAddTip()},ev_item_deselect:function(e,t){r.respondDeselDev(t),r.resetConflictName(s.ptcrOfflineDevsV4.getModelByKey(t)),r.judgeIfNeedShowAddTip()}},"#ptcr-selected-devices => .del-icon":{click:function(e){var e=u(e.target||e.currentTarget).attr("data-mac"),t=s.ptcrSelectedDevsV4.getModelByKey(e),n=t.online.getValue(),a=t.name.getValue(),t=t.mac.getValue();(n?s.ptcrOnlineDevsV4:s.ptcrOfflineDevsV4).unselectItems(e),r.respondDeselDev(e),r.examConflictList(a,t,!1),r.judgeIfNeedShowAddTip()}},"#parental-ctrls-add-btns-left":{ev_button_click:function(){var e=a.parentalControlsV4Views.parentalCtrlsEditSwitch.getCurField(),t=s.parentalControlsStoreV4.getPlugin("editor");"basic-info"==e?t.closeMsgBox():(a.parentalControlsV4Views.parentalCtrlsEditSwitch.switchPrev(),r.setMsgButtonStatus())}},"#parental-ctrls-add-btns-right":{ev_button_click:function(){var e=a.parentalControlsV4Views.parentalCtrlsEditSwitch,t=e.getCurField(),n=s.parentalControlsStoreV4.getPlugin("editor");"basic-info"==t?i.ptcrEditorV4Model.validate()&&(e.switchNext(),r.setMsgButtonStatus()):"filter-level"==t?(e.switchNext(),r.setMsgButtonStatus()):n.getSaveBtn().dom().triggerHandler("ev_button_click")}},"#url-input":{ev_input_enter:function(){r.addBlockedWeb()}},"#url-input-btn":{ev_button_click:function(){r.addBlockedWeb()}},"#go-to-time-settings":{click:function(){e.moduleManager.get("navigatorController").goTo("timeSettings")}},"#show-all":{ev_button_click:function(){var e=r.visitHistoryHtml,t=(t=r.topVisits).slice(5);e+=r.getVisitHistoryHtml(t,!1),u("#visit-history-visit-info-remain-grid tbody").html(e),u("#visit-history-visit-info-remain-grid a.block").click(function(){r.topVisitBlock(this)}),a.parentalControlsV4Views.showAllBtn.hide()}},"#show-more":{ev_button_click:function(){var e=s.blockHistoryStore.getData().length,e=Math.min(e+r.PROFILE_LIMIT.TOP_VISITS_LENGTH,r.blockHistoryList.length),t=u(".website-list-wrap-v4").get(0).scrollHeight;s.blockHistoryStore.loadData(r.blockHistoryList.slice(0,e),!0),s.blockHistoryStore.getData().length>=r.blockHistoryList.length&&(a.parentalControlsV4Views.showMoreBtn.hide(),a.parentalControlsV4Views.noHistoryBtn.show()),setTimeout(function(){u(".website-list-wrap-v4").animate({scrollTop:t},1e3)},100)}},"#insight-website-list => .unblock":{click:function(e){e=u(e.target||e.currentTarget);r.blockHistoryUnblock(e)}},"#open-allow-web-button":{ev_button_click:function(){r.showAllowList()}},"#allow-list-msg":{ev_msg_ok:function(e,t){r.editAllowList()}}})}},function(o,s,c,d,l,r){function n(e){var t=e%12;return(0==t?12:t)+(1<=e/12&&e/12<2?" PM":" AM")}function a(e){var t=e.toString();return(1===t.length?"0"+e:t)+":00"}return{PROFILE_LIMIT:{TOP_VISITS_LENGTH:5,DEVICES_LENGTH:16,CATEGORY_LENGTH:32,PROFILE_MAX:16,BLOCK_LIST_MAX:32,ALLOW_LIST_MAX:32},AGE_PREFER_NOT_TO_SAY:0,supportPatrolMark:r.device.getConfig().supportPatrolMark,allDeviceNameStack:{},selectedConflictName:[],deviceData:[],popEditorStatus:"add",editId:"",ownerId:"",profileName:"",todayOnlineTime:0,todayTotalAllowTime:1440,filterCategoriesList:[],topVisits:[],blockHistoryList:[],freeWeb:[],filterWeb:[],visitHistoryHtml:"",initPageData:function(){s.parentalControlsV4Views.pageLoading.show(),u.when(u.su.Model.promiseLoad(d.parentalControlsStoreV4),u.su.Model.promiseLoad(c.parentalControlsStatus),u.su.Model.promiseLoad(c.timeSettings)).then(function(){s.parentalControlsV4Views.pageLoading.hide()})},onTimeChange:function(e,t){var n=r.time.getHour24(),t=r.time.format(t,"yyyy-MM-dd HH:mm:ss",n);s.parentalControlsV4Views.currentTime.setValue(t)},onHour24Change:function(e,t){o.hourFormatter=t?a:n,c.ptcrViewModelV4.timeTable.setIs24(t),c.ptcrEditorV4Model.bedtimeBegin.setHourSystem(t?"24":"12"),c.ptcrEditorV4Model.bedtimeEnd.setHourSystem(t?"24":"12")},replaceCharStr:function(e,t,n){return e.replace(t,u.su.escapeHtml(n))},loadDeviceList:function(){o.allDeviceNameStack={},r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),preventSuccessEvent:!0,data:{operation:"getDevicesList"},ajax:{async:!1},success:function(e){for(var t=d.parentalControlsStoreV4.getData(),n=0;n<e.clientList.length;n++)e.clientList[n].ownerName=o.findOwnerName(e.clientList[n].ownerId,t);o.initDeviceNameStack(e.clientList),o.deviceData=e.clientList}})},initDeviceNameStack:function(e){o.allDeviceNameStack={};for(var t,n=0;n<e.length;n++)dev=e[n],null==o.allDeviceNameStack[dev.name]&&(o.allDeviceNameStack[dev.name]=[]),1===dev.devMark&&(t={mac:dev.mac,selected:!1},o.allDeviceNameStack[dev.name].push(t))},findOwnerName:function(e,t){if(-1!=e)for(var n=0;n<t.length;n++)if(e==t[n].ownerId)return t[n].name;return""},visibleNoSelDevNote:function(){0<d.ptcrSelectedDevsV4.getSize()?s.parentalControlsV4Views.noSelDevNote.hide():s.parentalControlsV4Views.noSelDevNote.show()},refreshDeviceList:function(e){var t=e.length,n=c.ptcrEditorV4Model.allDeviceMac.getValue(),a=[],i=[],r=[],s=[],o=[];if(n){for(var l=0;l<n.length;l++)a.push(n[l].mac);d.ptcrSelectedDevsV4.loadData(n)}for(l=0;l<t;l++)"1"==e[l].online?(s.push(e[l]),0<=a.indexOf(e[l].mac)&&i.push(e[l].mac)):(o.push(e[l]),0<=a.indexOf(e[l].mac)&&r.push(e[l].mac));d.ptcrOnlineDevsV4.loadData(s,!0),d.ptcrOfflineDevsV4.loadData(o,!0),d.ptcrOnlineDevsV4.selectItems(i),d.ptcrOfflineDevsV4.selectItems(r)},saveMsgSelDev:function(){c.ptcrEditorV4Model.allDeviceMac.setValue(d.ptcrSelectedDevsV4.getData("submit")),s.parentalControlsV4Views.parentalCtrlsAddDevicesMsg.close()},showDeviceOwnerNotice:function(){for(var e=d.ptcrSelectedDevsV4,t=null,n=c.ptcrEditorV4Model.name.getValue(),a="",i=0;i<e.getSize();i++)""!==(t=e.getModelByIndex(i)).ownerName.getValue()&&t.ownerId.getValue()!==o.editId&&(a+="<p>"+u.su.escapeHtml(t.mac.getValue())+" ,"+u.su.escapeHtml(t.name.getValue())+"</p>");n="<div class='move-msg-content'>\t\t\t\t\t<h3 class='ptcr-confirm-title'>%TITLE%</h3>\t\t\t\t\t<p>%NAME%</p>\t\t\t\t\t%OWNER%\t\t\t\t\t</div>".replace(/\%TITLE\%/g,u.su.CHAR.PTCR_V4.MOVE_DEVS).replace(/\%NAME\%/g,n?o.replaceCharStr(u.su.CHAR.PTCR_V4.MOVE_DEVS_TIP1,"%name",u.su.escapeHtml(n)):u.su.CHAR.PTCR_V4.MOVE_DEVS_TIP2).replace(/\%OWNER\%/g,a),l.main.confirm(n,o.saveMsgSelDev,null,u.su.CHAR.PTCR_V4.CONTINUE)},respondSelDev:function(e,t){var n=d.ptcrSelectedDevsV4,t=(t?d.ptcrOnlineDevsV4:d.ptcrOfflineDevsV4).getModelByKey(e).getData(),e=n.getData();n.loadData(e.concat(t)),o.visibleNoSelDevNote()},respondDeselDev:function(e){d.ptcrSelectedDevsV4.removeDataByKey(e),o.visibleNoSelDevNote()},setMsgButtonStatus:function(){var e=s.parentalControlsV4Views.parentalCtrlsEditSwitch.getCurField();"basic-info"==e||null==e?(s.parentalControlsV4Views.parentalCtrlsAddBtnsLeft.setText(u.su.CHAR.OPERATION.CANCEL_UPPERCASE),s.parentalControlsV4Views.parentalCtrlsAddBtnsRight.setText(u.su.CHAR.OPERATION.NEXT_UPPERCASE)):"filter-level"==e?(s.parentalControlsV4Views.parentalCtrlsAddBtnsLeft.setText(u.su.CHAR.COMMON.BACK),s.parentalControlsV4Views.parentalCtrlsAddBtnsRight.setText(u.su.CHAR.OPERATION.NEXT_UPPERCASE)):(s.parentalControlsV4Views.parentalCtrlsAddBtnsLeft.setText(u.su.CHAR.COMMON.BACK),s.parentalControlsV4Views.parentalCtrlsAddBtnsRight.setText(u.su.CHAR.COMMON.SAVE))},addBlockedWeb:function(){var e=c.ptcrViewModelV4.url,t=e.getValue(),n=c.ptcrEditorV4Model.filterWebsiteList;!0===o.validateKeyWeb(e,n.getValue())&&(n.setValue(n.getValue().concat(t)),e.reset())},validateKeyWeb:function(e,t){if(!e.getValue()||!e.validate())return!1;var n=o.PROFILE_LIMIT.CATEGORY_LENGTH,a="";t.length>=n&&(a=u.su.CHAR.PTCR_V4.DEV_CATEGORY_LIMIT.replace("%1$d",n));for(var i=0;i<t.length;i++)if(t[i]==e.getValue()){a=u.su.CHAR.PTCR_V4.KEYWORD_EXIST;break}return""===a||(e.setError(a),!1)},cancelAddProfile:function(){var e;e="<h3 class='ptcr-confirm-title'>%TITLE%</h3><p>%INNER%</p>".replace(/\%TITLE\%/g,u.su.CHAR.PTCR_V4.LEAVE_TITLE).replace(/\%INNER\%/g,u.su.CHAR.PTCR_V4.LEAVE_INNER),l.main.confirm(e,function(){var e=d.parentalControlsStoreV4.getPlugin("editor");e.getMsgBox().close(),e.cancelEdit(),c.ptcrEditorV4Model.reset(),o.selectedConflictName=[],s.parentalControlsV4Views.basicInfoConflictTip.hide(),s.parentalControlsV4Views.addDeviceConflictHint.hide()},null,u.su.CHAR.PTCR_V4.LEAVE)},setTimeControlsTips:function(){var e=c.ptcrEditorV4Model.bedtimeBegin.getValue()||"00:00",t=c.ptcrEditorV4Model.bedtimeEnd.getValue()||"00:00",e=parseInt(e.replace(":",""),10);parseInt(t.replace(":",""),10)<=e?c.ptcrEditorV4Model.bedtimeEnd.setShortTips(u.su.CHAR.LED.NEXT_DAY_TIP):c.ptcrEditorV4Model.bedtimeEnd.setShortTips("&nbsp;")},deviceListTypeFilter:function(e){return"<span class='device-icon %TYPE%'></span>".replace(/\%TYPE\%/g,e.toLowerCase())},deviceListNameFilter:function(e,t){return'<span class="single-line">%NAME%</span>\t\t\t\t<span class="single-line%OWNER_CLASS%">%OWNER%</span>'.replace(/\%NAME\%/g,e).replace(/\%OWNER_CLASS\%/g,0<t.ownerName.length?" tag":"").replace(/\%OWNER\%/g,t.ownerName)},setBedTimeDisable:function(e){if(s.parentalControlsV4Views.bedtimeWaring.hide(),s.parentalControlsV4Views.parentalCtrlsEveryDayBedtime.hide(),s.parentalControlsV4Views.parentalCtrlsWorkdayBedtime.hide(),s.parentalControlsV4Views.parentalCtrlsCustomBedtime.hide(),s.parentalControlsV4Views.parentalCtrlsBedtimeOff.hide(),"workingDay"==e.mode||"customize"==e.mode)if(s.parentalControlsV4Views.bedtimeWaring.show(),e.enable){if("workingDay"==e.mode){s.parentalControlsV4Views.parentalCtrlsWorkdayBedtime.show(),s.parentalControlsV4Views.bedtimeWorkdayMode.setText(u.su.CHAR.PTCR_V4.WEEKDAYS_WEEKENDS),s.parentalControlsV4Views.bedtimeWorkdayMode.disable();var t=o.transferTimeByMinutes(e.workingDay[0].bedtimeBegin)+" - "+o.transferTimeByMinutes(e.workingDay[0].bedtimeEnd),n=o.transferTimeByMinutes(e.workingDay[1].bedtimeBegin)+" - "+o.transferTimeByMinutes(e.workingDay[1].bedtimeEnd);s.parentalControlsV4Views.weekdaysBedtime.setText(t),s.parentalControlsV4Views.weekendsBedtime.setText(n)}else if("customize"==e.mode)for(var a,i=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],r=(s.parentalControlsV4Views.parentalCtrlsCustomBedtime.show(),s.parentalControlsV4Views.bedtimeCustomMode.setText(u.su.CHAR.PTCR_V4.CUSTOM_DAYS),s.parentalControlsV4Views.bedtimeCustomMode.disable(),0);r<i.length;r++)e.customize[r].enable?(a=o.transferTimeByMinutes(e.customize[r].bedtimeBegin)+" - "+o.transferTimeByMinutes(e.customize[r].bedtimeEnd),s.parentalControlsV4Views[i[r]+"Bedtime"].setText(a),s.parentalControlsV4Views[i[r]+"Bedtime"].show()):s.parentalControlsV4Views[i[r]+"Bedtime"].hide()}else s.parentalControlsV4Views.parentalCtrlsBedtimeOff.show(),s.parentalControlsV4Views.bedtimeSwitchOff.disable();else s.parentalControlsV4Views.parentalCtrlsEveryDayBedtime.show()},categoryFilter:function(e){switch(e){case"adult_content":return u.su.CHAR.PTCR_V4.ADULT_CONTENT;case"sex_education":return u.su.CHAR.PTCR_V4.SEX_EDUCATION;case"gambling":return u.su.CHAR.PTCR_V4.GAMBLING;case"online_communications":return u.su.CHAR.PTCR_V4.ONLINE_COMMUNICATIONS;case"pay_to_surf":return u.su.CHAR.PTCR_V4.PAY_TO_SURF;case"media":return u.su.CHAR.PTCR_V4.MADIA;case"download":return u.su.CHAR.PTCR_V4.DOWNLOAD;case"games":return u.su.CHAR.PTCR_V4.GAME;case"social_network":return u.su.CHAR.PTCR_V4.SOCIAL_NETWORKING;default:return u.su.CHAR.PTCR_V4.CUSTOM}},toggleProfileStatus:function(e,t){r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),data:{operation:"internetBlock",ownerId:e,internetBlocked:t},success:function(){d.parentalControlsStoreV4.load()}})},deleteProfile:function(e){r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),data:{operation:"delOwnerInList",ownerList:JSON.stringify([e])},success:function(){d.parentalControlsStoreV4.load()}})},getInsightsData:function(){var t=u.Deferred(),n=u.Deferred(),a=u.Deferred(),i=u.Deferred();return r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),preventSuccessEvent:!0,data:{operation:"getTodayVisitSites",ownerId:o.ownerId},success:function(e){u.isArray(e.visitWebsiteList)||(e.visitWebsiteList=[]),o.topVisits=e.visitWebsiteList,o.todayTotalAllowTime=e.todayTotalAllowTime,o.todayOnlineTime=e.todayOnlineTime,t.resolve()},fail:function(){t.reject()},error:function(){t.reject()}}),r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),preventSuccessEvent:!0,data:{operation:"getBlockHistory",ownerId:o.ownerId},success:function(e){u.isArray(e.websiteList)||(e.websiteList=[]),o.blockHistoryList=e.websiteList,n.resolve()},fail:function(){n.reject()},error:function(){n.reject()}}),r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),preventSuccessEvent:!0,data:{operation:"getFreeWebsite",ownerId:o.ownerId},success:function(e){u.isArray(e.filterFreeWebsiteList)||(e.filterFreeWebsiteList=[]),o.freeWeb=e.filterFreeWebsiteList,a.resolve()},fail:function(){a.reject()},error:function(){a.reject()}}),r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),preventSuccessEvent:!0,data:{operation:"getFilterWebsiteInfo",ownerId:o.ownerId},success:function(e){u.isArray(e.filterWebsiteList)||(e.filterWebsiteList=[]),o.filterWeb=e.filterWebsiteList,i.resolve()},fail:function(){i.reject()},error:function(){i.reject()}}),u.when(t,n,a,i)},renderVisitHistory:function(){var e,t=o.topVisits;!t.length||t.length<=0?(s.parentalControlsV4Views.visitNoHistory.show(),s.parentalControlsV4Views.topVisitsList.hide()):(t.length<=5?s.parentalControlsV4Views.showAllBtn.hide():(t=t.slice(0,5),s.parentalControlsV4Views.showAllBtn.show()),s.parentalControlsV4Views.visitNoHistory.hide(),s.parentalControlsV4Views.topVisitsList.show(),e=parseInt(o.todayOnlineTime/60)+" "+u.su.CHAR.PTCR_V4.HOURS+"<br />"+parseInt(o.todayOnlineTime%60)+" "+u.su.CHAR.PTCR_V4.MINS,u(".total-spent-online .content .hours-spent-v4").html(e),void 0===window.echarts?u.su.router.loadFile("js/libs/echarts.min.js",function(){o.renderTotalTime(o.todayOnlineTime)}):window.echarts&&o.renderTotalTime(o.todayOnlineTime),e=o.getVisitHistoryHtml(t,!0),o.visitHistoryHtml=e,u("#visit-history-visit-info-remain-grid tbody").html(e),u("#visit-history-visit-info-remain-grid a.block").click(function(){o.topVisitBlock(this)}))},topVisitBlock:function(t){if(!u(t).hasClass("blocked")){var n=u(t).attr("owner-id"),a=u(t).attr("website"),e="<h3 class='ptcr-confirm-title'>%TITLE%</h3><p>%INNER%</p>",i="",r="";if(0<=o.freeWeb.indexOf(a))e=e.replace(/\%TITLE\%/g,u.su.CHAR.PTCR_V4.REMOVE_ALLOW_LIST_TITLE).replace(/\%INNER\%/g,u.su.CHAR.PTCR_V4.REMOVE_ALLOW_LIST.replace(/\%name/g,u.su.escapeHtml(o.profileName)).replace(/\%url/g,u.su.escapeHtml(a))),i=function(){var e=o.freeWeb;e.splice(o.freeWeb.indexOf(a),1),o.setAllowList(n,e),s(t)},r=u.su.CHAR.PTCR_V4.REMOVE_UPPERCASE;else{if(o.filterWeb.length>=o.PROFILE_LIMIT.BLOCK_LIST_MAX)return void l.main.alert(u.su.CHAR.PTCR_V4.BLOCK_LIMIT_NOTICE.replace("%NUM%",o.PROFILE_LIMIT.BLOCK_LIST_MAX));e=e.replace(/\%TITLE\%/g,u.su.CHAR.PTCR_V4.ADD_BLOCK_WEB_TITLE).replace(/\%INNER\%/g,u.su.CHAR.PTCR_V4.ADD_BLOCK_WEB.replace(/\%name/g,u.su.escapeHtml(o.profileName)).replace(/\%url/g,u.su.escapeHtml(a))),i=function(){var e=o.filterWeb;e.push(a),o.setBlockList(n,e),s(t)},r=u.su.CHAR.PTCR_V4.BLOCK_UPPERCASE}l.main.confirm(e,i,null,r,u.su.CHAR.OPERATION.CANCEL_UPPERCASE)}function s(e){u(e).removeClass("block"),u(e).addClass("blocked"),u(e).text(u.su.CHAR.PTCR_V4.BLOCKED)}},blockHistoryUnblock:function(t){var n,e,a,i;function r(e){e.removeClass("unblock"),e.addClass("unblocked"),e.text(u.su.CHAR.PTCR_V4.UNBLOCKED)}o.freeWeb.length>=o.PROFILE_LIMIT.ALLOW_LIST_MAX?l.main.alert(u.su.CHAR.PTCR_V4.ALLOW_LIMIT_NOTICE.replace("%NUM%",o.PROFILE_LIMIT.ALLOW_LIST_MAX)):(n=t.attr("website"),e="<h3 class='ptcr-confirm-title'>%TITLE%</h3><p>%INNER%</p>",a="",(i=o.freeWeb).push(n),e="<h3 class='ptcr-confirm-title'>%TITLE%</h3><p>%INNER%</p>".replace(/\%TITLE\%/g,u.su.CHAR.PTCR_V4.ADD_ALLOW_LIST_TITLE).replace(/\%INNER\%/g,u.su.CHAR.PTCR_V4.ADD_ALLOW_LIST.replace(/\%name/g,u.su.escapeHtml(o.profileName)).replace(/\%url/g,u.su.escapeHtml(n))),a=0<=o.filterWeb.indexOf(n)?function(){var e=o.filterWeb;e.splice(o.filterWeb.indexOf(n),1),o.setBlockList(o.ownerId,e),o.setAllowList(o.ownerId,i),r(t)}:function(){o.setAllowList(o.ownerId,i),r(t)},l.main.confirm(e,a,null,u.su.CHAR.PTCR_V4.REMOVE_UPPERCASE,u.su.CHAR.OPERATION.CANCEL_UPPERCASE))},setBlockList:function(e,t){r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),data:{operation:"setFilterWebsiteInfo",ownerId:e,filterWebsiteList:JSON.stringify(t)},success:function(){o.filterWeb=t}})},setAllowList:function(e,t){r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),data:{operation:"setFreeWebsite",ownerId:e,filterFreeWebsiteList:JSON.stringify(t)},success:function(){o.freeWeb=t}})},renderTotalTime:function(e){var e=parseInt(e/o.todayTotalAllowTime*100),t={series:[{type:"pie",animation:!1,center:["50%","50%"],radius:[44,50],itemStyle:{normal:{label:{show:!1}}},data:[{name:"",value:e,itemStyle:{normal:{color:"#4acbd6",label:{show:!0,position:"center"},labelLine:{show:!1}},emphasis:{color:"#4acbd6"}}},{name:"",value:100-e,itemStyle:{normal:{color:"rgba(0, 0, 0, 0)",label:{show:!0},labelLine:{show:!1}},emphasis:{color:"rgba(0, 0, 0, 0)"}}}]}]},e={series:[{type:"pie",animation:!1,center:["50%","50%"],radius:[45,49],itemStyle:{normal:{label:{show:!1}}},data:[{name:"",value:e,itemStyle:{normal:{color:"rgba(0, 0, 0, 0)",label:{show:!0,position:"center"},labelLine:{show:!1}},emphasis:{color:"rgba(0, 0, 0, 0)"}}},{name:"",value:100-e,itemStyle:{normal:{color:"#e8e8e8",label:{show:!0},labelLine:{show:!1}},emphasis:{color:"#e8e8e8"}}}]}]},n=u("#total-spent-time").get(0),a=u("#total-left-time").get(0),n=echarts.init(n),a=echarts.init(a);n.setOption(t),a.setOption(e)},renderHistoryCollection:function(){var e=[];(0===o.blockHistoryList.length?(s.parentalControlsV4Views.blockHistoryList.hide(),s.parentalControlsV4Views.blockHistoryNoHistory):(e=o.blockHistoryList.slice(0,o.PROFILE_LIMIT.TOP_VISITS_LENGTH),s.parentalControlsV4Views.blockHistoryNoHistory.hide(),s.parentalControlsV4Views.blockHistoryList)).show(),d.blockHistoryStore.loadData(e,!0),o.PROFILE_LIMIT.TOP_VISITS_LENGTH<o.blockHistoryList.length?(s.parentalControlsV4Views.showMoreBtn.show(),s.parentalControlsV4Views.noHistoryBtn.hide()):(s.parentalControlsV4Views.showMoreBtn.hide(),s.parentalControlsV4Views.noHistoryBtn.show())},transferTime:function(e){e=new Date(1e3*e);return(12<e.getHours()?e.getHours()-12:e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+" "+(12<e.getHours()?"PM":"AM")},transferTimeByMinutes:function(e){var t,n=12<(t=parseInt(e/60,10))?"PM":"AM";return((t=12<t?t-12:t)<10?"0"+t:t)+":"+((t=parseInt(e%60,10))<10?"0"+t:t)+" "+n},getAllowList:function(){var t=u.Deferred();return r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),preventSuccessEvent:!0,data:{operation:"getFreeWebsite",ownerId:o.editId},success:function(e){t.resolve(e.filterFreeWebsiteList)}}),u.when(t)},showAllowList:function(){o.getAllowList().then(function(e){c.allowListModel.allowList.setValue(e),s.parentalControlsV4Views.allowListMsg.show()})},editAllowList:function(){r.ajax.request({url:u.su.url("/admin/avira_parental_control?form=avira_pactrl"),data:{operation:"setFreeWebsite",ownerId:o.editId,filterFreeWebsiteList:JSON.stringify(c.allowListModel.allowList.getValue())},success:function(){o.getAllowList().then(function(e){0===e.length&&s.parentalControlsV4Views.openAllowWeb.hide()}),s.parentalControlsV4Views.allowListMsg.hide()}})},setPresetValueByAge:function(e){var t={adult_content:!1,download:!1,gambling:!1,games:!1,media:!1,online_communications:!1,pay_to_surf:!1,sex_education:!1,social_network:!1},n=[],a=!0,i="21:00",r="7:00";for(key in 1<=e&&e<=5?(n=["adult_content","download","gambling","games","media","online_communications","pay_to_surf","sex_education","social_network"],i="19:00",r="9:00"):6<=e&&e<=10?(n=["games","media","sex_education"],i="20:00",r="7:00"):11<=e&&e<=13?n=["download","games","media","sex_education","social_network"]:14<=e&&e<=17?n=["download","games","media","sex_education","social_network","pay_to_surf"]:a=!1,t)t[key]=0<=n.indexOf(key);c.ptcrEditorV4Model.filterCategoriesList.setValue(t),c.ptcrEditorV4Model.enable.setValue(a),c.ptcrEditorV4Model.bedtimeBegin.setValue(i),c.ptcrEditorV4Model.bedtimeEnd.setValue(r)},examConflictList:function(e,t,n){if(0<=o.selectedConflictName.indexOf(e)&&o.selectedConflictName.splice(o.selectedConflictName.indexOf(e),1),o.allDeviceNameStack[e])for(var a=0;a<o.allDeviceNameStack[e].length;a++)t==o.allDeviceNameStack[e][a].mac?o.allDeviceNameStack[e][a].selected=n:t!==o.allDeviceNameStack[e][a].mac&&o.allDeviceNameStack[e][a].selected===!n&&o.selectedConflictName.indexOf(e)<0&&o.selectedConflictName.push(e)},checkClientList:function(e){if(!1===o.supportPatrolMark)s.parentalControlsV4Views.basicInfoConflictTip.hide();else{o.selectedConflictName=[];for(var t=0;t<e.length;t++)o.examConflictList(e[t].name,e[t].mac,!0)}},cancelResetConflictName:function(){var e=c.ptcrEditorV4Model.allDeviceMac.getValue();o.initDeviceNameStack(o.deviceData),o.checkClientList(e),o.judgeIfNeedShowBasicTip()},setConflictName:function(e){var t;1===e.devMark.getValue()&&(t=e.mac.getValue(),e=e.name.getValue(),o.examConflictList(e,t,!0))},resetConflictName:function(e){var t;1===e.devMark.getValue()&&(t=e.mac.getValue(),e=e.name.getValue(),o.examConflictList(e,t,!1))},judgeIfNeedShowAddTip:function(){o.supportPatrolMark&&0<o.selectedConflictName.length?s.parentalControlsV4Views.addDeviceConflictHint.show():s.parentalControlsV4Views.addDeviceConflictHint.hide()},judgeIfNeedShowBasicTip:function(){var e;o.supportPatrolMark&&0<o.selectedConflictName.length?(e=u.su.CHAR.PTCR_V4.NAME_CONFLICT.replace("%name%",o.selectedConflictName.join(" ")),u("#edit-name-conflict-hint").find("span.text").html(e),s.parentalControlsV4Views.basicInfoConflictTip.show()):s.parentalControlsV4Views.basicInfoConflictTip.hide()},syncFilterCategoriesListView:function(){var t=c.ptcrEditorV4Model.filterCategoriesList.getValue();c.ptcrEditorV4Model.filterCategoriesList.viewObjs.forEach(function(e){e.setValue(t)})},getVisitHistoryHtml:function(e,t){for(var n,a="",i=0;i<e.length;i++)n=e[i],a+='<tr><td class="url website">\t\t\t\t\t\t<div class="visit-history-url-number%NUMBER_CLASS%">%NUMBER%</div>\t\t\t\t\t\t<div class="visit-history-url-box"><div title="%URL%" class="visit-history-url-url">%URL%</div>\t\t\t\t\t\t<div class="visit-history-url-text"><span class="visit-history-url-time">%COUNT%</span>%TIMES%</div>\t\t\t\t\t\t<div class="visit-history-url-text"><span class="visit-history-url-count">%SPEND_TIME%</span>%MINUTES%</div></div>\t\t\t\t\t\t</td><td class="block visit-history-visit-block-box">\t\t\t\t\t\t<a class="%BLOCK_CLASS%" owner-id="%OWNER_ID%" website="%URL%">%BLOCK%</a></td></tr>'.replace(/\%NUMBER_CLASS\%/g,t?"":" low-number").replace(/\%NUMBER\%/g,i+(t?1:6)).replace(/\%URL\%/g,u.su.escapeHtml(n.url)).replace(/\%COUNT\%/g,n.count).replace(/\%TIMES\%/g," "+u.su.CHAR.PTCR_V4.TIMES).replace(/\%SPEND_TIME\%/g,n.spendTime).replace(/\%MINUTES\%/g," "+u.su.CHAR.PTCR_V4.MINUTES).replace(/\%BLOCK_CLASS\%/g,n.blocked?"blocked":"block").replace(/\%OWNER_ID\%/g,o.ownerId).replace(/\%BLOCK\%/g,n.blocked?u.su.CHAR.PTCR_V4.BLOCKED:u.su.CHAR.PTCR_V4.BLOCK);return a}}})}(jQuery),function(a){var t={adult_content:!1,download:!1,gambling:!1,games:!1,media:!1,online_communications:!1,pay_to_surf:!1,sex_education:!1,social_network:!1};function e(e){return e=a.isArray(e)?e:[]}function n(e){return e.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),e}function i(e){return parseInt(e/60,10)+":"+parseInt(e%60,10)}function r(e){return e?60*parseInt(e.split(":")[0],10)+parseInt(e.split(":")[1],10)+"":"0"}a.su.define("ptcrStoreProxyV4",{extend:"IPFProxy",url:a.su.url("/admin/avira_parental_control?form=avira_pactrl"),writeFilter:function(e){return a.extend(e,{operation:"getOwnerTotalData"})}}),a.su.define("ptcrStoreEditProxyV4",{extend:"IPFProxy",url:a.su.url("/admin/avira_parental_control?form=avira_pactrl"),writeFilter:function(e){return a.extend(e,{operation:"addOwnerInList"})}}),a.su.define("patrolOwnerBlockProxyV4",{url:a.su.url("/admin/avira_parental_control?form=avira_pactrl"),writeFilter:function(e){return a.extend(e,{operation:"internetBlock"})}}),a.su.modelManager.define("parentalControlsStatus",{type:"model",fields:[{name:"state"},{name:"availableOwnerMax"},{name:"totalOwnerMax"},{name:"clientPerOwnerMax"},{name:"filterWebsiteMax"},{name:"filterFreeWebsiteMax"}],proxy:"ptcrStoreProxyV4"}),a.su.storeManager.define("parentalControlsStoreV4",{type:"store",fields:[{name:"ownerId"},{name:"name"},{name:"age"},{name:"internetBlocked"},{name:"available"},{name:"enable"},{name:"bedtime"},{name:"bedtimeBegin"},{name:"bedtimeEnd"},{name:"todayOnlineTime"},{name:"allDeviceCount"},{name:"clientList"},{name:"onlineDeviceCount"},{name:"ruleMark"},{name:"allDeviceMac",defaultValue:[],convert:e},{name:"filterCategoriesList",defaultValue:[],convert:e},{name:"filterWebsiteList",defaultValue:[],convert:e}],convert:function(e){return a.isArray(e.ownerList)||(arr=[]),e.ownerList},proxy:"ptcrStoreProxyV4"}),a.su.modelManager.define("ptcrEditorV4Model",{type:"model",fields:[{name:"ownerId",serialize:function(e){return e||"-1"}},{name:"name",maxLength:64,allowBlank:!1},{name:"age"},{name:"internetBlocked",serialize:function(e){return e||!1}},{name:"bedtime"},{name:"enable"},{name:"bedtimeBegin"},{name:"bedtimeEnd"},{name:"allDeviceMac",convert:function(e,n){return(n.clientList&&a.isArray(n.clientList)?n.clientList:[]).map(function(e,t){return e.ownerName=n.name,e.ownerId=n.ownerId,e})},serialize:function(e){return e?(e=e.map(function(e){return e.mac}),JSON.stringify(e)):[]}},{name:"filterCategoriesList",convert:function(e){for(key in t)t[key]=0<=e.indexOf(key);return t},serialize:function(e){var t=[];for(key in e)e[key]&&t.push(key);return JSON.stringify(t)}},{name:"filterWebsiteList",serialize:function(e){return JSON.stringify(e||[])}}],proxy:"ptcrStoreEditProxyV4",convert:function(e){return e.bedtime?(e.bedtimeBegin=i(e.bedtime.everyday.bedtimeBegin),e.bedtimeEnd=i(e.bedtime.everyday.bedtimeEnd),e.enable=e.bedtime.enable):(e.bedtimeBegin=0,e.bedtimeEnd=0,e.enable=!1),e},serialize:function(e){return e.bedtime={},e.bedtime.enable=e.enable,e.bedtime.everyday={},e.bedtime.everyday.bedtimeBegin=r(e.bedtimeBegin),e.bedtime.everyday.bedtimeEnd=r(e.bedtimeEnd),e.bedtime=JSON.stringify(e.bedtime),delete e.enable,delete e.bedtimeBegin,delete e.bedtimeEnd,e}}),a.su.modelManager.define("ptcrViewModelV4",{fields:[{name:"url",maxLength:64,allowBlank:!0,vtype:"string_visible_no_comma"},{name:"timeTable"}]}),a.su.modelManager.define("allowListModel",{fields:[{name:"allowList"}]}),a.su.storeManager.define("ptcrAgeStore",{type:"store",fields:[{name:"name"},{name:"boxlabel"},{name:"value"}],data:function(){for(var e=[],t=1;t<18;t++)e.push({name:t.toString(),value:t});return e.push({name:"18+",value:18}),e.push({name:a.su.CHAR.PTCR_V4.PREFER_NOT_TO_SAY,value:0}),e}()});var s=[{name:"online"},{name:"ownerId"},{name:"ownerName"},{name:"mac"},{name:"name"},{name:"clientType"},{name:"connType"},{name:"devMark"}];a.su.storeManager.define("ptcrOnlineDevsV4",{type:"store",keyProperty:"mac",fields:s,convert:n}),a.su.storeManager.define("ptcrOfflineDevsV4",{type:"store",keyProperty:"mac",fields:s,convert:n}),a.su.storeManager.define("ptcrSelectedDevsV4",{type:"store",keyProperty:"mac",fields:s}),a.su.storeManager.define("blockHistoryStore",{type:"store",keyProperty:"website",fields:[{name:"category"},{name:"blockTime"},{name:"blocked"},{name:"url"}]}),a.su.storeManager.define("ptcrCategoriesV4",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:"adult_content",value:"adult_content",boxlabel:a.su.CHAR.PTCR_V4.ADULT_CONTENT},{name:"sex_education",value:"sex_education",boxlabel:a.su.CHAR.PTCR_V4.SEX_EDUCATION},{name:"gambling",value:"gambling",boxlabel:a.su.CHAR.PTCR_V4.GAMBLING},{name:"online_communications",value:"online_communications",boxlabel:a.su.CHAR.PTCR_V4.ONLINE_COMMUNICATIONS},{name:"social_network",value:"social_network",boxlabel:a.su.CHAR.PTCR_V4.SOCIAL_NETWORKING},{name:"pay_to_surf",value:"pay_to_surf",boxlabel:a.su.CHAR.PTCR_V4.PAY_TO_SURF},{name:"media",value:"media",boxlabel:a.su.CHAR.PTCR_V4.MADIA},{name:"download",value:"download",boxlabel:a.su.CHAR.PTCR_V4.DOWNLOAD},{name:"games",value:"games",boxlabel:a.su.CHAR.PTCR_V4.GAME}]}),a.su.storeManager.define("setTimeModeV4Store",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:a.su.CHAR.TIMESETTING.GET_GMT,value:"auto",boxlabel:a.su.CHAR.TIMESETTING.GET_GMT}]})}(jQuery),function(l){l.su.moduleManager.define("qosV2",{deps:[],services:["device","time","moduleManager"],models:["qosV2"],stores:["bandwidthUnitStore","qosDevicePriorityStore","timePeriodStore"],views:["qosV2View"],listeners:{ev_on_launch:function(e,i,r,a,s,t,n){r.qosV2View.devicePriorityPanel.hide(),i.supportQosSchedule?(n.time.on("on_time_change",i.onTimeChange),n.time.on("on_hour24_change",i.onHour24Change)):r.qosV2View.scheduleWrap.hide(),a.qosV2.load({success:function(e){"on"==e.enable?r.qosV2View.devicePriorityPanel.show():r.qosV2View.devicePriorityPanel.hide(),i.maxUpBand=parseInt(a.qosV2.maxUpBand.getValue()),i.maxDownBand=parseInt(a.qosV2.maxDownBand.getValue()),"mbps"==e.up_unit&&a.qosV2.upBand.setVtype({vtype:"float_number2",min:1,max:i.maxUpBand}),"mbps"==e.down_unit&&a.qosV2.downBand.setVtype({vtype:"float_number2",min:1,max:i.maxDownBand})}}),s.qosDevicePriorityStore.load(),i.initUpdateInterval(),this.listen({"models.qosV2":{ev_model_submit:function(e,t){"on"==t.enable?r.qosV2View.devicePriorityPanel.show():r.qosV2View.devicePriorityPanel.hide()}},"stores.qosDevicePriorityStore":{ev_data_change:function(e,t,n,a){if(t.value!=t.oldValue&&"enablePriority"==n.getName()&&(!0===t.value&&"on"==a.getData().enableLimit?(clearInterval(i.updateInterval),r.qosV2View.qosSpeedLimitConflictMsg.show()):s.qosDevicePriorityStore.sync({success:function(e){s.qosDevicePriorityStore.loadData(e,!0)}})),t.value!=t.oldValue&&"timing"==n.getName()){if(s.qosDevicePriorityStore.abort(),"-2"===t.value)return!1;s.qosDevicePriorityStore.sync({success:function(e){s.qosDevicePriorityStore.loadData(e,!0)}})}}},"views.qosV2View.timeFrom":{ev_value_change:function(e,t){var n=r.qosV2View.timeTo.getValue();i.timeHandler(t,n)}},"views.qosV2View.timeTo":{ev_value_change:function(e,t){var n=r.qosV2View.timeFrom.getValue();i.timeHandler(n,t)}},"models.qosV2.upUnit":{ev_value_change:function(e,t,n){null!=n&&0!==i.maxUpBand&&(a.qosV2.upBand.setNormal(),"kbps"==t?a.qosV2.upBand.setVtype({vtype:"float_number2",min:1,max:1e3}):a.qosV2.upBand.setVtype({vtype:"float_number2",min:1,max:i.maxUpBand}),a.qosV2.upBand.validate())}},"models.qosV2.downUnit":{ev_value_change:function(e,t,n){null!=n&&0!==i.maxDownBand&&(a.qosV2.downBand.setNormal(),"kbps"==t?a.qosV2.downBand.setVtype({vtype:"float_number2",min:1,max:1e3}):a.qosV2.downBand.setVtype({vtype:"float_number2",min:1,max:i.maxDownBand}),a.qosV2.downBand.validate())}}})},ev_before_destroy:function(e,t,n,a,i,r,s){clearInterval(t.updateInterval),t.clearUpdateTime()}},init:function(o,e,t,r,n,a){this.configViews({id:"qosV2View",items:[{id:"qos-device-priority-grid",configs:{popEditor:{editTitle:l.su.CHAR.QOS_V2.SCHEDULE,content:"#qos-schedule-editor",fields:[{name:"timeFrom"},{name:"timeTo"},{name:"repeat"}]},columns:[{dataIndex:"deviceName",cls:"m-hide l-hide xl-hide label-empty"},{text:l.su.CHAR.QOS_V2.TYPE,dataIndex:"deviceType",cls:"m-hide l-hide xl-hide label-empty",renderer:function(e,t){e=e.toLowerCase();var n=t.enablePriority?"enable":"",a="",i="",r="";switch(e){case"pc":a="icon-pc";break;case"phone":a="icon-phone";break;case"pad":a="icon-pad";break;case"entertainment":a="icon-entertainment";break;case"iot_device":a="icon-iot_device";break;case"laptop":a="icon-laptop";break;case"printer":a="icon-printer";break;case"other":a="icon-other";break;default:a="icon-"+e}var s=parseInt(t.timing),s=((-2===s&&"on"==t.status&&"enable"==n||-2!=s&&"enable"==n)&&(r='<span class="star-tag"></span>'),t.deviceTag),n=t.mac;return(i+='<div class="device-type-container widget-container">')+('<span class="icon '+a+' ">'+r+"</span>")+"</div>"+'<div class="device-info-container widget-container">'+'<div class="device-mac-container">'+('<span class="mode '+o.getLinkMode(s)+'"></span>')+('<span class="mac">'+n+"</span>")+"</div>"+"</div>"}},{text:l.su.CHAR.QOS_V2.TYPE,width:"12%",dataIndex:"deviceType",cls:"s-hide",renderer:function(e,t){e=e.toLowerCase();var n=t.enablePriority?"enable":"",a="",i="",r="";switch(e){case"pc":a="icon-pc";break;case"phone":a="icon-phone";break;case"pad":a="icon-pad";break;case"entertainment":a="icon-entertainment";break;case"iot_device":a="icon-iot_device";break;case"laptop":a="icon-laptop";break;case"printer":a="icon-printer";break;case"other":a="icon-other";break;default:a="icon-"+e}var s=parseInt(t.timing);return(i+='<div class="device-type-container widget-container">')+('<span class="icon '+a+' ">'+(r=-2===s&&"on"==t.status&&"enable"==n||-2!=s&&"enable"==n?'<span class="star-tag"></span>':r)+"</span>")+"</div>"}},{text:l.su.CHAR.QOS_V2.INFORMATION,width:"25%",dataIndex:"deviceName",cls:"s-hide",renderer:function(e,t){var n,a,i,r="";return"object"===l.type(t)&&(n=t.deviceName,a=t.deviceTag,i=t.mac,"0.0.0.0"==t.ip||t.ip,r=(r=(r=(r=r+'<div class="device-info-container widget-container"><div class="name" title="'+n+'">'+n+"</div>")+'<div><span class="mode '+o.getLinkMode(a)+'"></span>')+'<span class="mac">'+i+"</span></div>")+'<div class="edit" deviceName="'+n+'" mac="'+i+'"></div></div>'),r}},{text:l.su.CHAR.QOS_V2.REAL_TIME_RATE,width:"20%",dataIndex:"downloadSpeed",renderer:function(e,t){function n(e){var t=(e=8*parseInt(e,10))/1024<1?(0!==e&&(e=(e/1024).toFixed(2)),l.su.CHAR.NETWORK_MAP.KBPS_BIT):e/1024/1024<1?(e/1024<1e3?e=(e/1024).toFixed(1):e/=1024,l.su.CHAR.NETWORK_MAP.KBPS_BIT):(e=(e/1024/1024).toFixed(1),l.su.CHAR.NETWORK_MAP.MBPS_BIT);return{speed:e,unit:t}}var a,i="";return"object"===l.type(t)&&(a=n(t.downloadSpeed),i=(i=(i=(i=(i+='<div class="speed-upload-container widget-container">')+'<span class="icon"></span><span class="text">'+(t=n(t.uploadSpeed)).speed+"</span>")+'<span class="unit">'+t.unit+'</span></div><div class="speed-download-container widget-container">')+'<span class="icon"></span><span class="text">'+a.speed+"</span>")+'<span class="unit">'+a.unit+"</span></div>"),i}},{text:l.su.CHAR.QOS_V2.TRAFFIC_USAGE,dataIndex:"trafficUsage",width:"12%",cls:"center-td",renderer:function(e,t){if("---"==e)return"---";var n=e,n=t.trafficUsage,e="";n/=1024;for(var a=0;a<4&&1<n/1024;a++)n/=1024;return e=(e+='<span class="text usage">'+Math.floor(10*n)/10+"</span>")+('<span class="text unit">'+["KB","MB","GB","TB"][a]+"</span>")}},{text:l.su.CHAR.QOS_V2.HIGH_PRIORITY,dataIndex:"enablePriority",xtype:"customWidget",width:"12%",cls:"status connected-clients-grid-priority-td",widgetName:"switch",settings:{trueValue:!0,falseValue:!1}},{text:l.su.CHAR.QOS_V2.TIMING,dataIndex:"timing",xtype:"customWidget",width:110,cls:"s-2-col timing",widgetName:"combobox",settings:{noneSelectedText:"",items:o.timePeriodItem()},showRenderer:!0,renderer:function(e,t){var n,a,i;return t.enablePriority?-2===(n=parseInt(t.timing))?("on"===t.status?l.su.CHAR.TIMESETTING.ON:l.su.CHAR.TIMESETTING.OFF)+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit hidden"><span class="icon"></span></a>':(i=t.remainTime,a=parseInt(i/3600),i=parseInt(i%3600/60),!(!n||t.remainTime<60)&&a+" "+l.su.CHAR.QOS_V2.H+" "+i+" "+l.su.CHAR.QOS_V2.MIN+"</br>"+l.su.CHAR.QOS_V2.REMAINING):"---"}}]}},{id:"qos-schedule-repeat",format:function(e){for(var t=/\b(\w)|\s(\w)/g,n=e.length,a=0;a<n;a++)e[a]=e[a].replace(t,function(e){return e.toUpperCase()});return e.join(",")}}]}),this.control({"#qos-device-priority-grid":{ev_grid_after_save:function(e){o.initUpdateInterval()},ev_grid_cancel:function(e){r.qosDevicePriorityStore.load(),o.initUpdateInterval()},ev_grid_custom_change:function(e,t,n,a,i){e.preventDefault(),"timing"===i.dataIndex&&"-2"===t.value&&null!=t.triggerAction&&"clickLabel"==t.triggerAction&&(clearInterval(o.updateInterval),r.qosDevicePriorityStore.abort(),e="#"+n.domId+" .grid-content-btn-edit",l(e).click())}},"#system-time-settings":{ev_button_click:function(){a.moduleManager.get("navigatorController").goTo("timeSettings")}},"#qos-speedlimit-conflict-msg":{ev_msg_ok:function(){r.qosDevicePriorityStore.sync({success:function(e){r.qosDevicePriorityStore.loadData(e,!0)}})},ev_msg_cancel:function(){r.qosDevicePriorityStore.reset()}}})}},function(t,a,e,n,i,r){var s=l("#global-combobox-options");return{updateInterval:null,maxUpBand:0,maxDownBand:0,supportQosSchedule:r.device.getConfig().supportQosSchedule,isTriband:r.device.getIsTriband(),initUpdateInterval:function(){t.updateInterval=setInterval(function(){"_hidden_"===s.attr("data-shown")&&n.qosDevicePriorityStore.load()},6e3)},timePeriodItem:function(){var e=n.timePeriodStore.getData();return e=t.supportQosSchedule?e.concat([{name:l.su.CHAR.QOS_V2.SCHEDULE,value:"-2"}]):e},onTimeChange:function(e,t){var n=r.time.getHour24(),t=r.time.format(t,"yyyy-MM-dd HH:mm:ss",n);a.qosV2View.currentTime.setValue(t)},onHour24Change:function(e,t){t?(a.qosV2View.timeFrom.setHourSystem("24"),a.qosV2View.timeTo.setHourSystem("24")):(a.qosV2View.timeFrom.setHourSystem("12"),a.qosV2View.timeTo.setHourSystem("12"))},clearUpdateTime:function(){r.time.off("on_time_change",t.onTimeChange),r.time.off("on_hour24_change",t.onHour24Change)},timeHandler:function(e,t){if("string"!=typeof e||"string"!=typeof t)return!1;e=parseInt(e.replace(/:/,""),10),t=parseInt(t.replace(/:/,""),10)<=e?l.su.CHAR.WIRELESS_SCHEDULE.NEXT_DAY_TIP:"";a.qosV2View.timeTo.setShortTips(t)},getLinkMode:function(e){switch(e){case"2.4G":return"show_24G";case"5G":return t.isTriband?"show_51G":"show_5G";case"5G_1":return"show_51G";case"5G_2":return"show_52G";case"6G":return"show_6G";case"wired":return"show_LAN";default:return"show_offline"}}}})}(jQuery),function(t){t.su.modelManager.define("qosV2",{type:"model",fields:[{name:"enable",defaultValue:"off"},{name:"upBand",mapping:"up_band",allowBlank:!1,vtype:{vtype:"float_number2",min:1,max:1e3}},{name:"downBand",mapping:"down_band",allowBlank:!1,vtype:{vtype:"float_number2",min:1,max:1e3}},{name:"upUnit",mapping:"up_unit"},{name:"downUnit",mapping:"down_unit"},{name:"maxUpBand",mapping:"max_up_band",disabled:!0},{name:"maxDownBand",mapping:"max_down_band",disabled:!0}],proxy:{url:t.su.url("/admin/smart_network?form=qos")}}),t.su.storeManager.define("qosDevicePriorityStore",{type:"store",fields:[{name:"deviceType"},{name:"deviceName"},{name:"deviceTag"},{name:"mac"},{name:"downloadSpeed"},{name:"uploadSpeed"},{name:"trafficUsage"},{name:"enablePriority"},{name:"timePeriod"},{name:"remainTime"},{name:"timeMode",mapping:"time_mode"},{name:"timeFrom",mapping:"time_begin"},{name:"timeTo",mapping:"time_end"},{name:"repeat",mapping:"repeat_weeks",defaultValue:""},{name:"status"},{name:"timing"},{name:"enableLimit"}],convert:function(e){return t.each(e,function(e,t){"schedule"===t.time_mode?t.timing="-2":t.timing=t.timePeriod,t.time_begin||(t.time_begin="10:00",t.time_end="18:00",t.repeat_weeks="Mon,Tue,Wed,Thu,Fri")}),e},serialize:function(e){return t.each(e,function(e,t){"-2"===t.timing?t.time_mode="schedule":(t.time_mode="period",t.timePeriod=t.timing),delete t.timing,delete t.status}),e},proxy:{url:t.su.url("/admin/smart_network?form=device_priority")}})}(jQuery);
!function(Ve){Ve.Jcrop=function(e,t){var w=Ve.extend({},Ve.Jcrop.defaults),A=navigator.userAgent.toLowerCase(),R=/msie/.test(A),A=/msie [1-6]\./.test(A);function i(e){return Math.round(e)+"px"}function a(e){return w.baseClass+"-"+e}function c(e){e=Ve(e).offset();return[e.left,e.top]}function n(e){return[e.pageX-m[0],e.pageY-m[1]]}function T(e){w=Ve.extend(w,e="object"!=typeof e?{}:e),Ve.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof w[t]&&(w[t]=function(){})})}function K(e,t,n){if(m=c(u),B.setCursor("move"===e?e:e+"-resize"),"move"===e)return B.activateHandlers((o=t,Ee.watchKeys(),function(e){M.moveOffset([e[0]-o[0],e[1]-o[1]]),o=e,I.update()}),L,n);var o,i,a,t=M.getFixed(),r=E(e),s=M.getCorner(E(r));M.setPressed(M.getCorner(r)),M.setCurrent(s),B.activateHandlers((i=e,a=t,function(e){if(w.aspectRatio)switch(i){case"e":case"w":e[1]=a.y+1;break;case"n":case"s":e[0]=a.x+1}else switch(i){case"e":case"w":e[1]=a.y2;break;case"n":case"s":e[0]=a.x2}M.setCurrent(e),I.update()}),L,n)}function E(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function W(t){return function(e){return w.disabled||"move"===t&&!w.allowMove||(m=c(u),o=!0,K(t,n(e)),e.stopPropagation(),e.preventDefault()),!1}}function Y(e,t,n){var o=e.width(),i=e.height();n<(i=t<o&&0<t?(o=t)/e.width()*e.height():i)&&0<n&&(o=(i=n)/e.height()*e.width()),v=e.width()/o,y=e.height()/i,e.width(o).height(i)}function q(e){return{x:e.x*v,y:e.y*y,x2:e.x2*v,y2:e.y2*y,w:e.w*v,h:e.h*y}}function L(e){var t=M.getFixed();t.w>w.minSelect[0]&&t.h>w.minSelect[1]?(I.enableHandles(),I.done()):I.release(),B.setCursor(w.allowSelect?"crosshair":"default")}function X(e){var t;if(!w.disabled&&w.allowSelect)return o=!0,m=c(u),I.disableHandles(),B.setCursor("crosshair"),t=n(e),M.setPressed(t),I.update(),B.activateHandlers(G,L,"touch"===e.type.substring(0,5)),Ee.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function G(e){M.setCurrent(e),I.update()}function N(){var e=Ve("<div></div>").addClass(a("tracker"));return R&&e.css({opacity:0,backgroundColor:"white"}),e}"object"!=typeof e&&(e=Ve(e)[0]),T(t="object"!=typeof t?{}:t);var u,V,Q,U,Z,v,y,o,$,t={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},r=Ve(e),_=!0,f=("IMG"==e.tagName?(0!=r[0].width&&0!=r[0].height?(r.width(r[0].width),r.height(r[0].height)):((Ke=new Image).src=r[0].src,r.width(Ke.width),r.height(Ke.height)),(u=r.clone().removeAttr("id").css(t).show()).width(r.width()),u.height(r.height()),r.after(u).hide()):(u=r.css(t).show(),_=!1,null===w.shade&&(w.shade=!0)),Y(u,w.boxWidth,w.boxHeight),u.width()),p=u.height(),s=Ve("<div />").width(f).height(p).addClass(a("holder")).css({position:"relative",backgroundColor:w.bgColor}).insertAfter(r).append(u),d=(w.addClass&&s.addClass(w.addClass),Ve("<div />")),ee=Ve("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),l=Ve("<div />").width("100%").height("100%").css("zIndex",320),h=Ve("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=M.getFixed();w.onDblClick.call(J,e)}).insertBefore(u).append(ee,l),g=(_&&(d=Ve("<img />").attr("src",u.attr("src")).css(t).width(f).height(p),ee.append(d)),A&&h.css({overflowY:"hidden"}),w.boundary),b=N().width(f+2*g).height(p+2*g).css({position:"absolute",top:i(-g),left:i(-g),zIndex:290}).mousedown(X),te=w.bgColor,ne=w.bgOpacity,m=c(u),C={createDragger:function(t){return function(e){return w.disabled||"move"===t&&!w.allowMove||(m=c(u),o=!0,K(t,n(C.cfilter(e)),!0),e.stopPropagation(),e.preventDefault()),!1}},newSelection:function(e){return X(C.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:oe,support:!0===w.touchSupport||!1===w.touchSupport?w.touchSupport:oe()};function oe(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var i,a=(i="on"+n[e])in o;a||(o.setAttribute(i,"return;"),a="function"==typeof o[i]),t[n[e]]=a}return t.touchstart&&t.touchend&&t.touchmove}catch(e){return!1}}z=k=S=x=0;var ie,ae,x,S,k,z,M={flipCoords:ce,setPressed:function(e){e=se(e),k=x=e[0],z=S=e[1]},setCurrent:function(e){e=se(e),ie=e[0]-k,ae=e[1]-z,k=e[0],z=e[1]},getOffset:function(){return[ie,ae]},moveOffset:function(e){var t=e[0],e=e[1];x+t<0&&(t-=t+x),S+e<0&&(e-=e+S),p<z+e&&(e+=p-(z+e)),f<k+t&&(t+=f-(k+t)),x+=t,k+=t,S+=e,z+=e},getCorner:function(e){var t=re();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}},getFixed:re};function re(){var e,t,n,o,i,a,r,s,c,u,d,l,h;return w.aspectRatio?(t=w.aspectRatio,n=w.minSize[0]/v,o=w.maxSize[0]/v,i=w.maxSize[1]/y,a=k-x,r=z-S,s=Math.abs(a),c=Math.abs(r),0===o&&(o=10*f),0==i&&(i=10*p),s/c<t?(d=z,l=c*t,(u=a<0?x-l:l+x)<0?(u=0,h=Math.abs((u-x)/t),d=r<0?S-h:h+S):f<u&&(u=f,h=Math.abs((u-x)/t),d=r<0?S-h:h+S)):(u=k,h=s/t,(d=r<0?S-h:S+h)<0?(d=0,l=Math.abs((d-S)*t),u=a<0?x-l:l+x):p<d&&(d=p,l=Math.abs(d-S)*t,u=a<0?x-l:l+x)),x<u?(u-x<n?u=x+n:o<u-x&&(u=x+o),d=S<d?S+(u-x)/t:S-(u-x)/t):u<x&&(x-u<n?u=x-n:o<x-u&&(u=x-o),d=S<d?S+(x-u)/t:S-(x-u)/t),u<0?(x-=u,u=0):f<u&&(x-=u-f,u=f),d<0?(S-=d,d=0):p<d&&(S-=d-p,d=p),ue(ce(x,S,u,d))):(i=k-x,c=z-S,V&&Math.abs(i)>V&&(k=0<i?x+V:x-V),Q&&Math.abs(c)>Q&&(z=0<c?S+Q:S-Q),Z/y&&Math.abs(c)<Z/y&&(z=0<c?S+Z/y:S-Z/y),U/v&&Math.abs(i)<U/v&&(k=0<i?x+U/v:x-U/v),x<0&&(k-=x,x-=x),S<0&&(z-=S,S-=S),k<0&&(x-=k,k-=k),z<0&&(S-=z,z-=z),f<k&&(x-=e=k-f,k-=e),p<z&&(S-=e=z-p,z-=e),f<x&&(z-=e=x-p,S-=e),p<S&&(z-=e=S-p,S-=e),ue(ce(x,S,k,z)))}function se(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>f&&(e[0]=f),e[1]>p&&(e[1]=p),[Math.round(e[0]),Math.round(e[1])]}function ce(e,t,n,o){var i=e,a=n,r=t,s=o;return n<e&&(i=n,a=e),o<t&&(r=o,s=t),[i,r,a,s]}function ue(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}O=!1,j=Ve("<div />").css({position:"absolute",zIndex:240,opacity:0}),F={top:he(),left:he().height(p),right:he().height(p),bottom:he()};var O,j,F,H={update:de,updateRaw:le,getShades:we,setBgColor:pe,enable:fe,disable:ge,resize:function(e,t){F.left.css({height:i(t)}),F.right.css({height:i(t)})},refresh:function(){(w.shade?fe:ge)(),I.isAwake()&&be(w.bgOpacity)},opacity:be};function de(){return le(M.getFixed())}function le(e){F.top.css({left:i(e.x),width:i(e.w),height:i(e.y)}),F.bottom.css({top:i(e.y2),left:i(e.x),width:i(e.w),height:i(p-e.y2)}),F.right.css({left:i(e.x2),width:i(f-e.x2)}),F.left.css({width:i(e.x)})}function he(){return Ve("<div />").css({position:"absolute",backgroundColor:w.shadeColor||w.bgColor}).appendTo(j)}function fe(){O||(O=!0,j.insertBefore(u),de(),I.setBgOpacity(1,0,1),d.hide(),pe(w.shadeColor||w.bgColor,1),I.isAwake()?be(w.bgOpacity,1):be(1,1))}function pe(e,t){Ge(we(),e,t)}function ge(){O&&(j.remove(),d.show(),O=!1,I.isAwake()?I.setBgOpacity(w.bgOpacity,1,1):(I.setBgOpacity(1,1,1),I.disableHandles()),Ge(s,0,1))}function be(e,t){O&&(w.bgFade&&!t?j.animate({opacity:1-e},{queue:!1,duration:w.fadeTime}):j.css({opacity:1-e}))}function we(){return j.children()}ye=!(ve=370),w.dragEdges&&Ve.isArray(w.createDragbars)&&xe(w.createDragbars),Ve.isArray(w.createHandles)&&ke(w.createHandles),w.drawBorders&&Ve.isArray(w.createBorders)&&Se(w.createBorders),Ve(document).bind("touchstart.jcrop-ios",function(e){Ve(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()}),me=N().mousedown(W("move")).css({cursor:"move",position:"absolute",zIndex:360}),C.support&&me.bind("touchstart.jcrop",C.createDragger("move")),ee.append(me),He();var D,ve,ye,me,I={updateVisible:Me,update:Oe,release:function(){He(),h.hide(),w.shade?H.opacity(1):je(1),D=!1,w.onRelease.call(J)},refresh:ze,isAwake:function(){return D},setCursor:function(e){me.css("cursor",e)},enableHandles:Fe,enableOnly:function(){ye=!0},showHandles:function(){ye&&l.show()},disableHandles:He,animMode:De,setBgOpacity:je,done:function(){De(!1),ze()}};function Ce(e,t){t=Ve("<div />").mousedown(W(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return C.support&&t.bind("touchstart.jcrop",C.createDragger(e)),l.append(t),t}function xe(e){for(var t=0;t<e.length;t++)e[t],Ce(e[t],ve++).addClass("jcrop-dragbar")}function Se(e){for(var t,n,o=0;o<e.length;o++){switch(e[o]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}e[o],n=t,n=Ve("<div />").css({position:"absolute",opacity:w.borderOpacity}).addClass(a(n)),ee.append(n),n}}function ke(e){for(var t,n,o=0;o<e.length;o++)e[o],t=e[o],n=void 0,n=w.handleSize,t=Ce(t,ve++).css({opacity:w.handleOpacity}).addClass(a("handle")),n&&t.width(n).height(n),t}function ze(){var e=M.getFixed();M.setPressed([e.x,e.y]),M.setCurrent([e.x2,e.y2]),Me()}function Me(e){if(D)return Oe(e)}function Oe(e){var t,n,o=M.getFixed();t=o.w,n=o.h,h.width(Math.round(t)).height(Math.round(n)),t=o.x,n=o.y,w.shade||d.css({top:i(-n),left:i(-t)}),h.css({top:i(n),left:i(t)}),w.shade&&H.updateRaw(o),D||(h.show(),w.shade?H.opacity(ne):je(ne,!0),D=!0);(e?w.onSelect:w.onChange).call(J,q(o))}function je(e,t,n){(D||t)&&(w.bgFade&&!n?u.animate({opacity:e},{queue:!1,duration:w.fadeTime}):u.css("opacity",e))}function Fe(){if(ye=!0,w.allowResize)return l.show(),!0}function He(){ye=!1,l.hide()}function De(e){(e?($=!0,He):($=!1,Fe))()}Ie=function(){},Be=function(){},(Pe=w.trackDocument)||b.mousemove(Je).mouseup(Ae).mouseout(Ae),u.before(b);var Ie,Be,Pe,B={activateHandlers:function(e,t,n){return o=!0,Ie=e,Be=t,e=n,b.css({zIndex:450}),e?Ve(document).bind("touchmove.jcrop",Re).bind("touchend.jcrop",Te):Pe&&Ve(document).bind("mousemove.jcrop",Je).bind("mouseup.jcrop",Ae),!1},setCursor:function(e){b.css("cursor",e)}};function Je(e){return Ie(n(e)),!1}function Ae(e){return e.preventDefault(),e.stopPropagation(),o&&(o=!1,Be(n(e)),I.isAwake()&&w.onSelect.call(J,q(M.getFixed())),b.css({zIndex:290}),Ve(document).unbind(".jcrop"),Ie=function(){},Be=function(){}),!1}function Re(e){return Ie(n(C.cfilter(e))),!1}function Te(e){return Ae(C.cfilter(e))}P=Ve('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),Ke=Ve("<div />").css({position:"absolute",overflow:"hidden"}).append(P),w.keySupport&&(P.keydown(function(e){if(e.ctrlKey||e.metaKey)return!0;var t=!!e.shiftKey?10:1;switch(e.keyCode){case 37:We(e,-t,0);break;case 39:We(e,t,0);break;case 38:We(e,0,-t);break;case 40:We(e,0,t);break;case 27:w.allowSelect&&I.release();break;case 9:return!0}return!1}).blur(function(e){P.hide()}),(A||!w.fixedSupport?(P.css({position:"absolute",left:"-20px"}),Ke.append(P)):P).insertBefore(u));var P,Ke,Ee={watchKeys:function(){w.keySupport&&(P.show(),P.focus())}};function We(e,t,n){w.allowMove&&(M.moveOffset([t,n]),I.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function Ye(e){qe([e[0]/v,e[1]/y,e[2]/v,e[3]/y]),w.onSelect.call(J,q(M.getFixed())),I.enableHandles()}function qe(e){M.setPressed([e[0],e[1]]),M.setCurrent([e[2],e[3]]),I.update()}function Le(){w.disabled=!0,I.disableHandles(),I.setCursor("default"),B.setCursor("default")}function Xe(){w.disabled=!1,Ne()}function Ge(e,t,n){t=t||w.bgColor;w.bgFade&&Ve.fx.step.hasOwnProperty("backgroundColor")&&w.fadeTime&&!n?e.animate({backgroundColor:t},{queue:!1,duration:w.fadeTime}):e.css("backgroundColor",t)}function Ne(e){w.allowResize?e?I.enableOnly():I.enableHandles():I.disableHandles(),B.setCursor(w.allowSelect?"crosshair":"default"),I.setCursor(w.allowMove?"move":"default"),w.hasOwnProperty("trueSize")&&(v=w.trueSize[0]/f,y=w.trueSize[1]/p),w.hasOwnProperty("setSelect")&&(Ye(w.setSelect),I.done(),delete w.setSelect),H.refresh(),w.bgColor!=te&&(Ge(w.shade?H.getShades():s,w.shade&&w.shadeColor||w.bgColor),te=w.bgColor),ne!=w.bgOpacity&&(ne=w.bgOpacity,w.shade?H.refresh():I.setBgOpacity(ne)),V=w.maxSize[0]||0,Q=w.maxSize[1]||0,U=w.minSize[0]||0,Z=w.minSize[1]||0,w.hasOwnProperty("outerImage")&&(u.attr("src",w.outerImage),delete w.outerImage),I.refresh()}C.support&&b.bind("touchstart.jcrop",C.newSelection),l.hide(),Ne(!0);var J={setImage:function(i,a){I.release(),Le();var r=new Image;r.onload=function(){var e=r.width,t=r.height,n=w.boxWidth,o=w.boxHeight;u.width(e).height(t),u.attr("src",i),d.attr("src",i),Y(u,n,o),f=u.width(),p=u.height(),d.width(f).height(p),b.width(f+2*g).height(p+2*g),s.width(f).height(p),H.resize(f,p),Xe(),"function"==typeof a&&a.call(J)},r.src=i},animateTo:function(e,t){var n,o,i,a,r,s,c,u,d,l,h=e[0]/v,f=e[1]/y,p=e[2]/v,g=e[3]/y;function b(){window.setTimeout(l,i)}$||(e=M.flipCoords(h,f,p,g),n=[(n=M.getFixed()).x,n.y,n.x2,n.y2],o=n,i=w.animationDelay,a=e[0]-n[0],r=e[1]-n[1],s=e[2]-n[2],c=e[3]-n[3],u=0,d=w.swingSpeed,h=o[0],f=o[1],p=o[2],g=o[3],I.animMode(!0),l=function(){u+=(100-u)/d,o[0]=Math.round(h+u/100*a),o[1]=Math.round(f+u/100*r),o[2]=Math.round(p+u/100*s),o[3]=Math.round(g+u/100*c),(u=99.8<=u?100:u)<100?(qe(o),b()):(I.done(),I.animMode(!1),"function"==typeof t&&t.call(J))},b())},setSelect:Ye,setOptions:function(e){T(e),Ne()},tellSelect:function(){return q(M.getFixed())},tellScaled:function(){return M.getFixed()},setClass:function(e){s.removeClass().addClass(a("holder")).addClass(e)},disable:Le,enable:Xe,cancel:function(){I.done(),B.activateHandlers(null,null)},release:I.release,destroy:function(){s.remove(),r.show(),r.css("visibility","visible"),Ve(e).removeData("Jcrop")},focus:Ee.watchKeys,getBounds:function(){return[f*v,p*y]},getWidgetSize:function(){return[f,p]},getScaleFactor:function(){return[v,y]},getOptions:function(){return w},ui:{holder:s,selection:h}};return R&&s.bind("selectstart",function(){return!1}),r.data("Jcrop",J),J},Ve.fn.Jcrop=function(e,t){var n;return this.each(function(){if(Ve(this).data("Jcrop")){if("api"===e)return Ve(this).data("Jcrop");Ve(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?Ve.Jcrop.Loader(this,function(){Ve(this).css({display:"block",visibility:"hidden"}),n=Ve.Jcrop(this,e),Ve.isFunction(t)&&t.call(n)}):(Ve(this).css({display:"block",visibility:"hidden"}),n=Ve.Jcrop(this,e),Ve.isFunction(t)&&t.call(n))}),this},Ve.Jcrop.Loader=function(e,t,n){var o=Ve(e),i=o[0];o.bind("load.jcloader",function e(){i.complete?(o.unbind(".jcloader"),Ve.isFunction(t)&&t.call(i)):window.setTimeout(e,50)}).bind("error.jcloader",function(e){o.unbind(".jcloader"),Ve.isFunction(n)&&n.call(i)}),i.complete&&Ve.isFunction(t)&&(o.unbind(".jcloader"),t.call(i))},Ve.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);